(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{59535:e=>{"use strict";function t(e,t){if(e!==t)throw TypeError("Private static access of wrong provenance")}e.s({_:()=>t})},605073:e=>{"use strict";e.s({_:()=>n});var t=e.i(59535);function n(e,n,i){return(0,t._)(e,n),i}},356356:e=>{"use strict";e.s({ClientMsgCode:()=>iU,DefaultMap:()=>ng,DerivedSignal:()=>no,HttpError:()=>tQ,MutableSignal:()=>ns,ServerMsgCode:()=>nx,Signal:()=>nn,SortedList:()=>i3,assert:()=>nR,assertNever:()=>nC,autoRetry:()=>t0,batch:()=>t6,compactObject:()=>tX,console:()=>tP,createClient:()=>iF,createCommentId:()=>nm,createNotificationSettings:()=>n6,createThreadId:()=>n_,detectDupes:()=>tT,getMentionedIdsFromCommentBody:()=>iB,getSubscriptionKey:()=>i5,isStartsWithOperator:()=>tq,kInternal:()=>n4,makePoller:()=>i0,nanoid:()=>nf,nn:()=>nM,patchNotificationSettings:()=>n9,raise:()=>tH,shallow:()=>i1,shallow2:()=>i2,stableStringify:()=>nl});var t,n,i,r,o,s,a,l,c,d,u,h,f,p,_,m,g,v,y,b,w,S,I,E,A,T,k,O,C,R,M,D,N,P,x,L,U,j,W,V,F,K,q,H,z,B,G,Y,X,J,Z,Q,$,ee,et,en,ei,er,eo,es,ea,el,ec,ed,eu,eh,ef,ep,e_,em,eg,ev,ey,eb,ew,eS,eI,eE,eA,eT,ek,eO,eC,eR,eM=e.i(632859),eD=e.i(526050),eN=e.i(607618),eP=e.i(70827),ex=e.i(238193),eL=e.i(526350),eU=e.i(11968),ej=e.i(213384),eW=e.i(605073);function eV(){let e=(0,ej._)(["/v2/c/rooms/","/threads/delta"]);return eV=function(){return e},e}function eF(){let e=(0,ej._)(["/v2/c/rooms/","/threads"]);return eF=function(){return e},e}function eK(){let e=(0,ej._)(["/v2/c/rooms/","/threads"]);return eK=function(){return e},e}function eq(){let e=(0,ej._)(["/v2/c/rooms/","/threads/",""]);return eq=function(){return e},e}function eH(){let e=(0,ej._)(["/v2/c/rooms/","/thread-with-notification/",""]);return eH=function(){return e},e}function ez(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/metadata"]);return ez=function(){return e},e}function eB(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/comments"]);return eB=function(){return e},e}function eG(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/comments/",""]);return eG=function(){return e},e}function eY(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/comments/",""]);return eY=function(){return e},e}function eX(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/comments/","/reactions"]);return eX=function(){return e},e}function eJ(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/comments/","/reactions/",""]);return eJ=function(){return e},e}function eZ(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/mark-as-resolved"]);return eZ=function(){return e},e}function eQ(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/mark-as-unresolved"]);return eQ=function(){return e},e}function e$(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/subscribe"]);return e$=function(){return e},e}function e0(){let e=(0,ej._)(["/v2/c/rooms/","/threads/","/unsubscribe"]);return e0=function(){return e},e}function e1(){let e=(0,ej._)(["/v2/c/rooms/","/attachments/","/upload/",""]);return e1=function(){return e},e}function e2(){let e=(0,ej._)(["/v2/c/rooms/","/attachments/","/multipart/",""]);return e2=function(){return e},e}function e3(){let e=(0,ej._)(["/v2/c/rooms/","/attachments/","/multipart/","/",""]);return e3=function(){return e},e}function e5(){let e=(0,ej._)(["/v2/c/rooms/","/attachments/","/multipart/","/complete"]);return e5=function(){return e},e}function e8(){let e=(0,ej._)(["/v2/c/rooms/","/attachments/","/multipart/",""]);return e8=function(){return e},e}function e4(){let e=(0,ej._)(["/v2/c/rooms/","/attachments/presigned-urls"]);return e4=function(){return e},e}function e7(){let e=(0,ej._)(["/v2/c/rooms/","/subscription-settings"]);return e7=function(){return e},e}function e6(){let e=(0,ej._)(["/v2/c/rooms/","/subscription-settings"]);return e6=function(){return e},e}function e9(){let e=(0,ej._)(["/v2/c/rooms/","/inbox-notifications/read"]);return e9=function(){return e},e}function te(){let e=(0,ej._)(["/v2/c/rooms/","/text-mentions"]);return te=function(){return e},e}function tt(){let e=(0,ej._)(["/v2/c/rooms/","/text-mentions/",""]);return tt=function(){return e},e}function tn(){let e=(0,ej._)(["/v2/c/rooms/","/y-version/",""]);return tn=function(){return e},e}function ti(){let e=(0,ej._)(["/v2/c/rooms/","/version"]);return ti=function(){return e},e}function tr(){let e=(0,ej._)(["/v2/c/rooms/","/text-metadata"]);return tr=function(){return e},e}function to(){let e=(0,ej._)(["/v2/c/rooms/","/ai/contextual-prompt"]);return to=function(){return e},e}function ts(){let e=(0,ej._)(["/v2/c/rooms/","/versions"]);return ts=function(){return e},e}function ta(){let e=(0,ej._)(["/v2/c/rooms/","/versions/delta"]);return ta=function(){return e},e}function tl(){let e=(0,ej._)(["/v2/c/rooms/","/storage"]);return tl=function(){return e},e}function tc(){let e=(0,ej._)(["/v2/c/rooms/","/send-message"]);return tc=function(){return e},e}function td(){let e=(0,ej._)(["/v2/c/inbox-notifications"]);return td=function(){return e},e}function tu(){let e=(0,ej._)(["/v2/c/inbox-notifications/delta"]);return tu=function(){return e},e}function th(){let e=(0,ej._)(["/v2/c/inbox-notifications/count"]);return th=function(){return e},e}function tf(){let e=(0,ej._)(["/v2/c/inbox-notifications/read"]);return tf=function(){return e},e}function tp(){let e=(0,ej._)(["/v2/c/inbox-notifications/read"]);return tp=function(){return e},e}function t_(){let e=(0,ej._)(["/v2/c/inbox-notifications"]);return t_=function(){return e},e}function tm(){let e=(0,ej._)(["/v2/c/inbox-notifications/",""]);return tm=function(){return e},e}function tg(){let e=(0,ej._)(["/v2/c/notification-settings"]);return tg=function(){return e},e}function tv(){let e=(0,ej._)(["/v2/c/notification-settings"]);return tv=function(){return e},e}function ty(){let e=(0,ej._)(["/v2/c/threads"]);return ty=function(){return e},e}function tb(){let e=(0,ej._)(["/v2/c/threads/delta"]);return tb=function(){return e},e}var tw=Object.defineProperty,tS="@liveblocks/core",tI="2.24.3",tE="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:globalThis;function tA(e){console.error(e)}function tT(e,t,n){let i=Symbol.for(e),r=n?"".concat(t||"dev"," (").concat(n,")"):t||"dev";tE[i]?tE[i]===r||tA(["Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See ".concat("https://liveblocks.io/docs/errors/dupes "),"\nConflicts:","- ".concat(e," ").concat(tE[i]," (already loaded)"),"- ".concat(e," ").concat(r," (trying to load this now)")].join("\n")):tE[i]=r,t&&tI&&t!==tI&&tA(["Cross-linked versions of Liveblocks found, which will cause issues! See ".concat("https://liveblocks.io/docs/errors/cross-linked "),"\nConflicts:","- ".concat(tS," is at ").concat(tI),"- ".concat(e," is at ").concat(t),"\nAlways upgrade all Liveblocks packages to the same version number."].join("\n"))}function tk(e){let t=e.editedAt?new Date(e.editedAt):void 0,n=new Date(e.createdAt),i=e.reactions.map(e=>({...e,createdAt:new Date(e.createdAt)}));if(e.body)return{...e,reactions:i,createdAt:n,editedAt:t};{let r=new Date(e.deletedAt);return{...e,reactions:i,createdAt:n,editedAt:t,deletedAt:r}}}function tO(e){let t=new Date(e.createdAt),n=new Date(e.updatedAt),i=e.comments.map(e=>tk(e));return{...e,createdAt:t,updatedAt:n,comments:i}}function tC(e){let t=new Date(e.notifiedAt),n=e.readAt?new Date(e.readAt):null;if("activities"in e){let i=e.activities.map(e=>({...e,createdAt:new Date(e.createdAt)}));return{...e,notifiedAt:t,readAt:n,activities:i}}return{...e,notifiedAt:t,readAt:n}}function tR(e){let t=new Date(e.createdAt);return{...e,createdAt:t}}function tM(e){let t=new Date(e.deletedAt);return{...e,deletedAt:t}}function tD(e){let t=new Date(e.deletedAt);return{...e,deletedAt:t}}function tN(e){let t=new Date(e.deletedAt);return{...e,deletedAt:t}}var tP={};((e,t)=>{for(var n in t)tw(e,n,{get:t[n],enumerable:!0})})(tP,{error:()=>tj,errorWithTitle:()=>tF,warn:()=>tU,warnWithTitle:()=>tV});var tx="background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;";function tL(e){return"undefined"==typeof window?console[e]:function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return console[e]("%cLiveblocks",tx,t,...i)}}var tU=tL("warn"),tj=tL("error");function tW(e){return"undefined"==typeof window?console[e]:function(t,n){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return console[e]("%cLiveblocks%c ".concat(t),tx,"font-weight:600",n,...r)}}var tV=tW("warn"),tF=tW("error");function tK(e){return null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)}function tq(e){return tK(e)&&"string"==typeof e.startsWith}function tH(e){throw Error(e)}function tz(e){return Object.entries(e)}function tB(e){try{return JSON.parse(e)}catch(e){return}}function tG(e){return JSON.parse(JSON.stringify(e))}function tY(e){return e.filter(e=>null!=e)}function tX(e){let t={...e};return Object.keys(e).forEach(e=>{void 0===t[e]&&delete t[e]}),t}async function tJ(e,t,n){let i;return Promise.race([e,new Promise((e,r)=>{i=setTimeout(()=>{r(Error(n))},t)})]).finally(()=>clearTimeout(i))}function tZ(e){let t=null;return()=>(null===t&&(t=e().catch(e=>{throw setTimeout(()=>{t=null},5e3),e})),t)}var tQ=class e extends Error{static async fromResponse(t){let n,i,r;try{n=await t.text()}catch(e){}let o=n?tB(n):void 0;tK(o)&&(i=o);let s="";s||(s="string"==typeof(null==i?void 0:i.message)?i.message:""),s||(s="string"==typeof(null==i?void 0:i.error)?i.error:""),void 0===o&&(s||(s=n||"")),s||(s=t.statusText);try{r=new URL(t.url).pathname}catch(e){}return new e(s+=void 0!==r?" (got status ".concat(t.status," from ").concat(r,")"):" (got status ".concat(t.status,")"),t,i)}get status(){return this.response.status}constructor(e,t,n){super(e),(0,eU._)(this,"response",void 0),(0,eU._)(this,"details",void 0),this.name="HttpError",this.response=t,this.details=n}},t$=e=>e instanceof tQ&&e.status>=400&&e.status<500;async function t0(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t$,r=n.length>0?n[n.length-1]:0,o=0;for(;;){var s;o++;try{return await e()}catch(e){if(i(e))throw e;if(o>=t)throw Error("Failed after ".concat(t," attempts: ").concat(String(e)))}let a=null!=(s=n[o-1])?s:r;tU("Attempt ".concat(o," was unsuccessful. Retrying in ").concat(a," milliseconds.")),await function(e){return new Promise(t=>setTimeout(t,e))}(a)}}function t1(){let e,t;return[new Promise((n,i)=>{e=n,t=i}),e,t]}function t2(){let[e,t,n]=t1();return{promise:e,resolve:t,reject:n}}function t3(){let e=new Set;function t(t){return e.add(t),()=>e.delete(t)}function n(e){let n=t(t=>(n(),e(t)));return n}async function i(e){let n;return new Promise(i=>{n=t(t=>{(void 0===e||e(t))&&i(t)})}).finally(()=>null==n?void 0:n())}return{notify:function(t){let n=!1;for(let i of e)i(t),n=!0;return n},subscribe:t,subscribeOnce:n,count:function(){return e.size},waitUntil:i,dispose(){e.clear()},observable:{subscribe:t,subscribeOnce:n,waitUntil:i}}}var t5=Symbol("kSinks"),t8=Symbol("kTrigger"),t4=null,t7=null;function t6(e){if(null!==t4)return void e();t4=new Set;try{e()}finally{for(let e of t4)e[t8]();t4=null}}function t9(e){t4||tH("Expected to be in an active batch"),t4.add(e)}function ne(e,t){let n=!1,i={...e};return Object.keys(t).forEach(e=>{let r=t[e];i[e]!==r&&(void 0===r?delete i[e]:i[e]=r,n=!0)}),n?i:e}var nt=(t=new WeakMap,class{dispose(){(0,eM._)(this,t).dispose(),(0,eN._)(this,t,"(disposed)"),this.equals="(disposed)"}get hasWatchers(){if((0,eM._)(this,t).count()>0)return!0;for(let e of this[t5])if(e.hasWatchers)return!0;return!1}[t8](){for(let e of((0,eM._)(this,t).notify(),this[t5]))t9(e)}subscribe(e){return 0===(0,eM._)(this,t).count()&&this.get(),(0,eM._)(this,t).subscribe(e)}subscribeOnce(e){let t=this.subscribe(()=>(t(),e()));return t}waitUntil(){throw Error("waitUntil not supported on Signals")}markSinksDirty(){for(let e of this[t5])e.markDirty()}addSink(e){this[t5].add(e)}removeSink(e){this[t5].delete(e)}asReadonly(){return this}constructor(e){(0,eU._)(this,"equals",void 0),(0,eD._)(this,t,{writable:!0,value:void 0}),(0,eU._)(this,t5,void 0),this.equals=null!=e?e:Object.is,(0,eN._)(this,t,t3()),this[t5]=new Set,this.get=this.get.bind(this),this.subscribe=this.subscribe.bind(this),this.subscribeOnce=this.subscribeOnce.bind(this)}}),nn=(n=new WeakMap,class extends nt{dispose(){super.dispose(),(0,eN._)(this,n,"(disposed)")}get(){return null==t7||t7.add(this),(0,eM._)(this,n)}set(e){t6(()=>{"function"==typeof e&&(e=e((0,eM._)(this,n))),this.equals((0,eM._)(this,n),e)||((0,eN._)(this,n,e),this.markSinksDirty(),t9(this))})}constructor(e,t){super(t),(0,eD._)(this,n,{writable:!0,value:void 0}),(0,eN._)(this,n,e)}}),ni=class extends nn{set(){throw Error("Don't call .set() directly, use .patch()")}patch(e){super.set(t=>ne(t,e))}constructor(e){super(tX(e))}},nr=Symbol(),no=(i=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakSet,class e extends nt{static from(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];let r=n.pop();if("function"!=typeof r&&tH("Invalid .from() call, last argument expected to be a function"),"function"!=typeof n[n.length-1])return new e(n,r);{let t=n.pop();return new e(n,t,r)}}dispose(){for(let e of(0,eM._)(this,o))e.removeSink(this);(0,eN._)(this,i,"(disposed)"),(0,eN._)(this,o,"(disposed)"),(0,eN._)(this,s,"(disposed)"),(0,eN._)(this,a,"(disposed)")}get isDirty(){return(0,eM._)(this,r)}markDirty(){(0,eM._)(this,r)||((0,eN._)(this,r,!0),this.markSinksDirty())}get(){return(0,eM._)(this,r)&&(0,ex._)(this,l,i4).call(this),null==t7||t7.add(this),(0,eM._)(this,i)}[t8](){this.hasWatchers&&(0,ex._)(this,l,i4).call(this)&&super[t8]()}constructor(e,t,n){super(n),(0,eL._)(this,l),(0,eD._)(this,i,{writable:!0,value:void 0}),(0,eD._)(this,r,{writable:!0,value:void 0}),(0,eD._)(this,o,{writable:!0,value:void 0}),(0,eD._)(this,s,{writable:!0,value:void 0}),(0,eD._)(this,a,{writable:!0,value:void 0}),(0,eN._)(this,r,!0),(0,eN._)(this,i,nr),(0,eN._)(this,s,e),(0,eN._)(this,o,new Set),(0,eN._)(this,a,t)}}),ns=(c=new WeakMap,class extends nt{dispose(){super.dispose(),(0,eN._)(this,c,"(disposed)")}get(){return null==t7||t7.add(this),(0,eM._)(this,c)}mutate(e){t6(()=>{let t=!e||e((0,eM._)(this,c));null!==t&&"object"==typeof t&&"then"in t&&tH("MutableSignal.mutate() does not support async callbacks"),!1!==t&&(this.markSinksDirty(),t9(this))})}constructor(e){super(),(0,eD._)(this,c,{writable:!0,value:void 0}),(0,eN._)(this,c,e)}});function na(e,t){return null===t||"object"!=typeof t||Array.isArray(t)?t:Object.keys(t).sort().reduce((e,n)=>(e[n]=t[n],e),{})}function nl(e){return JSON.stringify(e,na)}function nc(e){try{return JSON.stringify(e)}catch(t){throw console.error("Could not stringify: ".concat(t.message)),console.error(e),t}}var nd=class{constructor(e){(0,eU._)(this,"input",void 0),(0,eU._)(this,"resolve",void 0),(0,eU._)(this,"reject",void 0),(0,eU._)(this,"promise",void 0),this.input=e;let{promise:t,resolve:n,reject:i}=t2();this.promise=t,this.resolve=n,this.reject=i}},nu=(d=new WeakMap,u=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,_=new WeakSet,m=new WeakSet,g=new WeakSet,class{get(e){let t=(0,eM._)(this,d).find(t=>nl(t.input)===nl(e));if(t)return t.promise;let n=new nd(e);return(0,eM._)(this,d).push(n),(0,ex._)(this,m,i6).call(this),n.promise}clear(){(0,eN._)(this,d,[]),this.error=!1,(0,ex._)(this,_,i7).call(this)}constructor(e,t){var n;(0,eL._)(this,_),(0,eL._)(this,m),(0,eL._)(this,g),(0,eD._)(this,d,{writable:!0,value:[]}),(0,eD._)(this,u,{writable:!0,value:void 0}),(0,eD._)(this,h,{writable:!0,value:void 0}),(0,eD._)(this,f,{writable:!0,value:void 0}),(0,eD._)(this,p,{writable:!0,value:void 0}),(0,eU._)(this,"error",!1),(0,eN._)(this,u,e),(0,eN._)(this,h,null!=(n=t.size)?n:50),(0,eN._)(this,f,t.delay)}});function nh(e){let t=new ns(new Map);function n(e,n){t.mutate(t=>{t.set(e,n)})}async function i(i){let r=nl(i);if(!t.get().has(r))try{n(r,{isLoading:!0});let t=await e.get(i);n(r,{isLoading:!1,data:t})}catch(e){n(r,{isLoading:!1,error:e})}}return{subscribe:t.subscribe,enqueue:i,getItemState:function(e){let n=nl(e);return t.get().get(n)},invalidate:function(e){t.mutate(t=>{if(Array.isArray(e))for(let n of e)t.delete(nl(n));else t.clear()})},batch:e,_cacheKeys:function(){return[...t.get().keys()]}}}var nf=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;return crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t<63?"_":"-","")};function np(e){return"".concat(e,"_").concat(nf())}function n_(){return np("th")}function nm(){return np("cm")}var ng=(v=new WeakMap,class extends Map{getOrCreate(e,t){if(super.has(e))return super.get(e);{var n;let i=(null!=(n=null!=t?t:(0,eM._)(this,v))?n:tH("DefaultMap used without a factory function"))(e);return this.set(e,i),i}}constructor(e,t){super(t),(0,eD._)(this,v,{writable:!0,value:void 0}),(0,eN._)(this,v,e)}}),nv=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function ny(e){let t=[],n=Object.entries(e),i=[],r=[],o=[];return n.forEach(e=>{let[t,n]=e;if(!nv.test(t))throw Error("Key must only contain letters, numbers, _");nS(n)?i.push([t,n]):tK(n)&&(tq(n)?r.push([t,n]):o.push([t,n]))}),t=[...nb(i),...nw(r)],o.forEach(e=>{let[n,i]=e,r=Object.entries(i),o=[],s=[];r.forEach(e=>{let[t,i]=e;if(nE(t))throw Error("Key cannot be empty");nS(i)?o.push([nI(n,t),i]):tq(i)&&s.push([nI(n,t),i])}),t=[...t,...nb(o),...nw(s)]}),t.map(e=>{let{key:t,operator:n,value:i}=e;return"".concat(t).concat(n).concat(nA(i))}).join(" ")}var nb=e=>{let t=[];return e.forEach(e=>{let[n,i]=e;t.push({key:n,operator:":",value:i})}),t},nw=e=>{let t=[];return e.forEach(e=>{let[n,i]=e;"startsWith"in i&&"string"==typeof i.startsWith&&t.push({key:n,operator:"^",value:i.startsWith})}),t},nS=e=>"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e,nI=(e,t)=>t?"".concat(e,"[").concat(nA(t),"]"):e,nE=e=>!e||""===e.toString().trim();function nA(e){let t=JSON.stringify(e);return"string"!=typeof e||t.includes("'")?t:"'".concat(t.slice(1,-1).replace(/\\"/g,'"'),"'")}function nT(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.reduce((e,t,i)=>{var r;return e+encodeURIComponent(null!=(r=n[i-1])?r:"")+t})}function nk(e){return"public"===e.type?e.publicApiKey:e.token.raw}var nO=(y=new WeakMap,b=new WeakMap,w=new WeakSet,S=new WeakSet,class{async rawGet(e,t,n,i){return await (0,ex._)(this,w,re).call(this,e,t,i,n)}async rawPost(e,t,n){return await (0,ex._)(this,w,re).call(this,e,t,{method:"POST",body:nc(n)})}async rawDelete(e,t){return await (0,ex._)(this,w,re).call(this,e,t,{method:"DELETE"})}async get(e,t,n,i){return await (0,ex._)(this,S,rt).call(this,e,t,i,n)}async post(e,t,n,i,r){return await (0,ex._)(this,S,rt).call(this,e,t,{...i,method:"POST",body:nc(n)},r)}async delete(e,t){return await (0,ex._)(this,S,rt).call(this,e,t,{method:"DELETE"})}async putBlob(e,t,n,i,r){return await (0,ex._)(this,S,rt).call(this,e,t,{...r,method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:n},i)}constructor(e,t){(0,eL._)(this,w),(0,eL._)(this,S),(0,eD._)(this,y,{writable:!0,value:void 0}),(0,eD._)(this,b,{writable:!0,value:void 0}),(0,eN._)(this,y,e),(0,eN._)(this,b,t)}});function nC(e,t){throw Error(t)}function nR(e,t){}function nM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Expected value to be non-nullable";return nR(null!=e,t),e}var nD=(I=new WeakMap,class{get current(){return(0,eM._)(this,I)}allowPatching(e){let t=this,n=!0;e({...(0,eM._)(this,I),patch(e){if(n)for(let n of((0,eN._)(t,I,Object.assign({},(0,eM._)(t,I),e)),Object.entries(e))){let[e,t]=n;"patch"!==e&&(this[e]=t)}else throw Error("Can no longer patch stale context")}}),n=!1}constructor(e){(0,eD._)(this,I,{writable:!0,value:void 0}),(0,eN._)(this,I,e)}}),nN=1,nP=(E=new WeakMap,A=new WeakMap,T=new WeakMap,k=new WeakMap,O=new WeakMap,C=new WeakMap,R=new WeakMap,M=new WeakMap,D=new WeakMap,N=new WeakMap,P=new WeakSet,x=new WeakSet,L=new WeakSet,U=new WeakSet,j=new WeakSet,class{get currentState(){if(null===(0,eM._)(this,k))if(0===(0,eM._)(this,E))throw Error("Not started yet");else throw Error("Already stopped");return(0,eM._)(this,k)}start(){if(0!==(0,eM._)(this,E))throw Error("State machine has already started");return(0,eN._)(this,E,1),(0,eN._)(this,k,(0,eM._)(this,N)),(0,ex._)(this,U,rs).call(this,null),this}stop(){if(1!==(0,eM._)(this,E))throw Error("Cannot stop a state machine that hasn't started yet");(0,ex._)(this,L,ro).call(this,null),(0,eN._)(this,E,2),(0,eN._)(this,k,null)}get context(){return(0,eM._)(this,A).current}addState(e){if(0!==(0,eM._)(this,E))throw Error("Already started");return(0,eM._)(this,T).add(e),this}onEnter(e,t){if(0!==(0,eM._)(this,E))throw Error("Already started");if((0,eM._)(this,M).has(e))throw Error("enter/exit function for ".concat(e," already exists"));return(0,eM._)(this,M).set(e,t),this}onEnterAsync(e,t,n,i,r){return this.onEnter(e,()=>{let e=new AbortController,o=e.signal,s=r?setTimeout(()=>{let e=Error("Timed out");(0,ex._)(this,j,ra).call(this,{type:"ASYNC_ERROR",reason:e},i)},r):void 0,a=!1;return t((0,eM._)(this,A).current,o).then(e=>{o.aborted||(a=!0,(0,ex._)(this,j,ra).call(this,{type:"ASYNC_OK",data:e},n))},e=>{o.aborted||(a=!0,(0,ex._)(this,j,ra).call(this,{type:"ASYNC_ERROR",reason:e},i))}),()=>{clearTimeout(s),a||e.abort()}})}addTransitions(e,t){if(0!==(0,eM._)(this,E))throw Error("Already started");for(let n of(0,ex._)(this,P,ri).call(this,e)){let i=(0,eM._)(this,O).get(n);for(let[r,o]of(void 0===i&&(i=new Map,(0,eM._)(this,O).set(n,i)),Object.entries(t))){if(i.has(r))throw Error('Trying to set transition "'.concat(r,'" on "').concat(n,'" (via "').concat(e,'"), but a transition already exists there.'));let t=o;if((0,eM._)(this,D).add(r),void 0!==t){let e="function"==typeof t?t:()=>t;i.set(r,e)}}}return this}addTimedTransition(e,t,n){return this.onEnter(e,()=>{let e=setTimeout(()=>{(0,ex._)(this,j,ra).call(this,{type:"TIMER"},n)},"function"==typeof t?t((0,eM._)(this,A).current):t);return()=>{clearTimeout(e)}})}send(e){if(!(0,eM._)(this,D).has(e.type))throw Error("Invalid event ".concat(JSON.stringify(e.type)));if(2===(0,eM._)(this,E))return;let t=(0,ex._)(this,x,rr).call(this,e.type);if(void 0!==t)return(0,ex._)(this,j,ra).call(this,e,t);(0,eM._)(this,C).didIgnoreEvent.notify(e)}constructor(e){(0,eD._)(this,N,{get:rn,set:void 0}),(0,eL._)(this,P),(0,eL._)(this,x),(0,eL._)(this,L),(0,eL._)(this,U),(0,eL._)(this,j),(0,eU._)(this,"id",void 0),(0,eD._)(this,E,{writable:!0,value:void 0}),(0,eD._)(this,A,{writable:!0,value:void 0}),(0,eD._)(this,T,{writable:!0,value:void 0}),(0,eD._)(this,k,{writable:!0,value:void 0}),(0,eD._)(this,O,{writable:!0,value:void 0}),(0,eD._)(this,C,{writable:!0,value:void 0}),(0,eU._)(this,"events",void 0),(0,eD._)(this,R,{writable:!0,value:void 0}),(0,eD._)(this,M,{writable:!0,value:void 0}),(0,eD._)(this,D,{writable:!0,value:void 0}),this.id=nN++,(0,eN._)(this,E,0),(0,eN._)(this,k,null),(0,eN._)(this,T,new Set),(0,eN._)(this,M,new Map),(0,eN._)(this,R,[]),(0,eN._)(this,D,new Set),(0,eN._)(this,O,new Map),(0,eN._)(this,A,new nD(e)),(0,eN._)(this,C,{didReceiveEvent:t3(),willTransition:t3(),didIgnoreEvent:t3(),willExitState:t3(),didEnterState:t3()}),this.events={didReceiveEvent:(0,eM._)(this,C).didReceiveEvent.observable,willTransition:(0,eM._)(this,C).willTransition.observable,didIgnoreEvent:(0,eM._)(this,C).didIgnoreEvent.observable,willExitState:(0,eM._)(this,C).willExitState.observable,didEnterState:(0,eM._)(this,C).didEnterState.observable}}}),nx=(e=>(e[e.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",e[e.USER_JOINED=101]="USER_JOINED",e[e.USER_LEFT=102]="USER_LEFT",e[e.BROADCASTED_EVENT=103]="BROADCASTED_EVENT",e[e.ROOM_STATE=104]="ROOM_STATE",e[e.INITIAL_STORAGE_STATE=200]="INITIAL_STORAGE_STATE",e[e.UPDATE_STORAGE=201]="UPDATE_STORAGE",e[e.REJECT_STORAGE_OP=299]="REJECT_STORAGE_OP",e[e.UPDATE_YDOC=300]="UPDATE_YDOC",e[e.THREAD_CREATED=400]="THREAD_CREATED",e[e.THREAD_DELETED=407]="THREAD_DELETED",e[e.THREAD_METADATA_UPDATED=401]="THREAD_METADATA_UPDATED",e[e.THREAD_UPDATED=408]="THREAD_UPDATED",e[e.COMMENT_CREATED=402]="COMMENT_CREATED",e[e.COMMENT_EDITED=403]="COMMENT_EDITED",e[e.COMMENT_DELETED=404]="COMMENT_DELETED",e[e.COMMENT_REACTION_ADDED=405]="COMMENT_REACTION_ADDED",e[e.COMMENT_REACTION_REMOVED=406]="COMMENT_REACTION_REMOVED",e))(nx||{}),nL=(e=>(e[e.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",e[e.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",e[e.UNEXPECTED_CONDITION=1011]="UNEXPECTED_CONDITION",e[e.TRY_AGAIN_LATER=1013]="TRY_AGAIN_LATER",e[e.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",e[e.NOT_ALLOWED=4001]="NOT_ALLOWED",e[e.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",e[e.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",e[e.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",e[e.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",e[e.ROOM_ID_UPDATED=4006]="ROOM_ID_UPDATED",e[e.KICKED=4100]="KICKED",e[e.TOKEN_EXPIRED=4109]="TOKEN_EXPIRED",e[e.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",e))(nL||{});function nU(e){return 4999===e||e>=4e3&&e<4100}function nj(e){return 1013===e||e>=4200&&e<4300}function nW(e){let t=e.currentState;switch(t){case"@ok.connected":case"@ok.awaiting-pong":return"connected";case"@idle.initial":return"initial";case"@auth.busy":case"@auth.backoff":case"@connecting.busy":case"@connecting.backoff":case"@idle.zombie":return e.context.successCount>0?"reconnecting":"connecting";case"@idle.failed":return"disconnected";default:return nC(t,"Unknown state")}}var nV=[250,500,1e3,2e3,4e3,8e3,1e4],nF=nV[0]-1,nK=[2e3,3e4,6e4,3e5],nq=class extends Error{constructor(e){super(e)}};function nH(e,t){var n;return null!=(n=t.find(t=>t>e))?n:t[t.length-1]}function nz(e){e.patch({backoffDelay:nH(e.backoffDelay,nV)})}function nB(e){e.patch({backoffDelay:nH(e.backoffDelay,nK)})}function nG(e){e.patch({successCount:0})}function nY(e,t){let n=2===e?tj:1===e?tU:()=>{};return()=>{n(t)}}function nX(e){let t="Connection to Liveblocks websocket server";return n=>{e instanceof Error?tU("".concat(t," could not be established. ").concat(String(e))):tU(nQ(e)?"".concat(t," closed prematurely (code: ").concat(e.code,"). Retrying in ").concat(n.backoffDelay,"ms."):"".concat(t," could not be established."))}}function nJ(e){let t=["code: ".concat(e.code)];return e.reason&&t.push("reason: ".concat(e.reason)),e=>{tU("Connection to Liveblocks websocket server closed (".concat(t.join(", "),"). Retrying in ").concat(e.backoffDelay,"ms."))}}var nZ=nY(1,"Connection to WebSocket closed permanently. Won't retry.");function nQ(e){return!(e instanceof Error)&&"close"===e.type}var n$=e=>t=>t.patch(e),n0=(W=new WeakMap,V=new WeakMap,class{getStatus(){try{return nW((0,eM._)(this,W))}catch(e){return"initial"}}get authValue(){return(0,eM._)(this,W).context.authValue}connect(){(0,eM._)(this,W).send({type:"CONNECT"})}reconnect(){(0,eM._)(this,W).send({type:"RECONNECT"})}disconnect(){(0,eM._)(this,W).send({type:"DISCONNECT"})}destroy(){let e;for((0,eM._)(this,W).stop();e=(0,eM._)(this,V).pop();)e()}send(e){var t;let n=null==(t=(0,eM._)(this,W).context)?void 0:t.socket;null===n?tU("Cannot send: not connected yet",e):1!==n.readyState?tU("Cannot send: WebSocket no longer open",e):n.send(e)}_privateSendMachineEvent(e){(0,eM._)(this,W).send(e)}constructor(e,t=!1,n=!0){(0,eD._)(this,W,{writable:!0,value:void 0}),(0,eD._)(this,V,{writable:!0,value:void 0}),(0,eU._)(this,"events",void 0);let{machine:i,events:r,cleanups:o}=function(e,t){let n=function(){let e=t3(),t=null;return{...e,notify:function(n){return null!==t?(t.push(n),!1):e.notify(n)},pause:function(){t=[]},unpause:function(){if(null!==t){for(let n of t)e.notify(n);t=null}},dispose(){e.dispose(),null!==t&&(t.length=0)}}}();n.pause();let i=t3();function r(e,t){return()=>{i.notify({message:e,code:t})}}let o=new nP({successCount:0,authValue:null,socket:null,backoffDelay:nF}).addState("@idle.initial").addState("@idle.failed").addState("@idle.zombie").addState("@auth.busy").addState("@auth.backoff").addState("@connecting.busy").addState("@connecting.backoff").addState("@ok.connected").addState("@ok.awaiting-pong");o.addTransitions("*",{RECONNECT:{target:"@auth.backoff",effect:[nz,nG]},DISCONNECT:"@idle.initial"}),o.onEnter("@idle.*",nG).addTransitions("@idle.*",{CONNECT:(e,t)=>null!==t.authValue?"@connecting.busy":"@auth.busy"}),o.addTransitions("@auth.backoff",{NAVIGATOR_ONLINE:{target:"@auth.busy",effect:n$({backoffDelay:nF})}}).addTimedTransition("@auth.backoff",e=>e.backoffDelay,"@auth.busy").onEnterAsync("@auth.busy",()=>tJ(e.authenticate(),1e4,"Timed out during auth"),e=>({target:"@connecting.busy",effect:n$({authValue:e.data})}),e=>e.reason instanceof nq?{target:"@idle.failed",effect:[nY(2,e.reason.message),r(e.reason.message,-1)]}:{target:"@auth.backoff",effect:[nz,nY(2,"Authentication failed: ".concat(e.reason instanceof Error?e.reason.message:String(e.reason)))]});let s=e=>o.send({type:"EXPLICIT_SOCKET_ERROR",event:e}),a=e=>o.send({type:"EXPLICIT_SOCKET_CLOSE",event:e}),l=e=>"pong"===e.data?o.send({type:"PONG"}):n.notify(e);function c(e){e&&(e.removeEventListener("error",s),e.removeEventListener("close",a),e.removeEventListener("message",l),e.close())}o.addTransitions("@connecting.backoff",{NAVIGATOR_ONLINE:{target:"@connecting.busy",effect:n$({backoffDelay:nF})}}).addTimedTransition("@connecting.backoff",e=>e.backoffDelay,"@connecting.busy").onEnterAsync("@connecting.busy",async(n,i)=>{let r=null,o=null;return tJ(new Promise((i,c)=>{if(null===n.authValue)throw Error("No auth authValue");let d=e.createSocket(n.authValue);function u(e){r=e,d.removeEventListener("message",l),c(e)}o=d;let[h,f]=t1();function p(e){let t=tB(e.data);(null==t?void 0:t.type)===104&&f()}t.waitForActorId||f(),d.addEventListener("message",l),t.waitForActorId&&d.addEventListener("message",p),d.addEventListener("error",u),d.addEventListener("close",u),d.addEventListener("open",()=>{d.addEventListener("error",s),d.addEventListener("close",a);let e=()=>{d.removeEventListener("error",u),d.removeEventListener("close",u),d.removeEventListener("message",p)};h.then(()=>{i([d,e])})})}),1e4,"Timed out during websocket connection").then(e=>{let[t,n]=e;if(n(),i.aborted)throw Error("Aborted");if(r)throw r;return t}).catch(e=>{throw c(o),e})},e=>({target:"@ok.connected",effect:n$({socket:e.data,backoffDelay:nF})}),e=>{let t=e.reason;if(t instanceof nq)return{target:"@idle.failed",effect:[nY(2,t.message),r(t.message,-1)]};if(nQ(t)){if(4109===t.code)return"@auth.busy";if(nj(t.code))return{target:"@connecting.backoff",effect:[nB,nX(t)]};if(nU(t.code))return{target:"@idle.failed",effect:[nY(2,t.reason),r(t.reason,t.code)]}}return{target:"@auth.backoff",effect:[nz,nX(t)]}});let d={target:"@ok.awaiting-pong",effect:e=>{var t;null==(t=e.socket)||t.send("ping")}},u=()=>{let t="undefined"!=typeof document?document:void 0;return(null==t?void 0:t.visibilityState)==="hidden"&&e.canZombie()?"@idle.zombie":d};if(o.addTimedTransition("@ok.connected",3e4,u).addTransitions("@ok.connected",{NAVIGATOR_OFFLINE:u,WINDOW_GOT_FOCUS:d}),o.addTransitions("@idle.zombie",{WINDOW_GOT_FOCUS:"@connecting.backoff"}),o.onEnter("@ok.*",e=>{e.patch({successCount:e.successCount+1});let t=setTimeout(n.unpause,0);return e=>{c(e.socket),e.patch({socket:null}),clearTimeout(t),n.pause()}}).addTransitions("@ok.awaiting-pong",{PONG:"@ok.connected"}).addTimedTransition("@ok.awaiting-pong",2e3,{target:"@connecting.busy",effect:nY(1,"Received no pong from server, assume implicit connection loss.")}).addTransitions("@ok.*",{EXPLICIT_SOCKET_ERROR:(e,t)=>{var n;return(null==(n=t.socket)?void 0:n.readyState)===1?null:{target:"@connecting.backoff",effect:nz}},EXPLICIT_SOCKET_CLOSE:e=>{var t;if(nU(e.event.code))return{target:"@idle.failed",effect:[nZ,r(e.event.reason,e.event.code)]};if((t=e.event.code)>=4100&&t<4200)if(4109===e.event.code)return"@auth.busy";else return{target:"@auth.backoff",effect:[nz,nJ(e.event)]};return nj(e.event.code)?{target:"@connecting.backoff",effect:[nB,nJ(e.event)]}:{target:"@connecting.backoff",effect:[nz,nJ(e.event)]}}}),"undefined"!=typeof document){let e="undefined"!=typeof document?document:void 0,t="undefined"!=typeof window?window:void 0,n=null!=t?t:e;o.onEnter("*",i=>{function r(){o.send({type:"NAVIGATOR_OFFLINE"})}function s(){o.send({type:"NAVIGATOR_ONLINE"})}function a(){(null==e?void 0:e.visibilityState)==="visible"&&o.send({type:"WINDOW_GOT_FOCUS"})}return null==t||t.addEventListener("online",s),null==t||t.addEventListener("offline",r),null==n||n.addEventListener("visibilitychange",a),()=>{null==n||n.removeEventListener("visibilitychange",a),null==t||t.removeEventListener("online",s),null==t||t.removeEventListener("offline",r),c(i.socket)}})}let h=[],{statusDidChange:f,didConnect:p,didDisconnect:_,unsubscribe:m}=function(e){let t=t3(),n=t3(),i=t3(),r=null,o=e.events.didEnterState.subscribe(()=>{let o=nW(e);o!==r&&t.notify(o),"connected"===r&&"connected"!==o?i.notify():"connected"!==r&&"connected"===o&&n.notify(),r=o});return{statusDidChange:t.observable,didConnect:n.observable,didDisconnect:i.observable,unsubscribe:o}}(o);return h.push(m),t.enableDebugLogging&&h.push(function(e){let t=new Date().getTime();function n(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];tU("".concat(((new Date().getTime()-t)/1e3).toFixed(2)," [FSM #").concat(e.id,"]"),...i)}let i=[e.events.didReceiveEvent.subscribe(e=>n("Event ".concat(e.type))),e.events.willTransition.subscribe(e=>{let{from:t,to:i}=e;return n("Transitioning",t,"â†’",i)}),e.events.didIgnoreEvent.subscribe(e=>n("Ignored event",e.type,e,"(current state won't handle it)"))];return()=>{for(let e of i)e()}}(o)),o.start(),{machine:o,cleanups:h,events:{statusDidChange:f,didConnect:p,didDisconnect:_,onMessage:n.observable,onConnectionError:i.observable}}}(e,{waitForActorId:n,enableDebugLogging:t});(0,eN._)(this,W,i),this.events=r,(0,eN._)(this,V,o)}}),n1=(e=>(e.Read="room:read",e.Write="room:write",e.PresenceWrite="room:presence:write",e.CommentsWrite="comments:write",e.CommentsRead="comments:read",e))(n1||{});function n2(e){return e.includes("room:write")}function n3(e){return e.includes("comments:write")||e.includes("room:write")}function n5(e){var t;let n=e.split(".");if(3!==n.length)throw Error("Authentication error: invalid JWT token");let i=tB(function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(t){return atob(e)}}(n[1]));if(!(i&&tK(t=i)&&("acc"===t.k||"id"===t.k||"sec-legacy"===t.k)))throw Error("Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback");return{raw:e,parsed:i}}async function n8(e,t,n){let i,r=await e(t,{method:"POST",headers:{"Content-Type":"application/json"},body:nc(n)});if(!r.ok){let e="".concat((await r.text()).trim()||"reason not provided in auth response"," (").concat(r.status," returned by POST ").concat(t,")");if(401===r.status||403===r.status)throw new nq("Unauthorized: ".concat(e));throw Error("Failed to authenticate: ".concat(e))}try{i=await r.json()}catch(e){throw Error('Expected a JSON response when doing a POST request on "'.concat(t,'". ').concat(String(e)))}if(!tK(i)||"string"!=typeof i.token)throw Error('Expected a JSON response of the form `{ token: "..." }` when doing a POST request on "'.concat(t,'", but got ').concat(nc(i)));let{token:o}=i;return{token:o}}var n4=Symbol();t3().observable,Date.now();var n7=Symbol("notification-settings-plain");function n6(e){let t={[n7]:{value:e,enumerable:!1}};for(let e of["email","slack","teams","webPush"])t[e]={enumerable:!0,get(){let t=this[n7][e];return void 0===t?(tj("In order to use the '".concat(e,"' channel, please set up your project first. For more information: https://liveblocks.io/docs/errors/enable-a-notification-channel")),null):t}};return void 0!==t?Object.create(null,t):Object.create(null)}function n9(e,t){let n=n6({...e[n7]});for(let e of Object.keys(t)){let i=t[e];if(void 0!==i){let t=Object.fromEntries(tz(i).filter(e=>{let[,t]=e;return void 0!==t}));n[n7][e]={...n[n7][e],...t}}}return n}var ie=ir(0),it=ir(1),ii=ie+ir(-1);function ir(e){let t=32+(e<0?95+e:e);if(t<32||t>126)throw Error("Invalid n value: ".concat(e));return String.fromCharCode(t)}function io(e,t){if(void 0!==e&&void 0!==t){var n=e,i=t;if(n<i)return is(n,i);if(n>i)return is(i,n);throw Error("Cannot compute value between two equal positions")}if(void 0!==e){var r=e;for(let e=0;e<=r.length-1;e++){let t=r.charCodeAt(e);if(!(t>=126))return r.substring(0,e)+String.fromCharCode(t+1)}return r+it}if(void 0===t)return it;{var o=t;let e=o.length-1;for(let t=0;t<=e;t++){let n=o.charCodeAt(t);if(!(n<=32))if(t!==e)return o.substring(0,t+1);else if(33===n)return o.substring(0,t)+ii;else return o.substring(0,t)+String.fromCharCode(n-1)}return it}}function is(e,t){let n=0,i=e.length,r=t.length;for(;;){let a=n<i?e.charCodeAt(n):32,l=n<r?t.charCodeAt(n):126;if(a===l){n++;continue}if(l-a!=1){var o,s;return o=e,((s=n)<o.length?o.substring(0,s):o+ie.repeat(s-o.length))+String.fromCharCode(l+a>>1)}{let t=n+1,i=e.substring(0,t);return i.length<t&&(i+=ie.repeat(t-i.length)),i+is(e.substring(t),"")}}}function ia(e){return!function(e){if(""===e)return!1;let t=e.length-1,n=e.charCodeAt(t);if(n<33||n>126)return!1;for(let n=0;n<t;n++){let t=e.charCodeAt(n);if(t<32||t>126)return!1}return!0}(e)?function(e){let t=[];for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t.push(i<32?32:i>126?126:i)}for(;t.length>0&&32===t[t.length-1];)t.length--;return t.length>0?String.fromCharCode(...t):it}(e):e}var il=(e=>(e[e.INIT=0]="INIT",e[e.SET_PARENT_KEY=1]="SET_PARENT_KEY",e[e.CREATE_LIST=2]="CREATE_LIST",e[e.UPDATE_OBJECT=3]="UPDATE_OBJECT",e[e.CREATE_OBJECT=4]="CREATE_OBJECT",e[e.DELETE_CRDT=5]="DELETE_CRDT",e[e.DELETE_OBJECT_KEY=6]="DELETE_OBJECT_KEY",e[e.CREATE_MAP=7]="CREATE_MAP",e[e.CREATE_REGISTER=8]="CREATE_REGISTER",e))(il||{});function ic(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ia(t);return Object.freeze({type:"HasParent",node:e,key:t,pos:n})}var id=Object.freeze({type:"NoParent"}),iu=(F=new WeakMap,K=new WeakMap,q=new WeakMap,H=new WeakMap,z=new WeakMap,B=new WeakMap,class{_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return nC(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return nC(this.parent,"Unknown state")}}get _pool(){return(0,eM._)(this,F)}get roomId(){return(0,eM._)(this,F)?(0,eM._)(this,F).roomId:null}get _id(){return(0,eM._)(this,K)}get parent(){return(0,eM._)(this,q)}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return nC(this.parent,"Unknown state")}}_apply(e,t){if(5===e.type&&"HasParent"===this.parent.type)return this.parent.node._detachChild(this);return{modified:!1}}_setParentLink(e,t){switch(this.parent.type){case"HasParent":if(this.parent.node===e)return void(0,eN._)(this,q,ic(e,t));throw Error("Cannot set parent: node already has a parent");case"Orphaned":case"NoParent":return void(0,eN._)(this,q,ic(e,t));default:return nC(this.parent,"Unknown state")}}_attach(e,t){if((0,eM._)(this,K)||(0,eM._)(this,F))throw Error("Cannot attach node: already attached");t.addNode(e,this),(0,eN._)(this,K,e),(0,eN._)(this,F,t)}_detach(){switch((0,eM._)(this,F)&&(0,eM._)(this,K)&&(0,eM._)(this,F).deleteNode((0,eM._)(this,K)),this.parent.type){case"HasParent":(0,eN._)(this,q,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ia(e);return Object.freeze({type:"Orphaned",oldKey:e,oldPos:t})}(this.parent.key,this.parent.pos));break;case"NoParent":(0,eN._)(this,q,id);break;case"Orphaned":break;default:nC(this.parent,"Unknown state")}(0,eN._)(this,F,void 0)}invalidate(){(void 0!==(0,eM._)(this,H)||void 0!==(0,eM._)(this,B))&&((0,eN._)(this,H,void 0),(0,eN._)(this,B,void 0),"HasParent"===this.parent.type&&this.parent.node.invalidate())}toTreeNode(e){return(void 0===(0,eM._)(this,B)||(0,eM._)(this,z)!==e)&&((0,eN._)(this,z,e),(0,eN._)(this,B,this._toTreeNode(e))),(0,eM._)(this,B)}toImmutable(){return void 0===(0,eM._)(this,H)&&(0,eN._)(this,H,this._toImmutable()),(0,eM._)(this,H)}constructor(){(0,eD._)(this,F,{writable:!0,value:void 0}),(0,eD._)(this,K,{writable:!0,value:void 0}),(0,eD._)(this,q,{writable:!0,value:id}),(0,eD._)(this,H,{writable:!0,value:void 0}),(0,eD._)(this,z,{writable:!0,value:void 0}),(0,eD._)(this,B,{writable:!0,value:void 0})}}),ih=(e=>(e[e.OBJECT=0]="OBJECT",e[e.LIST=1]="LIST",e[e.MAP=2]="MAP",e[e.REGISTER=3]="REGISTER",e))(ih||{}),ip=(G=new WeakMap,class e extends iu{get data(){return(0,eM._)(this,G)}static _deserialize(t,n,i){let[r,o]=t,s=new e(o.data);return s._attach(r,i),s}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:8,opId:null==n?void 0:n.generateOpId(),id:this._id,parentId:e,parentKey:t,data:this.data}]}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveRegister if parent is missing");return{type:3,parentId:nM(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(e){throw Error("Method not implemented.")}_detachChild(e){throw Error("Method not implemented.")}_apply(e,t){return super._apply(e,t)}_toTreeNode(e){var t;return{type:"Json",id:null!=(t=this._id)?t:nf(),key:e,payload:(0,eM._)(this,G)}}_toImmutable(){return(0,eM._)(this,G)}clone(){return tG(this.data)}constructor(e){super(),(0,eD._)(this,G,{writable:!0,value:void 0}),(0,eN._)(this,G,e)}});function i_(e,t){let n=e._parentPos,i=t._parentPos;return n===i?0:n<i?-1:1}var im=(Y=new WeakMap,X=new WeakMap,J=new WeakMap,Z=new WeakSet,Q=new WeakSet,$=new WeakSet,ee=new WeakSet,et=new WeakSet,en=new WeakSet,ei=new WeakSet,er=new WeakSet,eo=new WeakSet,es=new WeakSet,ea=new WeakSet,el=new WeakSet,class e extends iu{static _deserialize(t,n,i){let[r]=t,o=new e([]);o._attach(r,i);let s=n.get(r);if(void 0===s)return o;for(let[e,t]of s){let r=iO([e,t],n,i);r._setParentLink(o,t.parentKey),o._insertAndSort(r)}return o}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=[],r={id:this._id,opId:null==n?void 0:n.generateOpId(),type:2,parentId:e,parentKey:t};for(let e of(i.push(r),(0,eM._)(this,Y))){let t=e._getParentKeyOrThrow(),r=iI(e._toOps(this._id,t,n),void 0),o=r[0].opId;void 0!==o&&(0,eM._)(this,J).set(t,o),i.push(...r)}return i}_insertAndSort(e){(0,eM._)(this,Y).push(e),this._sortItems()}_sortItems(){(0,eM._)(this,Y).sort(i_),this.invalidate()}_indexOfPosition(e){return(0,eM._)(this,Y).findIndex(t=>t._getParentKeyOrThrow()===e)}_attach(e,t){for(let n of(super._attach(e,t),(0,eM._)(this,Y)))n._attach(t.generateId(),t)}_detach(){for(let e of(super._detach(),(0,eM._)(this,Y)))e._detach()}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");return!1!==(n="set"===e.intent?1===t?(0,ex._)(this,Z,rl).call(this,e):2===t?(0,ex._)(this,Q,rc).call(this,e):(0,ex._)(this,ei,rp).call(this,e):1===t?(0,ex._)(this,ee,ru).call(this,e):2===t?(0,ex._)(this,et,rh).call(this,e):(0,ex._)(this,en,rf).call(this,e)).modified&&this.invalidate(),n}_detachChild(e){if(e){let t=nM(e._parentKey),n=e._toOps(nM(this._id),t,this._pool),i=(0,eM._)(this,Y).indexOf(e);if(-1===i)return{modified:!1};let[r]=(0,eM._)(this,Y).splice(i,1);return this.invalidate(),e._detach(),{modified:iv(this,[ib(i,r)]),reverse:n}}return{modified:!1}}_setChildKey(e,t,n){return 1===n?(0,ex._)(this,er,r_).call(this,e,t):2===n?(0,ex._)(this,eo,rm).call(this,e,t):(0,ex._)(this,es,rg).call(this,e,t)}_apply(e,t){return super._apply(e,t)}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveList if parent is missing");return{type:1,parentId:nM(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return(0,eM._)(this,Y).length}push(e){var t;return null==(t=this._pool)||t.assertStorageIsWritable(),this.insert(e,this.length)}insert(e,t){var n;if(null==(n=this._pool)||n.assertStorageIsWritable(),t<0||t>(0,eM._)(this,Y).length)throw Error('Cannot insert list item at index "\x1d'.concat(t,'". index should be between 0 and ').concat((0,eM._)(this,Y).length));let i=io((0,eM._)(this,Y)[t-1]?(0,eM._)(this,Y)[t-1]._parentPos:void 0,(0,eM._)(this,Y)[t]?(0,eM._)(this,Y)[t]._parentPos:void 0),r=iN(e);if(r._setParentLink(this,i),this._insertAndSort(r),this._pool&&this._id){let e=this._pool.generateId();r._attach(e,this._pool),this._pool.dispatch(r._toOps(this._id,i,this._pool),[{type:5,id:e}],new Map([[this._id,iv(this,[iw(t,r)])]]))}}move(e,t){var n;if(null==(n=this._pool)||n.assertStorageIsWritable(),t<0)throw Error("targetIndex cannot be less than 0");if(t>=(0,eM._)(this,Y).length)throw Error("targetIndex cannot be greater or equal than the list length");if(e<0)throw Error("index cannot be less than 0");if(e>=(0,eM._)(this,Y).length)throw Error("index cannot be greater or equal than the list length");let i=null,r=null;e<t?(r=t===(0,eM._)(this,Y).length-1?void 0:(0,eM._)(this,Y)[t+1]._parentPos,i=(0,eM._)(this,Y)[t]._parentPos):(r=(0,eM._)(this,Y)[t]._parentPos,i=0===t?void 0:(0,eM._)(this,Y)[t-1]._parentPos);let o=io(i,r),s=(0,eM._)(this,Y)[e],a=s._getParentKeyOrThrow();if(s._setParentLink(this,o),this._sortItems(),this._pool&&this._id){let n=new Map([[this._id,iv(this,[iS(e,t,s)])]]);this._pool.dispatch([{type:1,id:nM(s._id),opId:this._pool.generateOpId(),parentKey:o}],[{type:1,id:nM(s._id),parentKey:a}],n)}}delete(e){var t;if(null==(t=this._pool)||t.assertStorageIsWritable(),e<0||e>=(0,eM._)(this,Y).length)throw Error('Cannot delete list item at index "'.concat(e,'". index should be between 0 and ').concat((0,eM._)(this,Y).length-1));let n=(0,eM._)(this,Y)[e];n._detach();let[i]=(0,eM._)(this,Y).splice(e,1);if(this.invalidate(),this._pool){let t=n._id;if(t){let r=new Map;r.set(nM(this._id),iv(this,[ib(e,i)])),this._pool.dispatch([{id:t,opId:this._pool.generateOpId(),type:5}],n._toOps(nM(this._id),n._getParentKeyOrThrow()),r)}}}clear(){var e;if(null==(e=this._pool)||e.assertStorageIsWritable(),this._pool){let e=[],t=[],n=[];for(let i of(0,eM._)(this,Y)){i._detach();let r=i._id;r&&(e.push({type:5,id:r,opId:this._pool.generateOpId()}),t.push(...i._toOps(nM(this._id),i._getParentKeyOrThrow())),n.push(ib(0,i)))}(0,eN._)(this,Y,[]),this.invalidate();let i=new Map;i.set(nM(this._id),iv(this,n)),this._pool.dispatch(e,t,i)}else{for(let e of(0,eM._)(this,Y))e._detach();(0,eN._)(this,Y,[]),this.invalidate()}}set(e,t){var n;if(null==(n=this._pool)||n.assertStorageIsWritable(),e<0||e>=(0,eM._)(this,Y).length)throw Error('Cannot set list item at index "\x1d'.concat(e,'". index should be between 0 and ').concat((0,eM._)(this,Y).length-1));let i=(0,eM._)(this,Y)[e],r=i._getParentKeyOrThrow(),o=i._id;i._detach();let s=iN(t);if(s._setParentLink(this,r),(0,eM._)(this,Y)[e]=s,this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();s._attach(t,this._pool);let n=new Map;n.set(this._id,iv(this,[iy(e,s)]));let a=iI(s._toOps(this._id,r,this._pool),o);(0,eM._)(this,J).set(r,nM(a[0].opId));let l=iI(i._toOps(this._id,r,void 0),t);this._pool.dispatch(a,l,n)}}toArray(){return(0,eM._)(this,Y).map(e=>iD(e))}every(e){return this.toArray().every(e)}filter(e){return this.toArray().filter(e)}find(e){return this.toArray().find(e)}findIndex(e){return this.toArray().findIndex(e)}forEach(e){return this.toArray().forEach(e)}get(e){if(!(e<0)&&!(e>=(0,eM._)(this,Y).length))return iD((0,eM._)(this,Y)[e])}indexOf(e,t){return this.toArray().indexOf(e,t)}lastIndexOf(e,t){return this.toArray().lastIndexOf(e,t)}map(e){return(0,eM._)(this,Y).map((t,n)=>e(iD(t),n))}some(e){return this.toArray().some(e)}[Symbol.iterator](){return new ig((0,eM._)(this,Y))}_toTreeNode(e){var t;return{type:"LiveList",id:null!=(t=this._id)?t:nf(),key:e,payload:(0,eM._)(this,Y).map((e,t)=>e.toTreeNode(t.toString()))}}toImmutable(){return super.toImmutable()}_toImmutable(){return(0,eM._)(this,Y).map(e=>e.toImmutable())}clone(){return new e((0,eM._)(this,Y).map(e=>e.clone()))}constructor(e){let t;for(let n of(super(),(0,eL._)(this,Z),(0,eL._)(this,Q),(0,eL._)(this,$),(0,eL._)(this,ee),(0,eL._)(this,et),(0,eL._)(this,en),(0,eL._)(this,ei),(0,eL._)(this,er),(0,eL._)(this,eo),(0,eL._)(this,es),(0,eL._)(this,ea),(0,eL._)(this,el),(0,eD._)(this,Y,{writable:!0,value:void 0}),(0,eD._)(this,X,{writable:!0,value:void 0}),(0,eD._)(this,J,{writable:!0,value:void 0}),(0,eN._)(this,Y,[]),(0,eN._)(this,X,new WeakSet),(0,eN._)(this,J,new Map),e)){let e=io(t),i=iN(n);i._setParentLink(this,e),(0,eM._)(this,Y).push(i),t=e}}}),ig=(ec=new WeakMap,class{[Symbol.iterator](){return this}next(){let e=(0,eM._)(this,ec).next();return e.done?{done:!0,value:void 0}:{value:iD(e.value)}}constructor(e){(0,eD._)(this,ec,{writable:!0,value:void 0}),(0,eN._)(this,ec,e[Symbol.iterator]())}});function iv(e,t){return{node:e,type:"LiveList",updates:t}}function iy(e,t){return{index:e,type:"set",item:t instanceof ip?t.data:t}}function ib(e,t){return{type:"delete",index:e,deletedItem:t instanceof ip?t.data:t}}function iw(e,t){return{index:e,type:"insert",item:t instanceof ip?t.data:t}}function iS(e,t,n){return{type:"move",index:t,item:n instanceof ip?n.data:n,previousIndex:e}}function iI(e,t){return e.map((e,n)=>0===n?{...e,intent:"set",deletedId:t}:e)}var iE=(ed=new WeakMap,eu=new WeakMap,class e extends iu{_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=[],r={id:this._id,opId:null==n?void 0:n.generateOpId(),type:7,parentId:e,parentKey:t};for(let[e,t]of(i.push(r),(0,eM._)(this,ed)))i.push(...t._toOps(this._id,e,n));return i}static _deserialize(t,n,i){let[r,o]=t,s=new e;s._attach(r,i);let a=n.get(r);if(void 0===a)return s;for(let[e,t]of a){let r=iO([e,t],n,i);r._setParentLink(s,t.parentKey),(0,eM._)(s,ed).set(t.parentKey,r),s.invalidate()}return s}_attach(e,t){for(let[n,i]of(super._attach(e,t),(0,eM._)(this,ed)))iR(i)&&i._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:i,parentKey:r,opId:o}=e,s=iT(e);if(void 0!==this._pool.getNode(i))return{modified:!1};if(2===t){let e=(0,eM._)(this,eu).get(r);if(e===o)return(0,eM._)(this,eu).delete(r),{modified:!1};if(void 0!==e)return{modified:!1}}else 1===t&&(0,eM._)(this,eu).delete(r);let a=(0,eM._)(this,ed).get(r);if(a){let e=nM(this._id);n=a._toOps(e,r),a._detach()}else n=[{type:5,id:i}];return s._setParentLink(this,r),s._attach(i,this._pool),(0,eM._)(this,ed).set(r,s),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[r]:{type:"update"}}},reverse:n}}_detach(){for(let e of(super._detach(),(0,eM._)(this,ed).values()))e._detach()}_detachChild(e){let t=nM(this._id),n=nM(e._parentKey),i=e._toOps(t,n,this._pool);for(let[t,n]of(0,eM._)(this,ed))n===e&&((0,eM._)(this,ed).delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveMap",updates:{[n]:{type:"delete"}}},reverse:i}}_serialize(){if("HasParent"!==this.parent.type)throw Error("Cannot serialize LiveMap if parent is missing");return{type:2,parentId:nM(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(e){let t=(0,eM._)(this,ed).get(e);if(void 0!==t)return iD(t)}set(e,t){var n;null==(n=this._pool)||n.assertStorageIsWritable();let i=(0,eM._)(this,ed).get(e);i&&i._detach();let r=iN(t);if(r._setParentLink(this,e),(0,eM._)(this,ed).set(e,r),this.invalidate(),this._pool&&this._id){let t=this._pool.generateId();r._attach(t,this._pool);let n=new Map;n.set(this._id,{node:this,type:"LiveMap",updates:{[e]:{type:"update"}}});let o=r._toOps(this._id,e,this._pool);(0,eM._)(this,eu).set(e,nM(o[0].opId)),this._pool.dispatch(r._toOps(this._id,e,this._pool),i?i._toOps(this._id,e):[{type:5,id:t}],n)}}get size(){return(0,eM._)(this,ed).size}has(e){return(0,eM._)(this,ed).has(e)}delete(e){var t;null==(t=this._pool)||t.assertStorageIsWritable();let n=(0,eM._)(this,ed).get(e);if(void 0===n)return!1;if(n._detach(),(0,eM._)(this,ed).delete(e),this.invalidate(),this._pool&&n._id){let t=nM(this._id),i=new Map;i.set(t,{node:this,type:"LiveMap",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:5,id:n._id,opId:this._pool.generateOpId()}],n._toOps(t,e),i)}return!0}entries(){let e=(0,eM._)(this,ed).entries();return{[Symbol.iterator](){return this},next(){let t=e.next();return t.done?{done:!0,value:void 0}:{value:[t.value[0],iD(t.value[1])]}}}}[Symbol.iterator](){return this.entries()}keys(){return(0,eM._)(this,ed).keys()}values(){let e=(0,eM._)(this,ed).values();return{[Symbol.iterator](){return this},next(){let t=e.next();return t.done?{done:!0,value:void 0}:{value:iD(t.value)}}}}forEach(e){for(let t of this)e(t[1],t[0],this)}_toTreeNode(e){var t;return{type:"LiveMap",id:null!=(t=this._id)?t:nf(),key:e,payload:Array.from((0,eM._)(this,ed).entries()).map(e=>{let[t,n]=e;return n.toTreeNode(t)})}}toImmutable(){return super.toImmutable()}_toImmutable(){let e=new Map;for(let[t,n]of(0,eM._)(this,ed))e.set(t,n.toImmutable());return e}clone(){return new e(Array.from((0,eM._)(this,ed)).map(e=>{let[t,n]=e;return[t,n.clone()]}))}constructor(e){if(super(),(0,eD._)(this,ed,{writable:!0,value:void 0}),(0,eD._)(this,eu,{writable:!0,value:void 0}),(0,eN._)(this,eu,new Map),e){let t=[];for(let[n,i]of e){let e=iN(i);e._setParentLink(this,n),t.push([n,e])}(0,eN._)(this,ed,new Map(t))}else(0,eN._)(this,ed,new Map)}}),iA=(eh=new WeakMap,ef=new WeakMap,ep=new WeakSet,e_=new WeakSet,em=class e extends iu{static _fromItems(t,n){let[i,r]=(0,eW._)(e,em,rb).call(em,t);return e._deserialize(i,r,n)}_toOps(e,t,n){if(void 0===this._id)throw Error("Cannot serialize item is not attached");let i=null==n?void 0:n.generateOpId(),r=[],o={type:4,id:this._id,opId:i,parentId:e,parentKey:t,data:{}};for(let[e,t]of(r.push(o),(0,eM._)(this,eh)))iR(t)?r.push(...t._toOps(this._id,e,n)):o.data[e]=t;return r}static _deserialize(t,n,i){let[r,o]=t,s=new e(o.data);return s._attach(r,i),this._deserializeChildren(s,n,i)}static _deserializeChildren(e,t,n){let i=t.get(nM(e._id));if(void 0===i)return e;for(let[r,o]of i){let i=function(e,t,n){let[i,r]=e;switch(r.type){case 0:return iA._deserialize([i,r],t,n);case 1:return im._deserialize([i,r],t,n);case 2:return iE._deserialize([i,r],t,n);case 3:return r.data;default:throw Error("Unexpected CRDT type")}}([r,o],t,n);iC(i)&&i._setParentLink(e,o.parentKey),(0,eM._)(e,eh).set(o.parentKey,i),e.invalidate()}return e}_attach(e,t){for(let[n,i]of(super._attach(e,t),(0,eM._)(this,eh)))iR(i)&&i._attach(t.generateId(),t)}_attachChild(e,t){let n;if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:i,opId:r,parentKey:o}=e,s=ik(e);if(void 0!==this._pool.getNode(i))return(0,eM._)(this,ef).get(o)===r&&(0,eM._)(this,ef).delete(o),{modified:!1};if(0===t)(0,eM._)(this,ef).set(o,nM(r));else if(void 0===(0,eM._)(this,ef).get(o));else if((0,eM._)(this,ef).get(o)===r)return(0,eM._)(this,ef).delete(o),{modified:!1};else return{modified:!1};let a=nM(this._id),l=(0,eM._)(this,eh).get(o);return iR(l)?(n=l._toOps(a,o),l._detach()):n=void 0===l?[{type:6,id:a,key:o}]:[{type:3,id:a,data:{[o]:l}}],(0,eM._)(this,eh).set(o,s),this.invalidate(),iC(s)&&(s._setParentLink(this,o),s._attach(i,this._pool)),{reverse:n,modified:{node:this,type:"LiveObject",updates:{[o]:{type:"update"}}}}}_detachChild(e){if(e){let t=nM(this._id),n=nM(e._parentKey),i=e._toOps(t,n,this._pool);for(let[t,n]of(0,eM._)(this,eh))n===e&&((0,eM._)(this,eh).delete(t),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveObject",updates:{[n]:{type:"delete"}}},reverse:i}}return{modified:!1}}_detach(){for(let e of(super._detach(),(0,eM._)(this,eh).values()))iR(e)&&e._detach()}_apply(e,t){return 3===e.type?(0,ex._)(this,ep,rw).call(this,e,t):6===e.type?(0,ex._)(this,e_,rS).call(this,e,t):super._apply(e,t)}_serialize(){let e={};for(let[t,n]of(0,eM._)(this,eh))iR(n)||(e[t]=n);return"HasParent"===this.parent.type&&this.parent.node._id?{type:0,parentId:this.parent.node._id,parentKey:this.parent.key,data:e}:{type:0,data:e}}toObject(){return Object.fromEntries((0,eM._)(this,eh))}set(e,t){var n;null==(n=this._pool)||n.assertStorageIsWritable(),this.update({[e]:t})}get(e){return(0,eM._)(this,eh).get(e)}delete(e){var t;let n;null==(t=this._pool)||t.assertStorageIsWritable();let i=(0,eM._)(this,eh).get(e);if(void 0===i)return;if(void 0===this._pool||void 0===this._id){iR(i)&&i._detach(),(0,eM._)(this,eh).delete(e),this.invalidate();return}iR(i)?(i._detach(),n=i._toOps(this._id,e)):n=[{type:3,data:{[e]:i},id:this._id}],(0,eM._)(this,eh).delete(e),this.invalidate();let r=new Map;r.set(this._id,{node:this,type:"LiveObject",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:6,key:e,id:this._id,opId:this._pool.generateOpId()}],n,r)}update(e){var t;if(null==(t=this._pool)||t.assertStorageIsWritable(),void 0===this._pool||void 0===this._id){for(let t in e){let n=e[t];if(void 0===n)continue;let i=(0,eM._)(this,eh).get(t);iR(i)&&i._detach(),iR(n)&&n._setParentLink(this,t),(0,eM._)(this,eh).set(t,n),this.invalidate()}return}let n=[],i=[],r=this._pool.generateOpId(),o={},s={id:this._id,type:3,data:{}},a={};for(let t in e){let l=e[t];if(void 0===l)continue;let c=(0,eM._)(this,eh).get(t);if(iR(c)?(i.push(...c._toOps(this._id,t)),c._detach()):void 0===c?i.push({type:6,id:this._id,key:t}):s.data[t]=c,iR(l)){l._setParentLink(this,t),l._attach(this._pool.generateId(),this._pool);let e=l._toOps(this._id,t,this._pool),i=e.find(e=>e.parentId===this._id);i&&(0,eM._)(this,ef).set(t,nM(i.opId)),n.push(...e)}else o[t]=l,(0,eM._)(this,ef).set(t,r);(0,eM._)(this,eh).set(t,l),this.invalidate(),a[t]={type:"update"}}0!==Object.keys(s.data).length&&i.unshift(s),0!==Object.keys(o).length&&n.unshift({opId:r,id:this._id,type:3,data:o});let l=new Map;l.set(this._id,{node:this,type:"LiveObject",updates:a}),this._pool.dispatch(n,i,l)}toImmutable(){return super.toImmutable()}toTreeNode(e){return super.toTreeNode(e)}_toTreeNode(e){var t;let n=null!=(t=this._id)?t:nf();return{type:"LiveObject",id:n,key:e,payload:Array.from((0,eM._)(this,eh).entries()).map(e=>{let[t,i]=e;return iR(i)?i.toTreeNode(t):{type:"Json",id:"".concat(n,":").concat(t),key:t,payload:i}})}}_toImmutable(){let e={};for(let[t,n]of(0,eM._)(this,eh))e[t]=iC(n)?n.toImmutable():n;return e}clone(){return new e(Object.fromEntries(Array.from((0,eM._)(this,eh)).map(e=>{let[t,n]=e;return[t,iC(n)?n.clone():tG(n)]})))}constructor(e={}){super(),(0,eL._)(this,ep),(0,eL._)(this,e_),(0,eD._)(this,eh,{writable:!0,value:void 0}),(0,eD._)(this,ef,{writable:!0,value:void 0}),(0,eN._)(this,ef,new Map);let t=tX(e);for(let e of Object.keys(t)){let n=t[e];iR(n)&&n._setParentLink(this,e)}(0,eN._)(this,eh,new Map(Object.entries(t)))}});function iT(e){return iN(ik(e))}function ik(e){switch(e.type){case 8:return e.data;case 4:return new iA(e.data);case 7:return new iE;case 2:return new im([]);default:return nC(e,"Unknown creation Op")}}function iO(e,t,n){let[i,r]=e;switch(r.type){case 0:return iA._deserialize([i,r],t,n);case 1:return im._deserialize([i,r],t,n);case 2:return iE._deserialize([i,r],t,n);case 3:return ip._deserialize([i,r],t,n);default:throw Error("Unexpected CRDT type")}}function iC(e){return iM(e)||e instanceof iE||e instanceof iA}function iR(e){return iC(e)||e instanceof ip}function iM(e){return e instanceof im}function iD(e){return e instanceof ip?e.data:e instanceof im||e instanceof iE||e instanceof iA?e:nC(e,"Unknown AbstractCrdt")}function iN(e){return e instanceof iA||e instanceof iE||e instanceof im?e:new ip(e)}function iP(e,t){if(void 0===e)return t;if("LiveObject"===e.type&&"LiveObject"===t.type||"LiveMap"===e.type&&"LiveMap"===t.type){let n=e.updates;for(let[e,i]of tz(t.updates))n[e]=i;return{...t,updates:n}}if("LiveList"===e.type&&"LiveList"===t.type){let n=e.updates;return{...t,updates:n.concat(t.updates)}}return t}var ix=(eg=new WeakMap,ev=new WeakMap,ey=new WeakMap,eb=new WeakMap,class{get length(){return(0,eM._)(this,eb)}*[Symbol.iterator](){let e=(0,eM._)(this,eb),t=(0,eM._)(this,ev);for(let n=0;n<e;n++)yield(0,eM._)(this,eg)[t+n]}push(e){let t=Array.isArray(e)?e:[e];for(let e of((0,eM._)(this,ey)>Number.MAX_SAFE_INTEGER-t.length-1&&tH("Deque full"),t))(0,eM._)(this,eg)[(0,eP._)(this,ey).value++-1]=e;(0,eN._)(this,eb,(0,eM._)(this,eb)+t.length)}pop(){if(1>(0,eM._)(this,eb))return;(0,eP._)(this,ey).value--;let e=(0,eM._)(this,eg)[(0,eM._)(this,ey)-1];return delete(0,eM._)(this,eg)[(0,eM._)(this,ey)-1],(0,eP._)(this,eb).value--,e}pushLeft(e){let t=Array.isArray(e)?e:[e];(0,eM._)(this,ev)<Number.MIN_SAFE_INTEGER+t.length&&tH("Deque full");for(let e=t.length-1;e>=0;e--)(0,eM._)(this,eg)[--(0,eP._)(this,ev).value]=t[e];(0,eN._)(this,eb,(0,eM._)(this,eb)+t.length)}popLeft(){if(1>(0,eM._)(this,eb))return;let e=(0,eM._)(this,eg)[(0,eM._)(this,ev)];return delete(0,eM._)(this,eg)[(0,eM._)(this,ev)],(0,eP._)(this,ev).value++,(0,eP._)(this,eb).value--,e}constructor(){(0,eD._)(this,eg,{writable:!0,value:void 0}),(0,eD._)(this,ev,{writable:!0,value:void 0}),(0,eD._)(this,ey,{writable:!0,value:void 0}),(0,eD._)(this,eb,{writable:!0,value:void 0}),(0,eN._)(this,eg,{}),(0,eN._)(this,ev,0),(0,eN._)(this,ey,1),(0,eN._)(this,eb,0)}});function iL(e){return Array.isArray(e)}var iU=(e=>(e[e.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",e[e.BROADCAST_EVENT=103]="BROADCAST_EVENT",e[e.FETCH_STORAGE=200]="FETCH_STORAGE",e[e.UPDATE_STORAGE=201]="UPDATE_STORAGE",e[e.FETCH_YDOC=300]="FETCH_YDOC",e[e.UPDATE_YDOC=301]="UPDATE_YDOC",e))(iU||{}),ij=(ew=new WeakMap,eS=new WeakMap,eI=new WeakSet,eE=new WeakSet,class{get(){return this.signal.get()}connectionIds(){return(0,eM._)(this,ew).get().connections.keys()}clearOthers(){(0,eM._)(this,ew).mutate(e=>{e.connections.clear(),e.presences.clear(),(0,eM._)(this,eS).clear()})}getUser(e){let t=(0,eM._)(this,eS).get(e);if(t)return t;let n=(0,ex._)(this,eI,rI).call(this,e);if(n)return(0,eM._)(this,eS).set(e,n),n}setConnection(e,t,n,i){(0,eM._)(this,ew).mutate(r=>(r.connections.set(e,{connectionId:e,id:t,info:n,scopes:i}),!!r.presences.has(e)&&(0,ex._)(this,eE,rE).call(this,e)))}removeConnection(e){(0,eM._)(this,ew).mutate(t=>{t.connections.delete(e),t.presences.delete(e),(0,ex._)(this,eE,rE).call(this,e)})}setOther(e,t){(0,eM._)(this,ew).mutate(n=>(n.presences.set(e,tX(t)),!!n.connections.has(e)&&(0,ex._)(this,eE,rE).call(this,e)))}patchOther(e,t){(0,eM._)(this,ew).mutate(n=>{let i=n.presences.get(e);if(void 0===i)return!1;let r=ne(i,t);return i!==r&&(n.presences.set(e,r),(0,ex._)(this,eE,rE).call(this,e))})}constructor(){(0,eL._)(this,eI),(0,eL._)(this,eE),(0,eD._)(this,ew,{writable:!0,value:void 0}),(0,eD._)(this,eS,{writable:!0,value:void 0}),(0,eU._)(this,"signal",void 0),(0,eN._)(this,ew,new ns({connections:new Map,presences:new Map})),this.signal=no.from((0,eM._)(this,ew),e=>tY(Array.from((0,eM._)(this,ew).get().presences.keys()).map(e=>this.getUser(Number(e))))),(0,eN._)(this,eS,new Map)}}),iW=class e extends Error{get roomId(){return this.context.roomId}get code(){return this.context.code}static from(t,n){return new e(function(e){switch(e.type){case"ROOM_CONNECTION_ERROR":switch(e.code){case 4001:return"Not allowed to connect to the room";case 4005:return"Room is already full";case 4006:return"Kicked out of the room, because the room ID changed";default:return"Could not connect to the room"}case"CREATE_THREAD_ERROR":return"Could not create new thread";case"DELETE_THREAD_ERROR":return"Could not delete thread";case"EDIT_THREAD_METADATA_ERROR":return"Could not edit thread metadata";case"MARK_THREAD_AS_RESOLVED_ERROR":return"Could not mark thread as resolved";case"MARK_THREAD_AS_UNRESOLVED_ERROR":return"Could not mark thread as unresolved";case"SUBSCRIBE_TO_THREAD_ERROR":return"Could not subscribe to thread";case"UNSUBSCRIBE_FROM_THREAD_ERROR":return"Could not unsubscribe from thread";case"CREATE_COMMENT_ERROR":return"Could not create new comment";case"EDIT_COMMENT_ERROR":return"Could not edit comment";case"DELETE_COMMENT_ERROR":return"Could not delete comment";case"ADD_REACTION_ERROR":return"Could not add reaction";case"REMOVE_REACTION_ERROR":return"Could not remove reaction";case"MARK_INBOX_NOTIFICATION_AS_READ_ERROR":return"Could not mark inbox notification as read";case"DELETE_INBOX_NOTIFICATION_ERROR":return"Could not delete inbox notification";case"MARK_ALL_INBOX_NOTIFICATIONS_AS_READ_ERROR":return"Could not mark all inbox notifications as read";case"DELETE_ALL_INBOX_NOTIFICATIONS_ERROR":return"Could not delete all inbox notifications";case"UPDATE_NOTIFICATION_SETTINGS_ERROR":case"UPDATE_USER_NOTIFICATION_SETTINGS_ERROR":return"Could not update notification settings";case"UPDATE_ROOM_SUBSCRIPTION_SETTINGS_ERROR":return"Could not update room subscription settings";default:return nC(e,"Unhandled case")}}(t),t,n)}constructor(e,t,n){super(e,{cause:n}),(0,eU._)(this,"context",void 0),this.context=t,this.name="LiveblocksError"}};function iV(e,t){return{type:"User",id:"".concat(t.connectionId),key:e,payload:{connectionId:t.connectionId,id:t.id,info:t.info,presence:t.presence,isReadOnly:!t.canWrite}}}function iF(e){var t,n,i,r,o;let s=iK("throttle",null!=(i=e.throttle)?i:100,16,1e3),a=iK("lostConnectionTimeout",null!=(r=e.lostConnectionTimeout)?r:5e3,200,3e4,1e3),l=function(e){if(void 0!==e)return iK("backgroundKeepAliveTimeout",e,15e3)}(e.backgroundKeepAliveTimeout),c="string"==typeof(o=e.baseUrl)&&o.startsWith("http")?o:"https://api.liveblocks.io",d=new nn(void 0),u=function(e,t){let n=function(e){let{publicApiKey:t,authEndpoint:n}=e;if(void 0!==n&&void 0!==t)throw Error("You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient");if("string"==typeof t){if(t.startsWith("sk_"))throw Error("Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");if(!t.startsWith("pk_"))throw Error("Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");return{type:"public",publicApiKey:t}}if("string"==typeof n)return{type:"private",url:n};if("function"==typeof n)return{type:"custom",callback:n};if(void 0!==n)throw Error("The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint");throw Error("Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient")}(e),i=new Set,r=[],o=[],s=new Map;function a(e,t){return"comments:read"===e?t.includes("comments:read")||t.includes("comments:write")||t.includes("room:read")||t.includes("room:write"):"room:read"===e&&(t.includes("room:read")||t.includes("room:write"))}async function l(r){var o,s;let a=null!=(s=null==(o=e.polyfills)?void 0:o.fetch)?s:"undefined"==typeof window?void 0:window.fetch;if("private"===n.type){if(void 0===a)throw new nq("To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.");let e=n5((await n8(a,n.url,{room:r.roomId})).token);if(i.has(e.raw))throw new nq("The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.");return null==t||t(e.parsed),e}if("custom"===n.type){let e=await n.callback(r.roomId);if(e&&"object"==typeof e){if("string"==typeof e.token){let n=n5(e.token);return null==t||t(n.parsed),n}else if("string"==typeof e.error){let t="Authentication failed: ".concat("reason"in e&&"string"==typeof e.reason?e.reason:"Forbidden");if("forbidden"===e.error)throw new nq(t);throw Error(t)}}throw Error('Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: "..." }')}throw Error("Unexpected authentication type. Must be private or custom.")}return{reset:function(){i.clear(),r.length=0,o.length=0,s.clear()},getAuthValue:async function(e){let t;if("public"===n.type)return{type:"public",publicApiKey:n.publicApiKey};let c=function(e){let t=Math.ceil(Date.now()/1e3);for(let n=r.length-1;n>=0;n--){let i=r[n];if(o[n]<=t){r.splice(n,1),o.splice(n,1);continue}if("id"===i.parsed.k)return i;if("acc"===i.parsed.k){if(!e.roomId&&0===Object.entries(i.parsed.perms).length)return i;for(let[t,n]of Object.entries(i.parsed.perms))if(e.roomId){if(t.includes("*")&&e.roomId.startsWith(t.replace("*",""))||e.roomId===t&&a(e.requestedScope,n))return i}else if(t.includes("*")&&a(e.requestedScope,n))return i}}}(e);if(void 0!==c)return{type:"secret",token:c};e.roomId?void 0===(t=s.get(e.roomId))&&(t=l(e),s.set(e.roomId,t)):void 0===(t=s.get("liveblocks-user-token"))&&(t=l(e),s.set("liveblocks-user-token",t));try{let e=await t,n=Math.floor(Date.now()/1e3)+(e.parsed.exp-e.parsed.iat)-30;return i.add(e.raw),"sec-legacy"!==e.parsed.k&&(r.push(e),o.push(n)),{type:"secret",token:e}}finally{e.roomId?s.delete(e.roomId):s.delete("liveblocks-user-token")}}}}(e,e=>{let t="sec-legacy"===e.k?e.id:e.uid;d.set(()=>t)}),h=function(e){let{baseUrl:t,authManager:n,fetchPolyfill:i}=e,r=new nO(t,i);async function o(e){let t=await r.get(nT(eV(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{since:e.since.toISOString()},{signal:e.signal});return{threads:{updated:t.data.map(tO),deleted:t.deletedThreads.map(tM)},inboxNotifications:{updated:t.inboxNotifications.map(tC),deleted:t.deletedInboxNotifications.map(tD)},subscriptions:{updated:t.subscriptions.map(tR),deleted:t.deletedSubscriptions.map(tN)},requestedAt:new Date(t.meta.requestedAt),permissionHints:t.meta.permissionHints}}async function s(e){let t;e.query&&(t=ny(e.query));try{let i=await r.get(nT(eF(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{cursor:e.cursor,query:t,limit:50});return{threads:i.data.map(tO),inboxNotifications:i.inboxNotifications.map(tC),subscriptions:i.subscriptions.map(tR),nextCursor:i.meta.nextCursor,requestedAt:new Date(i.meta.requestedAt),permissionHints:i.meta.permissionHints}}catch(e){if(e instanceof tQ&&404===e.status)return{threads:[],inboxNotifications:[],subscriptions:[],nextCursor:null,requestedAt:new Date(Date.now()-216e5),permissionHints:{}};throw e}}async function a(e){var t,i;let o=null!=(t=e.commentId)?t:nm(),s=null!=(i=e.threadId)?i:n_();return tO(await r.post(nT(eK(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{id:s,comment:{id:o,body:e.body,attachmentIds:e.attachmentIds},metadata:e.metadata}))}async function l(e){await r.delete(nT(eq(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function c(e){let t=await r.rawGet(nT(eH(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}));if(t.ok){let e=await t.json();return{thread:tO(e.thread),inboxNotification:e.inboxNotification?tC(e.inboxNotification):void 0,subscription:e.subscription?tR(e.subscription):void 0}}if(404===t.status)return{thread:void 0,inboxNotification:void 0,subscription:void 0};throw Error("There was an error while getting thread ".concat(e.threadId,"."))}async function d(e){return await r.post(nT(ez(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),e.metadata)}async function u(e){var t;let i=null!=(t=e.commentId)?t:nm();return tk(await r.post(nT(eB(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{id:i,body:e.body,attachmentIds:e.attachmentIds}))}async function h(e){return tk(await r.post(nT(eG(),e.roomId,e.threadId,e.commentId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{body:e.body,attachmentIds:e.attachmentIds}))}async function f(e){await r.delete(nT(eY(),e.roomId,e.threadId,e.commentId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function p(e){var t;return{...t=await r.post(nT(eX(),e.roomId,e.threadId,e.commentId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{emoji:e.emoji}),createdAt:new Date(t.createdAt)}}async function _(e){await r.delete(nT(eJ(),e.roomId,e.threadId,e.commentId,e.emoji),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function m(e){await r.post(nT(eZ(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function g(e){await r.post(nT(eQ(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function v(e){return tR(await r.post(nT(e$(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId})))}async function y(e){await r.post(nT(e0(),e.roomId,e.threadId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function b(e){let t=e.roomId,i=e.signal,o=e.attachment,s=i?new DOMException("Upload of attachment ".concat(e.attachment.id," was aborted."),"AbortError"):void 0;if(null==i?void 0:i.aborted)throw s;let a=e=>{if(null==i?void 0:i.aborted)throw s;if(e instanceof tQ&&413===e.status)throw e;return!1},l=[2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3];if(o.size<=5242880)return t0(async()=>r.putBlob(nT(e1(),t,o.id,encodeURIComponent(o.name)),await n.getAuthValue({requestedScope:"comments:read",roomId:t}),o.file,{fileSize:o.size},{signal:i}),10,l,a);{let e,c=[],d=await t0(async()=>r.post(nT(e2(),t,o.id,encodeURIComponent(o.name)),await n.getAuthValue({requestedScope:"comments:read",roomId:t}),void 0,{signal:i},{fileSize:o.size}),10,l,a);try{e=d.uploadId;let u=function(e){let t=[],n=0;for(;n<e.size;){let i=Math.min(n+5242880,e.size);t.push({partNumber:t.length+1,part:e.slice(n,i)}),n=i}return t}(o.file);if(null==i?void 0:i.aborted)throw s;for(let e of function(e,t){let n=[];for(let t=0,i=e.length;t<i;t+=5)n.push(e.slice(t,t+5));return n}(u,5)){let s=[];for(let{part:c,partNumber:u}of e)s.push(t0(async()=>r.putBlob(nT(e3(),t,o.id,d.uploadId,String(u)),await n.getAuthValue({requestedScope:"comments:read",roomId:t}),c,void 0,{signal:i}),10,l,a));c.push(...await Promise.all(s))}if(null==i?void 0:i.aborted)throw s;let h=c.sort((e,t)=>e.partNumber-t.partNumber);return r.post(nT(e5(),t,o.id,e),await n.getAuthValue({requestedScope:"comments:read",roomId:t}),{parts:h},{signal:i})}catch(i){if(e&&(null==i?void 0:i.name)&&("AbortError"===i.name||"TimeoutError"===i.name))try{await r.rawDelete(nT(e8(),t,o.id,e),await n.getAuthValue({requestedScope:"comments:read",roomId:t}))}catch(e){}throw i}}}let w=new ng(e=>nh(new nu(async t=>{let i=t.flat(),{urls:o}=await r.post(nT(e4(),e),await n.getAuthValue({requestedScope:"comments:read",roomId:e}),{attachmentIds:i});return o.map(e=>null!=e?e:Error("There was an error while getting this attachment's URL"))},{delay:50})));function S(e){return w.getOrCreate(e)}async function I(e){return r.get(nT(e7(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),void 0,{signal:e.signal})}async function E(e){return r.post(nT(e6(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),e.settings)}let A=new ng(e=>new nu(async t=>{let i=t.flat();return await r.post(nT(e9(),e),await n.getAuthValue({requestedScope:"comments:read",roomId:e}),{inboxNotificationIds:i}),i},{delay:50}));async function T(e){return A.getOrCreate(e.roomId).get(e.inboxNotificationId)}async function k(e){await r.rawPost(nT(te(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{userId:e.userId,mentionId:e.mentionId})}async function O(e){await r.rawDelete(nT(tt(),e.roomId,e.mentionId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function C(e){return r.rawGet(nT(tn(),e.roomId,e.versionId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function R(e){await r.rawPost(nT(ti(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}))}async function M(e){await r.rawPost(nT(tr(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{type:e.type,rootKey:e.rootKey})}async function D(e){let t=await r.post(nT(to(),e.roomId),await n.getAuthValue({requestedScope:"room:read",roomId:e.roomId}),{prompt:e.prompt,context:{beforeSelection:e.context.beforeSelection,selection:e.context.selection,afterSelection:e.context.afterSelection},previous:e.previous},{signal:e.signal});if(!t||0===t.content.length)throw Error("No content returned from server");return t.content[0].text}async function N(e){let t=await r.get(nT(ts(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}));return{versions:t.versions.map(e=>{let{createdAt:t,...n}=e;return{createdAt:new Date(t),...n}}),requestedAt:new Date(t.meta.requestedAt)}}async function P(e){let t=await r.get(nT(ta(),e.roomId),await n.getAuthValue({requestedScope:"comments:read",roomId:e.roomId}),{since:e.since.toISOString()},{signal:e.signal});return{versions:t.versions.map(e=>{let{createdAt:t,...n}=e;return{createdAt:new Date(t),...n}}),requestedAt:new Date(t.meta.requestedAt)}}async function x(e){let t=await r.rawGet(nT(tl(),e.roomId),await n.getAuthValue({requestedScope:"room:read",roomId:e.roomId}));return await t.json()}async function L(e){return r.rawPost(nT(tc(),e.roomId),await n.getAuthValue({requestedScope:"room:read",roomId:e.roomId}),{nonce:e.nonce,messages:e.messages})}async function U(e){let t=await r.get(nT(td()),await n.getAuthValue({requestedScope:"comments:read"}),{cursor:null==e?void 0:e.cursor,limit:50});return{inboxNotifications:t.inboxNotifications.map(tC),threads:t.threads.map(tO),subscriptions:t.subscriptions.map(tR),nextCursor:t.meta.nextCursor,requestedAt:new Date(t.meta.requestedAt)}}async function j(e){let t=await r.get(nT(tu()),await n.getAuthValue({requestedScope:"comments:read"}),{since:e.since.toISOString()},{signal:e.signal});return{inboxNotifications:{updated:t.inboxNotifications.map(tC),deleted:t.deletedInboxNotifications.map(tD)},threads:{updated:t.threads.map(tO),deleted:t.deletedThreads.map(tM)},subscriptions:{updated:t.subscriptions.map(tR),deleted:t.deletedSubscriptions.map(tN)},requestedAt:new Date(t.meta.requestedAt)}}async function W(){let{count:e}=await r.get(nT(th()),await n.getAuthValue({requestedScope:"comments:read"}));return e}async function V(){await r.post(nT(tf()),await n.getAuthValue({requestedScope:"comments:read"}),{inboxNotificationIds:"all"})}async function F(e){await r.post(nT(tp()),await n.getAuthValue({requestedScope:"comments:read"}),{inboxNotificationIds:e})}let K=new nu(async e=>{let t=e.flat();return await F(t),t},{delay:50});return{getThreads:s,getThreadsSince:o,createThread:a,getThread:c,deleteThread:l,editThreadMetadata:d,createComment:u,editComment:h,deleteComment:f,addReaction:p,removeReaction:_,markThreadAsResolved:m,markThreadAsUnresolved:g,subscribeToThread:v,unsubscribeFromThread:y,markRoomInboxNotificationAsRead:T,getSubscriptionSettings:I,updateSubscriptionSettings:E,createTextMention:k,deleteTextMention:O,getTextVersion:C,createTextVersion:R,reportTextEditor:M,listTextVersions:N,listTextVersionsSince:P,getAttachmentUrl:function(e){return S(e.roomId).batch.get(e.attachmentId)},uploadAttachment:b,getOrCreateAttachmentUrlsStore:S,streamStorage:x,sendMessages:L,getInboxNotifications:U,getInboxNotificationsSince:j,getUnreadInboxNotificationsCount:W,markAllInboxNotificationsAsRead:V,markInboxNotificationAsRead:async function(e){await K.get(e)},deleteAllInboxNotifications:async function(){await r.delete(nT(t_()),await n.getAuthValue({requestedScope:"comments:read"}))},deleteInboxNotification:async function(e){await r.delete(nT(tm(),e),await n.getAuthValue({requestedScope:"comments:read"}))},getNotificationSettings:async function(e){return r.get(nT(tg()),await n.getAuthValue({requestedScope:"comments:read"}),void 0,{signal:null==e?void 0:e.signal})},updateNotificationSettings:async function(e){return r.post(nT(tv()),await n.getAuthValue({requestedScope:"comments:read"}),e)},getUserThreads_experimental:async function(e){let t;(null==e?void 0:e.query)&&(t=ny(e.query));let i=await r.get(nT(ty()),await n.getAuthValue({requestedScope:"comments:read"}),{cursor:null==e?void 0:e.cursor,query:t,limit:50});return{threads:i.threads.map(tO),inboxNotifications:i.inboxNotifications.map(tC),subscriptions:i.subscriptions.map(tR),nextCursor:i.meta.nextCursor,requestedAt:new Date(i.meta.requestedAt),permissionHints:i.meta.permissionHints}},getUserThreadsSince_experimental:async function(e){let t=await r.get(nT(tb()),await n.getAuthValue({requestedScope:"comments:read"}),{since:e.since.toISOString()},{signal:e.signal});return{threads:{updated:t.threads.map(tO),deleted:t.deletedThreads.map(tM)},inboxNotifications:{updated:t.inboxNotifications.map(tC),deleted:t.deletedInboxNotifications.map(tD)},subscriptions:{updated:t.subscriptions.map(tR),deleted:t.deletedSubscriptions.map(tN)},requestedAt:new Date(t.meta.requestedAt),permissionHints:t.meta.permissionHints}},executeContextualPrompt:D}}({baseUrl:c,fetchPolyfill:(null==(t=e.polyfills)?void 0:t.fetch)||(null==(n=globalThis.fetch)?void 0:n.bind(globalThis)),authManager:u}),f=new Map;function p(e){let t=()=>{if(e.unsubs.delete(t)){var n;0===e.unsubs.size&&((n=e.room).id,f.delete(n.id),n.destroy())}else tU("This leave function was already called. Calling it more than once has no effect.")};return e.unsubs.add(t),{room:e.room,leave:t}}let _=e.resolveUsers,m=iq(()=>!_,"Set the resolveUsers option in createClient to specify user info."),g=nh(new nu(async e=>{let t=e.flat(),n=await (null==_?void 0:_({userIds:t}));return m(),null!=n?n:t.map(()=>void 0)},{delay:50})),v=e.resolveRoomsInfo,y=iq(()=>!v,"Set the resolveRoomsInfo option in createClient to specify room info."),b=nh(new nu(async e=>{let t=e.flat(),n=await (null==v?void 0:v({roomIds:t}));return y(),null!=n?n:t.map(()=>void 0)},{delay:50})),w=new Map,S=[],I=new nn("synchronized"),E=t3();function A(){I.set(S.some(e=>"synchronizing"===e.get())?"synchronizing":S.some(e=>"has-local-changes"===e.get())?"has-local-changes":"synchronized")}function T(){let e=new nn("synchronized");S.push(e);let t=e.subscribe(()=>A());return{setSyncStatus:function(t){e.set(t)},destroy:function(){t();let n=S.findIndex(t=>t===e);if(n>-1){let[e]=S.splice(n,1);"synchronized"!==e.get()&&A()}}}}{let t="undefined"!=typeof window?window:void 0;null==t||t.addEventListener("beforeunload",t=>{e.preventUnsavedChanges&&"synchronized"!==I.get()&&t.preventDefault()})}async function k(e){return n6(await h.getNotificationSettings(e))}async function O(e){return n6(await h.updateNotificationSettings(e))}let C=Object.defineProperty({enterRoom:function(t){for(var n,i,r,o,d,_,m,g,v,y=arguments.length,b=Array(y>1?y-1:0),w=1;w<y;w++)b[w-1]=arguments[w];let S=f.get(t);if(void 0!==S)return p(S);let I=null!=(r=b[0])?r:{},A=function(e,t){var n,i,r;let o,s,a,l=t.roomId,c=e.initialPresence,d=e.initialStorage,u=t.roomHttpClient,[h,f]=function(){let e="undefined"!=typeof document?document:void 0,t={current:null};function n(){if((null==e?void 0:e.visibilityState)==="hidden"){var n;t.current=null!=(n=t.current)?n:Date.now()}else t.current=null}return null==e||e.addEventListener("visibilitychange",n),[t,()=>{null==e||e.removeEventListener("visibilitychange",n)}]}(),p=new n0({...t.delegates,canZombie:()=>void 0!==t.backgroundKeepAliveTimeout&&null!==h.current&&Date.now()>h.current+t.backgroundKeepAliveTimeout&&"synchronizing"!==J()},t.enableDebugLogging),_={buffer:{flushTimerID:void 0,lastFlushedAt:0,presenceUpdates:{type:"full",data:c},messages:[],storageOperations:[]},staticSessionInfoSig:new nn(null),dynamicSessionInfoSig:new nn(null),myPresence:new ni(c),others:new ij,initialStorage:d,idFactory:null,yjsProvider:void 0,yjsProviderDidChange:t3(),pool:function(e,t){let{getCurrentConnectionId:n,onDispatch:i,isStorageWritable:r=()=>!0}=t,o=0,s=0,a=new Map;return{roomId:e,nodes:a,getNode:e=>a.get(e),addNode:(e,t)=>void a.set(e,t),deleteNode:e=>void a.delete(e),generateId:()=>"".concat(n(),":").concat(o++),generateOpId:()=>"".concat(n(),":").concat(s++),dispatch(e,t,n){null==i||i(e,t,n)},assertStorageIsWritable:()=>{if(!r())throw Error("Cannot write to storage with a read only user, please ensure the user has write permissions")}}}(l,{getCurrentConnectionId:function(){let e=_.dynamicSessionInfoSig.get();if(e)return e.actor;throw Error("Internal. Tried to get connection id but connection was never open")},onDispatch:function(e,t,n){if(_.activeBatch){for(let t of e)_.activeBatch.ops.push(t);for(let[e,t]of n)_.activeBatch.updates.storageUpdates.set(e,iP(_.activeBatch.updates.storageUpdates.get(e),t));_.activeBatch.reverseOps.pushLeft(t)}else D(t),_.redoStack.length=0,V(e),N({storageUpdates:n})},isStorageWritable:function(){var e;let t=null==(e=_.dynamicSessionInfoSig.get())?void 0:e.scopes;return void 0===t||n2(t)}}),root:void 0,undoStack:[],redoStack:[],pausedHistory:null,activeBatch:null,unacknowledgedOps:new Map,opStackTraces:void 0},m=!1;p.events.onMessage.subscribe(function(e){if("string"!=typeof e.data)return;let t=function(e){let t=tB(e);return void 0===t?null:iL(t)?tY(t.map(e=>j(e))):tY([j(t)])}(e.data);if(null===t||0===t.length)return;let n={storageUpdates:new Map,others:[]};for(let e of t)switch(e.type){case 101:{let t=function(e){_.others.setConnection(e.actor,e.id,e.info,e.scopes),_.buffer.messages.push({type:100,data:_.myPresence.get(),targetActor:e.actor}),W();let t=_.others.getUser(e.actor);return t?{type:"enter",user:t}:void 0}(e);t&&n.others.push(t);break}case 100:{let t=function(e){if(void 0!==e.targetActor){let t=_.others.getUser(e.actor);_.others.setOther(e.actor,e.data);let n=_.others.getUser(e.actor);if(void 0===t&&void 0!==n)return{type:"enter",user:n}}else _.others.patchOther(e.actor,e.data);let t=_.others.getUser(e.actor);return t?{type:"update",updates:e.data,user:t}:void 0}(e);t&&n.others.push(t);break}case 103:{var i;let t=_.others.get();g.customEvent.notify({connectionId:e.actor,user:e.actor<0?null:null!=(i=t.find(t=>t.connectionId===e.actor))?i:null,event:e.event});break}case 102:{let t=function(e){let t=_.others.getUser(e.actor);return t?(_.others.removeConnection(e.actor),{type:"leave",user:t}):null}(e);t&&n.others.push(t);break}case 300:g.ydoc.notify(e);break;case 104:n.others.push(function(e){var t;let n;for(let i of(_.dynamicSessionInfoSig.set({actor:e.actor,nonce:e.nonce,scopes:e.scopes}),t=e.actor,n=0,_.idFactory=()=>"".concat(t,":").concat(n++),C(),_.others.connectionIds()))void 0===e.users[i]&&_.others.removeConnection(i);for(let t in e.users){let n=e.users[t],i=Number(t);_.others.setConnection(i,n.id,n.info,n.scopes)}return{type:"reset"}}(e));break;case 200:q(e);break;case 201:for(let[t,i]of P(e.ops,!1).updates.storageUpdates)n.storageUpdates.set(t,iP(n.storageUpdates.get(t),i));break;case 299:tF("Storage mutation rejection error",e.reason);break;case 400:case 407:case 401:case 408:case 405:case 406:case 402:case 403:case 404:g.comments.notify(e)}N(n)}),p.events.statusDidChange.subscribe(function(e){let t=p.authValue;if(null!==t){let e=nk(t);if(e!==o)if(o=e,"secret"===t.type){let e=t.token.parsed;_.staticSessionInfoSig.set({userId:"sec-legacy"===e.k?e.id:e.uid,userInfo:"sec-legacy"===e.k?e.info:e.ui})}else _.staticSessionInfoSig.set({userId:void 0,userInfo:void 0})}g.status.notify(e),C()}),p.events.statusDidChange.subscribe(function(e){"reconnecting"===e?s=setTimeout(()=>{g.lostConnection.notify("lost"),m=!0,_.others.clearOthers(),N({others:[{type:"reset"}]})},t.lostConnectionTimeout):(clearTimeout(s),m&&("disconnected"===e?g.lostConnection.notify("failed"):g.lostConnection.notify("restored"),m=!1))}),p.events.didConnect.subscribe(function(){_.buffer.presenceUpdates={type:"full",data:{..._.myPresence.get()}},null!==F&&z({flush:!1}),W()}),p.events.didDisconnect.subscribe(function(){clearTimeout(_.buffer.flushTimerID)}),p.events.onConnectionError.subscribe(e=>{let{message:n,code:i}=e,r=new iW(n,{type:"ROOM_CONNECTION_ERROR",code:i,roomId:l});t.errorEventSource.notify(r)});let g={status:t3(),lostConnection:t3(),customEvent:t3(),self:t3(),myPresence:t3(),others:t3(),storageBatch:t3(),history:t3(),storageDidLoad:t3(),storageStatus:t3(),ydoc:t3(),comments:t3(),roomWillDestroy:t3()};async function v(e,t){return u.createTextMention({roomId:l,userId:e,mentionId:t})}async function y(e){return u.deleteTextMention({roomId:l,mentionId:e})}async function b(e,t){await u.reportTextEditor({roomId:l,type:e,rootKey:t})}async function w(){return u.listTextVersions({roomId:l})}async function S(e){return u.listTextVersionsSince({roomId:l,since:e.since,signal:e.signal})}async function I(e){return u.getTextVersion({roomId:l,versionId:e})}async function E(){return u.createTextVersion({roomId:l})}async function A(e){return u.executeContextualPrompt({roomId:l,...e})}function T(e){return!(4*e.length<1048064)&&new TextEncoder().encode(e).length>=1048064}function k(e){var n,i,r;let o=null!=(n=t.largeMessageStrategy)?n:"default",s=nc(e);if(!T(s))return p.send(s);switch(o){case"default":return void tj("Message is too large for websockets, not sending. Configure largeMessageStrategy option to deal with this.");case"split":for(let t of(tU("Message is too large for websockets, splitting into smaller chunks"),function* e(t){if(t.length<2)if(201===t[0].type)return void(yield*function* e(t){let{ops:n,...i}=t;if(n.length<2)throw Error("Cannot split ops into smaller chunks");let r=Math.floor(n.length/2);for(let t of[n.slice(0,r),n.slice(r)]){let n={ops:t,...i},r=nc([n]);T(r)?yield*e(n):yield r}}(t[0]));else throw Error("Cannot split into chunks smaller than the allowed message size");let n=Math.floor(t.length/2);for(let i of[t.slice(0,n),t.slice(n)]){let t=nc(i);T(t)?yield*e(i):yield t}}(e)))p.send(t);return;case"experimental-fallback-to-http":{tU("Message is too large for websockets, so sending over HTTP instead");let t=null!=(r=null==(i=_.dynamicSessionInfoSig.get())?void 0:i.nonce)?r:tH("Session is not authorized to send message over HTTP");u.sendMessages({roomId:l,nonce:t,messages:e}).then(e=>{e.ok||403!==e.status||p.reconnect()});return}}}let O=no.from(_.staticSessionInfoSig,_.dynamicSessionInfoSig,_.myPresence,(e,t,n)=>{if(null===e||null===t)return null;{let i=n2(t.scopes);return{connectionId:t.actor,id:e.userId,info:e.userInfo,presence:n,canWrite:i,canComment:n3(t.scopes)}}});function C(){let e=O.get();null!==e&&e!==a&&(g.self.notify(e),a=e)}let R=no.from(O,e=>null!==e?iV("Me",e):null);function M(e){_.undoStack.length>=50&&_.undoStack.shift(),_.undoStack.push(e),U()}function D(e){null!==_.pausedHistory?_.pausedHistory.pushLeft(e):M(e)}function N(e){var t;let n=e.storageUpdates,i=e.others;if(void 0!==i&&i.length>0){let e=_.others.get();for(let t of i)g.others.notify({...t,others:e})}if(null!=(t=e.presence)&&t&&(C(),g.myPresence.notify(_.myPresence.get())),void 0!==n&&n.size>0){let e=Array.from(n.values());g.storageBatch.notify(e)}Q()}function P(e,t){let n={reverse:new ix,storageUpdates:new Map,presence:!1},i=new Set,r=e.map(e=>"presence"===e.type||e.opId?e:{...e,opId:_.pool.generateOpId()});for(let e of r)if("presence"===e.type){let t={type:"presence",data:{}};for(let n in e.data)t.data[n]=_.myPresence.get()[n];if(_.myPresence.patch(e.data),null===_.buffer.presenceUpdates)_.buffer.presenceUpdates={type:"partial",data:e.data};else for(let t in e.data)_.buffer.presenceUpdates.data[t]=e.data[t];n.reverse.pushLeft(t),n.presence=!0}else{let r;if(t)r=0;else{let t=nM(e.opId);r=_.unacknowledgedOps.delete(t)?2:1}let o=function(e,t){if(5===e.type&&"ACK"===e.id)return{modified:!1};switch(e.type){case 6:case 3:case 5:{let n=_.pool.nodes.get(e.id);if(void 0===n)return{modified:!1};return n._apply(e,0===t)}case 1:{let n=_.pool.nodes.get(e.id);if(void 0===n)return{modified:!1};if("HasParent"===n.parent.type&&iM(n.parent.node))return n.parent.node._setChildKey(ia(e.parentKey),n,t);return{modified:!1}}case 4:case 2:case 7:case 8:{if(void 0===e.parentId)return{modified:!1};let n=_.pool.nodes.get(e.parentId);if(void 0===n)return{modified:!1};return n._attachChild(e,t)}}}(e,r);if(o.modified){let t=o.modified.node._id;t&&i.has(t)||(n.storageUpdates.set(nM(o.modified.node._id),iP(n.storageUpdates.get(nM(o.modified.node._id)),o.modified)),n.reverse.pushLeft(o.reverse)),(2===e.type||7===e.type||4===e.type)&&i.add(nM(e.id))}}return{ops:r,reverse:Array.from(n.reverse),updates:{storageUpdates:n.storageUpdates,presence:n.presence}}}function x(){return _.undoStack.length>0}function L(){return _.redoStack.length>0}function U(){g.history.notify({canUndo:x(),canRedo:L()})}function j(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||iL(e)?null:e}function W(){let e=_.buffer.storageOperations;if(e.length>0){for(let t of e)_.unacknowledgedOps.set(nM(t.opId),t);Q()}if("connected"!==p.getStatus()){_.buffer.storageOperations=[];return}let n=Date.now(),i=n-_.buffer.lastFlushedAt;if(i>=t.throttleDelay){let e=function(){let e=[];for(let t of(_.buffer.presenceUpdates&&e.push("full"===_.buffer.presenceUpdates.type?{type:100,targetActor:-1,data:_.buffer.presenceUpdates.data}:{type:100,data:_.buffer.presenceUpdates.data}),_.buffer.messages))e.push(t);return _.buffer.storageOperations.length>0&&e.push({type:201,ops:_.buffer.storageOperations}),e}();if(0===e.length)return;k(e),_.buffer={flushTimerID:void 0,lastFlushedAt:n,messages:[],storageOperations:[],presenceUpdates:null}}else clearTimeout(_.buffer.flushTimerID),_.buffer.flushTimerID=setTimeout(W,t.throttleDelay-i)}function V(e){let{storageOperations:t}=_.buffer;for(let n of e)t.push(n);W()}let F=null,K=null;function q(e){let t=new Map(_.unacknowledgedOps);!function(e){var t,n,i;if(0===e.items.length)throw Error("Internal error: cannot load storage without items");void 0!==_.root?function(e){if(void 0===_.root)return;let t=new Map;for(let[e,n]of _.pool.nodes)t.set(e,n._serialize());N(P(function(e,t){let n=[];return e.forEach((e,i)=>{t.get(i)||n.push({type:5,id:i})}),t.forEach((t,i)=>{let r=e.get(i);if(r)0===t.type&&(0!==r.type||nc(t.data)!==nc(r.data))&&n.push({type:3,id:i,data:t.data}),t.parentKey!==r.parentKey&&n.push({type:1,id:i,parentKey:nM(t.parentKey,"Parent key must not be missing")});else switch(t.type){case 3:n.push({type:8,id:i,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 1:n.push({type:2,id:i,parentId:t.parentId,parentKey:t.parentKey});break;case 0:if(void 0===t.parentId||void 0===t.parentKey)throw Error("Internal error. Cannot serialize storage root into an operation");n.push({type:4,id:i,parentId:t.parentId,parentKey:t.parentKey,data:t.data});break;case 2:n.push({type:7,id:i,parentId:t.parentId,parentKey:t.parentKey})}}),n}(t,new Map(e)),!1).updates)}(e.items):_.root=iA._fromItems(e.items,_.pool);let r=null==(n=null==(t=O.get())?void 0:t.canWrite)||n,o=_.undoStack.length;for(let e in _.initialStorage)void 0===_.root.get(e)&&(r?_.root.set(e,void 0===(i=_.initialStorage[e])?void 0:iC(i)?i.clone():tG(i)):tU("Attempted to populate missing storage key '".concat(e,"', but current user has no write access")));_.undoStack.length=o}(e),function(e){if(0===e.size)return;let t=[],n=P(Array.from(e.values()),!0);t.push({type:201,ops:n.ops}),N(n.updates),k(t)}(t),null==K||K(),Q(),g.storageDidLoad.notify()}async function H(){p.authValue&&q({type:200,items:await u.streamStorage({roomId:l})})}function z(e){let n=_.buffer.messages;t.unstable_streamData?H():n.some(e=>200===e.type)||n.push({type:200}),e.flush&&W()}function B(){return null===F&&(z({flush:!0}),F=new Promise(e=>{K=e}),Q()),F}function G(){let e=_.root;return void 0!==e?e:(B(),null)}async function Y(){return void 0!==_.root?Promise.resolve({root:_.root}):(await B(),{root:nM(_.root)})}let X=t.createSyncSource();function J(){return void 0===_.root?null===F?"not-loaded":"loading":0===_.unacknowledgedOps.size?"synchronized":"synchronizing"}let Z=J();function Q(){let e=J();Z!==e&&(Z=e,g.storageStatus.notify(e)),X.setSyncStatus("synchronizing"===e?"synchronizing":"synchronized")}function $(){return null!==O.get()}async function ee(){for(;!$();){let{promise:e,resolve:t}=t2(),n=er.self.subscribeOnce(t),i=er.status.subscribeOnce(t);await e,n(),i()}}function et(){return null!==G()}async function en(){for(;!et();)await Y()}let ei=no.from(_.others.signal,e=>e.map((e,t)=>iV("Other ".concat(t),e))),er={status:g.status.observable,lostConnection:g.lostConnection.observable,customEvent:g.customEvent.observable,others:g.others.observable,self:g.self.observable,myPresence:g.myPresence.observable,storage:g.storageBatch.observable,storageBatch:g.storageBatch.observable,history:g.history.observable,storageDidLoad:g.storageDidLoad.observable,storageStatus:g.storageStatus.observable,ydoc:g.ydoc.observable,comments:g.comments.observable,roomWillDestroy:g.roomWillDestroy.observable};async function eo(e){return u.getThreadsSince({roomId:l,since:e.since,signal:e.signal})}async function es(e){return u.getThreads({roomId:l,query:null==e?void 0:e.query,cursor:null==e?void 0:e.cursor})}async function ea(e){return u.getThread({roomId:l,threadId:e})}async function el(e){return u.createThread({roomId:l,threadId:e.threadId,commentId:e.commentId,metadata:e.metadata,body:e.body,attachmentIds:e.attachmentIds})}async function ec(e){return u.deleteThread({roomId:l,threadId:e})}async function ed(e){let{metadata:t,threadId:n}=e;return u.editThreadMetadata({roomId:l,threadId:n,metadata:t})}async function eu(e){return u.markThreadAsResolved({roomId:l,threadId:e})}async function eh(e){return u.markThreadAsUnresolved({roomId:l,threadId:e})}async function ef(e){return u.subscribeToThread({roomId:l,threadId:e})}async function ep(e){return u.unsubscribeFromThread({roomId:l,threadId:e})}async function e_(e){return u.createComment({roomId:l,threadId:e.threadId,commentId:e.commentId,body:e.body,attachmentIds:e.attachmentIds})}async function em(e){return u.editComment({roomId:l,threadId:e.threadId,commentId:e.commentId,body:e.body,attachmentIds:e.attachmentIds})}async function eg(e){let{threadId:t,commentId:n}=e;return u.deleteComment({roomId:l,threadId:t,commentId:n})}async function ev(e){let{threadId:t,commentId:n,emoji:i}=e;return u.addReaction({roomId:l,threadId:t,commentId:n,emoji:i})}async function ey(e){let{threadId:t,commentId:n,emoji:i}=e;return await u.removeReaction({roomId:l,threadId:t,commentId:n,emoji:i})}async function eb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u.uploadAttachment({roomId:l,attachment:e,signal:t.signal})}function ew(e){return u.getSubscriptionSettings({roomId:l,signal:null==e?void 0:e.signal})}function eS(e){return u.updateSubscriptionSettings({roomId:l,settings:e})}async function eI(e){await u.markRoomInboxNotificationAsRead({roomId:l,inboxNotificationId:e})}let eE=t.createSyncSource();function eA(e){return eE.setSyncStatus("synchronizing"===e?"synchronizing":"synchronized")}return Object.defineProperty({[n4]:{get presenceBuffer(){var eT,ek;return tG(null!=(ek=null==(eT=_.buffer.presenceUpdates)?void 0:eT.data)?ek:null)},get undoStack(){return tG(_.undoStack)},get nodeCount(){return _.pool.nodes.size},getYjsProvider:()=>_.yjsProvider,setYjsProvider(e){var t;null==(t=_.yjsProvider)||t.off("status",eA),_.yjsProvider=e,null==e||e.on("status",eA),_.yjsProviderDidChange.notify()},yjsProviderDidChange:_.yjsProviderDidChange.observable,reportTextEditor:b,createTextMention:v,deleteTextMention:y,listTextVersions:w,listTextVersionsSince:S,getTextVersion:I,createTextVersion:E,executeContextualPrompt:A,getSelf_forDevTools:()=>R.get(),getOthers_forDevTools:()=>ei.get(),simulate:{explicitClose:e=>p._privateSendMachineEvent({type:"EXPLICIT_SOCKET_CLOSE",event:e}),rawSend:e=>p.send(e)},attachmentUrlsStore:u.getOrCreateAttachmentUrlsStore(l)},id:l,subscribe:(n=l,i=er,r=t.errorEventSource,function(e,t,o){var s;if("string"==typeof e&&("my-presence"===(s=e)||"others"===s||"event"===s||"error"===s||"history"===s||"status"===s||"storage-status"===s||"lost-connection"===s||"connection"===s||"comments"===s)){if("function"!=typeof t)throw Error("Second argument must be a callback function");switch(e){case"event":return i.customEvent.subscribe(t);case"my-presence":return i.myPresence.subscribe(t);case"others":return i.others.subscribe(e=>{let{others:n,...i}=e;return t(n,i)});case"error":return r.subscribe(e=>{if(e.roomId===n)return t(e)});case"status":return i.status.subscribe(t);case"lost-connection":return i.lostConnection.subscribe(t);case"history":return i.history.subscribe(t);case"storage-status":return i.storageStatus.subscribe(t);case"comments":return i.comments.subscribe(t);default:return nC(e,'"'.concat(String(e),'" is not a valid event name'))}}if(void 0===t||"function"==typeof e)if("function"==typeof e)return i.storageBatch.subscribe(e);else throw Error("Please specify a listener callback");if(iR(e))return(null==o?void 0:o.isDeep)?i.storageBatch.subscribe(n=>{let i=n.filter(t=>(function e(t,n){return t===n||"HasParent"===t.parent.type&&e(t.parent.node,n)})(t.node,e));i.length>0&&t(i)}):i.storageBatch.subscribe(n=>{for(let i of n)i.node._id===e._id&&t(i.node)});throw Error("".concat(String(e)," is not a value that can be subscribed to."))}),connect:()=>p.connect(),reconnect:()=>p.reconnect(),disconnect:()=>p.disconnect(),destroy:()=>{var e;let{roomWillDestroy:t,...n}=g;for(let e of Object.values(n))e.dispose();g.roomWillDestroy.notify(),null==(e=_.yjsProvider)||e.off("status",eA),X.destroy(),eE.destroy(),f(),p.destroy(),t.dispose()},updatePresence:function(e,t){let n={};for(let t in null===_.buffer.presenceUpdates&&(_.buffer.presenceUpdates={type:"partial",data:{}}),e){let i=e[t];void 0!==i&&(_.buffer.presenceUpdates.data[t]=i,n[t]=_.myPresence.get()[t])}_.myPresence.patch(e),_.activeBatch?((null==t?void 0:t.addToHistory)&&_.activeBatch.reverseOps.pushLeft({type:"presence",data:n}),_.activeBatch.updates.presence=!0):(W(),(null==t?void 0:t.addToHistory)&&D([{type:"presence",data:n}]),N({presence:!0}))},updateYDoc:function(e,t,n){let i={type:301,update:e,guid:t,v2:n};_.buffer.messages.push(i),g.ydoc.notify(i),W()},broadcastEvent:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shouldQueueEventIfNotReady:!1};("connected"===p.getStatus()||t.shouldQueueEventIfNotReady)&&(_.buffer.messages.push({type:103,event:e}),W())},batch:function(e){let t;if(_.activeBatch)return e();_.activeBatch={ops:[],updates:{storageUpdates:new Map,presence:!1,others:[]},reverseOps:new ix};try{t=e()}finally{let e=_.activeBatch;_.activeBatch=null,e.reverseOps.length>0&&D(Array.from(e.reverseOps)),e.ops.length>0&&(_.redoStack.length=0),e.ops.length>0&&V(e.ops),N(e.updates),W()}return t},history:{undo:function(){if(_.activeBatch)throw Error("undo is not allowed during a batch");let e=_.undoStack.pop();if(void 0===e)return;_.pausedHistory=null;let t=P(e,!0);for(let e of(N(t.updates),_.redoStack.push(t.reverse),U(),t.ops))"presence"!==e.type&&_.buffer.storageOperations.push(e);W()},redo:function(){if(_.activeBatch)throw Error("redo is not allowed during a batch");let e=_.redoStack.pop();if(void 0===e)return;_.pausedHistory=null;let t=P(e,!0);for(let e of(N(t.updates),_.undoStack.push(t.reverse),U(),t.ops))"presence"!==e.type&&_.buffer.storageOperations.push(e);W()},canUndo:x,canRedo:L,clear:function(){_.undoStack.length=0,_.redoStack.length=0},pause:function(){null===_.pausedHistory&&(_.pausedHistory=new ix)},resume:function(){let e=_.pausedHistory;_.pausedHistory=null,null!==e&&e.length>0&&M(Array.from(e))}},fetchYDoc:function(e,t,n){_.buffer.messages.find(i=>300===i.type&&i.vector===e&&i.guid===t&&i.v2===n)||_.buffer.messages.push({type:300,vector:e,guid:t,v2:n}),W()},getStorage:Y,getStorageSnapshot:G,getStorageStatus:J,isPresenceReady:$,isStorageReady:et,waitUntilPresenceReady:tZ(ee),waitUntilStorageReady:tZ(en),events:er,getStatus:()=>p.getStatus(),getSelf:()=>O.get(),getPresence:()=>_.myPresence.get(),getOthers:()=>_.others.get(),getThreads:es,getThreadsSince:eo,getThread:ea,createThread:el,deleteThread:ec,editThreadMetadata:ed,markThreadAsResolved:eu,markThreadAsUnresolved:eh,subscribeToThread:ef,unsubscribeFromThread:ep,createComment:e_,editComment:em,deleteComment:eg,addReaction:ev,removeReaction:ey,prepareAttachment:function(e){return{type:"localAttachment",status:"idle",id:np("at"),name:e.name,size:e.size,mimeType:e.type,file:e}},uploadAttachment:eb,getAttachmentUrl:function(e){return u.getAttachmentUrl({roomId:l,attachmentId:e})},getNotificationSettings:ew,getSubscriptionSettings:ew,updateNotificationSettings:eS,updateSubscriptionSettings:eS,markInboxNotificationAsRead:eI},n4,{enumerable:!1})}({initialPresence:null!=(o="function"==typeof I.initialPresence?I.initialPresence(t):I.initialPresence)?o:{},initialStorage:null!=(d="function"==typeof I.initialStorage?I.initialStorage(t):I.initialStorage)?d:{}},{roomId:t,throttleDelay:s,lostConnectionTimeout:a,backgroundKeepAliveTimeout:l,polyfills:e.polyfills,delegates:null!=(_=e.mockedDelegates)?_:{createSocket:(n=null==(i=e.polyfills)?void 0:i.WebSocket,e=>{let i=null!=n?n:"undefined"==typeof WebSocket?void 0:WebSocket;if(void 0===i)throw new nq("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");let r=new URL(c);if(r.protocol="http:"===r.protocol?"ws":"wss",r.pathname="/v7",r.searchParams.set("roomId",t),"secret"===e.type)r.searchParams.set("tok",e.token.raw);else{if("public"!==e.type)return nC(e,"Unhandled case");r.searchParams.set("pubkey",e.publicApiKey)}return r.searchParams.set("version",tI||"dev"),new i(r.toString())}),authenticate:async()=>u.getAuthValue({requestedScope:"room:read",roomId:t})},enableDebugLogging:e.enableDebugLogging,baseUrl:c,errorEventSource:E,largeMessageStrategy:null!=(m=e.largeMessageStrategy)?m:e.unstable_fallbackToHTTP?"experimental-fallback-to-http":void 0,unstable_streamData:!!e.unstable_streamData,roomHttpClient:h,createSyncSource:T}),k={room:A,unsubs:new Set};if(f.set(t,k),null==(g=I.autoConnect)||g){if("undefined"==typeof atob){if((null==(v=e.polyfills)?void 0:v.atob)===void 0)throw Error("You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill");globalThis.atob=e.polyfills.atob}A.connect()}return p(k)},getRoom:function(e){var t;return(null==(t=f.get(e))?void 0:t.room)||null},logout:function(){for(let{room:t}of(u.reset(),d.set(()=>void 0),f.values())){var e;"initial"!==(e=t.getStatus())&&"disconnected"!==e&&t.reconnect()}},getInboxNotifications:h.getInboxNotifications,getInboxNotificationsSince:h.getInboxNotificationsSince,getUnreadInboxNotificationsCount:h.getUnreadInboxNotificationsCount,markAllInboxNotificationsAsRead:h.markAllInboxNotificationsAsRead,markInboxNotificationAsRead:h.markInboxNotificationAsRead,deleteAllInboxNotifications:h.deleteAllInboxNotifications,deleteInboxNotification:h.deleteInboxNotification,getNotificationSettings:k,updateNotificationSettings:O,resolvers:{invalidateUsers:function(e){g.invalidate(e)},invalidateRoomsInfo:function(e){b.invalidate(e)},invalidateMentionSuggestions:function(){w.clear()}},getSyncStatus:function(){let e=I.get();return"synchronizing"===e?e:"synchronized"},events:{error:E,syncStatus:I},[n4]:{currentUserId:d,mentionSuggestionsCache:w,resolveMentionSuggestions:e.resolveMentionSuggestions,usersStore:g,roomsInfoStore:b,getRoomIds:()=>Array.from(f.keys()),httpClient:h,as:()=>C,createSyncSource:T,emitError:(e,t)=>{let n=iW.from(e,t);E.notify(n)||tj(n.message)}}},n4,{enumerable:!1});return C}function iK(e,t,n,i,r){if("number"!=typeof t||t<n||void 0!==i&&t>i)throw Error(void 0!==i?"".concat(e," should be between ").concat(null!=r?r:n," and ").concat(i,"."):"".concat(e," should be at least ").concat(null!=r?r:n,"."));return t}function iq(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return()=>{}}var iH={paragraph:function(e){return"type"in e&&"paragraph"===e.type},text:function(e){return!("type"in e)&&"text"in e&&"string"==typeof e.text},link:function(e){return"type"in e&&"link"===e.type},mention:function(e){return"type"in e&&"mention"===e.type}},iz={paragraph:"block",text:"inline",link:"inline",mention:"inline"};function iB(e){let t=new Set;return!function(e,t,n){if(!e||!(null==e?void 0:e.content))return;let i="string"==typeof t?t:void 0,r=i?iz[i]:"all",o=i?iH[i]:()=>!0,s="function"==typeof t?t:n;for(let t of e.content)if(("all"===r||"block"===r)&&o(t)&&(null==s||s(t)),"all"===r||"inline"===r)for(let e of t.children)o(e)&&(null==s||s(e))}(e,"mention",e=>t.add(e.id)),Array.from(t)}var iG={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},iY=RegExp(Object.keys(iG).map(e=>"\\".concat(e)).join("|"),"g"),iX=(eA=new WeakMap,eT=new WeakMap,class{toString(){return(0,eM._)(this,eA).reduce((e,t,n)=>e+function(e){if(e instanceof iX)return e.toString();if(Array.isArray(e))return(e.length<=0?new iX([""],[]):new iX(["",...Array(e.length-1).fill(""),""],e)).toString();return String(e).replace(iY,e=>iG[e])}(nM((0,eM._)(this,eT)[n-1]))+t)}constructor(e,t){(0,eD._)(this,eA,{writable:!0,value:void 0}),(0,eD._)(this,eT,{writable:!0,value:void 0}),(0,eN._)(this,eA,e),(0,eN._)(this,eT,t)}}),iJ={_:"\\_","*":"\\*","#":"\\#","`":"\\`","~":"\\~","!":"\\!","|":"\\|","(":"\\(",")":"\\)","{":"\\{","}":"\\}","[":"\\[","]":"\\]"},iZ=RegExp(Object.keys(iJ).map(e=>"\\".concat(e)).join("|"),"g"),iQ=(ek=new WeakMap,eO=new WeakMap,class{toString(){return(0,eM._)(this,ek).reduce((e,t,n)=>e+function(e){if(e instanceof iQ)return e.toString();if(Array.isArray(e))return(e.length<=0?new iQ([""],[]):new iQ(["",...Array(e.length-1).fill(""),""],e)).toString();return String(e).replace(iZ,e=>iJ[e])}(nM((0,eM._)(this,eO)[n-1]))+t)}constructor(e,t){(0,eD._)(this,ek,{writable:!0,value:void 0}),(0,eD._)(this,eO,{writable:!0,value:void 0}),(0,eN._)(this,ek,e),(0,eN._)(this,eO,t)}}),i$=[1e3,2e3,4e3,8e3,1e4];function i0(e,t,n){var i;let r=performance.now(),o="undefined"!=typeof document?document:void 0,s="undefined"!=typeof window?window:void 0,a=null!=(i=null==n?void 0:n.maxStaleTimeMs)?i:1/0,l={inForeground:(null==o?void 0:o.visibilityState)!=="hidden",lastSuccessfulPollAt:r,count:0,backoff:0};function c(){return l.count>0&&l.inForeground}let d=new nP({}).addState("@idle").addState("@enabled").addState("@polling");function u(){c()?d.send({type:"START"}):d.send({type:"STOP"})}function h(){performance.now()-l.lastSuccessfulPollAt>a&&d.send({type:"POLL"})}function f(e){l.inForeground=e,u(),h()}function p(){f((null==o?void 0:o.visibilityState)!=="hidden")}return d.addTransitions("@idle",{START:"@enabled"}),d.addTransitions("@enabled",{STOP:"@idle",POLL:"@polling"}),d.addTimedTransition("@enabled",()=>Math.max(0,l.lastSuccessfulPollAt+t-performance.now())+l.backoff,"@polling"),d.onEnterAsync("@polling",async(t,n)=>{await e(n),n.aborted||(l.lastSuccessfulPollAt=performance.now())},()=>({target:c()?"@enabled":"@idle",effect:()=>{l.backoff=0}}),()=>({target:c()?"@enabled":"@idle",effect:()=>{var e;l.backoff=null!=(e=i$.find(e=>e>l.backoff))?e:i$[i$.length-1]}}),3e4),null==o||o.addEventListener("visibilitychange",p),null==s||s.addEventListener("online",p),null==s||s.addEventListener("focus",h),d.start(),{inc:function(){l.count++,u()},dec:function(){l.count--,l.count<0&&(l.count=0),u()},pollNowIfStale:h,markAsStale:function(){l.lastSuccessfulPollAt=performance.now()-a-1},setInForeground:f}}function i1(e,t){if(Object.is(e,t))return!0;let n=Array.isArray(e),i=Array.isArray(t);if(n||i){if(!n||!i)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}if(!tK(e)||!tK(t))return!1;let r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(n=>Object.prototype.hasOwnProperty.call(t,n)&&Object.is(e[n],t[n]))}function i2(e,t){if(!tK(e)||!tK(t))return i1(e,t);let n=Object.keys(e);return n.length===Object.keys(t).length&&n.every(n=>Object.prototype.hasOwnProperty.call(t,n)&&i1(e[n],t[n]))}var i3=(eC=new WeakMap,eR=new WeakMap,class e{static from(t,n){let i=new e([],n);for(let e of t)i.add(e);return i}static fromAlreadySorted(t,n){return new e(t,n)}clone(){return new e((0,eM._)(this,eC).slice(),(0,eM._)(this,eR))}add(e){let t=function(e,t,n){let i=0,r=e.length;for(;i<r;){let o=i+(r-i>>1);n(t,e[o])?r=o:i=o+1}return i}((0,eM._)(this,eC),e,(0,eM._)(this,eR));(0,eM._)(this,eC).splice(t,0,e)}remove(e){let t=(0,eM._)(this,eC).indexOf(e);return t>=0&&((0,eM._)(this,eC).splice(t,1),!0)}get length(){return(0,eM._)(this,eC).length}*filter(e){for(let t of(0,eM._)(this,eC))e(t)&&(yield t)}[Symbol.iterator](){return(0,eM._)(this,eC)[Symbol.iterator]()}constructor(e,t){(0,eD._)(this,eC,{writable:!0,value:void 0}),(0,eD._)(this,eR,{writable:!0,value:void 0}),(0,eN._)(this,eR,t),(0,eN._)(this,eC,e)}});function i5(e,t){return"string"==typeof e?"".concat(e,":").concat(t):"".concat(e.kind,":").concat(e.subjectId)}var i8=(e=>(e.Lexical="lexical",e.TipTap="tiptap",e.BlockNote="blocknote",e))(i8||{});function i4(){let e,t=t7;t7=new Set;try{e=(0,eM._)(this,a).call(this,...(0,eM._)(this,s).map(e=>e.get()))}finally{let e=(0,eM._)(this,o);for(let t of((0,eN._)(this,o,new Set),t7))(0,eM._)(this,o).add(t),e.delete(t);for(let t of e)t.removeSink(this);for(let e of(0,eM._)(this,o))e.addSink(this);t7=t}return(0,eN._)(this,r,!1),!this.equals((0,eM._)(this,i),e)&&((0,eN._)(this,i,e),!0)}function i7(){void 0!==(0,eM._)(this,p)&&(clearTimeout((0,eM._)(this,p)),(0,eN._)(this,p,void 0))}function i6(){(0,eM._)(this,d).length===(0,eM._)(this,h)?(0,ex._)(this,g,i9).call(this):1===(0,eM._)(this,d).length&&((0,ex._)(this,_,i7).call(this),(0,eN._)(this,p,setTimeout(()=>void(0,ex._)(this,g,i9).call(this),(0,eM._)(this,f))))}async function i9(){if(0===(0,eM._)(this,d).length)return;let e=(0,eM._)(this,d).splice(0),t=e.map(e=>e.input);try{let n=await (0,eM._)(this,u).call(this,t);this.error=!1,e.forEach((t,i)=>{let r=null==n?void 0:n[i];Array.isArray(n)?e.length!==n.length?t.reject(Error("Callback must return an array of the same length as the number of provided items. Expected ".concat(e.length,", but got ").concat(n.length,"."))):r instanceof Error?t.reject(r):t.resolve(r):t.reject(Error("Callback must return an array."))})}catch(t){this.error=!0,e.forEach(e=>{e.reject(t)})}}async function re(e,t,n,i){e.startsWith("/v2/c/")||tH("This client can only be used to make /v2/c/* requests");let r=function(e,t,n){let i=new URL(t,e);return void 0!==n&&(i.search=(n instanceof URLSearchParams?n:function(e){let t=new URLSearchParams;for(let[n,i]of Object.entries(e))null!=i&&t.set(n,i.toString());return t}(n)).toString()),i.toString()}((0,eM._)(this,y),e,i);return await (0,eM._)(this,b).call(this,r,{...n,headers:{"Content-Type":"application/json; charset=utf-8",...null==n?void 0:n.headers,Authorization:"Bearer ".concat(nk(t)),"X-LB-Client":tI||"dev"}})}async function rt(e,t,n,i){let r,o=await (0,ex._)(this,w,re).call(this,e,t,n,i);if(!o.ok)throw await tQ.fromResponse(o);try{r=await o.json()}catch(e){r={}}return r}function rn(){let e=(0,eM._)(this,T).values()[Symbol.iterator]().next();if(!e.done)return e.value;throw Error("No states defined yet")}function ri(e){let t=[];if("*"===e)for(let e of(0,eM._)(this,T))t.push(e);else if(e.endsWith(".*")){let n=e.slice(0,-1);for(let e of(0,eM._)(this,T))e.startsWith(n)&&t.push(e)}else(0,eM._)(this,T).has(e)&&t.push(e);if(0===t.length)throw Error("No states match ".concat(JSON.stringify(e)));return t}function rr(e){var t;return null==(t=(0,eM._)(this,O).get(this.currentState))?void 0:t.get(e)}function ro(e){(0,eM._)(this,C).willExitState.notify(this.currentState),(0,eM._)(this,A).allowPatching(t=>{e=null!=e?e:(0,eM._)(this,R).length;for(let i=0;i<e;i++){var n;null==(n=(0,eM._)(this,R).pop())||n(t)}})}function rs(e){let t=function(e,t){let n=e.split(".");if(t<1||t>n.length+1)throw Error("Invalid number of levels");let i=[];t>n.length&&i.push("*");for(let e=n.length-t+1;e<n.length;e++){let t=n.slice(0,e);t.length>0&&i.push(t.join(".")+".*")}return i.push(e),i}(this.currentState,null!=e?e:this.currentState.split(".").length+1);(0,eM._)(this,A).allowPatching(e=>{for(let n of t){let t=(0,eM._)(this,M).get(n),i=null==t?void 0:t(e);"function"==typeof i?(0,eM._)(this,R).push(i):(0,eM._)(this,R).push(null)}}),(0,eM._)(this,C).didEnterState.notify(this.currentState)}function ra(e,t){let n,i;(0,eM._)(this,C).didReceiveEvent.notify(e);let r=this.currentState,o=("function"==typeof t?t:()=>t)(e,(0,eM._)(this,A).current);if(null===o)return void(0,eM._)(this,C).didIgnoreEvent.notify(e);if("string"==typeof o?n=o:(n=o.target,i=Array.isArray(o.effect)?o.effect:[o.effect]),!(0,eM._)(this,T).has(n))throw Error("Invalid next state name: ".concat(JSON.stringify(n)));(0,eM._)(this,C).willTransition.notify({from:r,to:n});let[s,a]=function(e,t){if(e===t)return[0,0];let n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length),o=0;for(;o<r&&n[o]===i[o];o++);return[n.length-o,i.length-o]}(this.currentState,n);if(s>0&&(0,ex._)(this,L,ro).call(this,s),(0,eN._)(this,k,n),void 0!==i){let t=i;(0,eM._)(this,A).allowPatching(n=>{for(let i of t)"function"==typeof i?i(n,e):n.patch(i)})}a>0&&(0,ex._)(this,U,rs).call(this,a)}function rl(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let{id:t,parentKey:n}=e,i=iT(e);i._attach(t,this._pool),i._setParentLink(this,n);let r=e.deletedId,o=this._indexOfPosition(n);if(-1!==o){let t=(0,eM._)(this,Y)[o];if(t._id===r)return t._detach(),(0,eM._)(this,Y)[o]=i,{modified:iv(this,[iy(o,i)]),reverse:[]};{(0,eM._)(this,X).add(t),(0,eM._)(this,Y)[o]=i;let n=[iy(o,i)],r=(0,ex._)(this,$,rd).call(this,e.deletedId);return r&&n.push(r),{modified:iv(this,n),reverse:[]}}}{let t=[],r=(0,ex._)(this,$,rd).call(this,e.deletedId);return r&&t.push(r),this._insertAndSort(i),t.push(iw(this._indexOfPosition(n),i)),{reverse:[],modified:iv(this,t)}}}function rc(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=[],n=(0,ex._)(this,$,rd).call(this,e.deletedId);n&&t.push(n);let i=(0,eM._)(this,J).get(e.parentKey);if(void 0!==i)if(i!==e.opId)return 0===t.length?{modified:!1}:{modified:iv(this,t),reverse:[]};else(0,eM._)(this,J).delete(e.parentKey);let r=this._indexOfPosition(e.parentKey),o=(0,eM._)(this,Y).find(t=>t._id===e.id);if(void 0!==o){if(o._parentKey===e.parentKey)return{modified:t.length>0&&iv(this,t),reverse:[]};if(-1!==r){(0,eM._)(this,X).add((0,eM._)(this,Y)[r]);let[e]=(0,eM._)(this,Y).splice(r,1);t.push(ib(r,e))}let n=(0,eM._)(this,Y).indexOf(o);o._setParentLink(this,e.parentKey),this._sortItems();let i=(0,eM._)(this,Y).indexOf(o);return i!==n&&t.push(iS(n,i,o)),{modified:t.length>0&&iv(this,t),reverse:[]}}{let n=this._pool.getNode(e.id);if(n&&(0,eM._)(this,X).has(n)){n._setParentLink(this,e.parentKey),(0,eM._)(this,X).delete(n),this._insertAndSort(n);let i=(0,eM._)(this,Y).indexOf(n);return{modified:iv(this,[-1===r?iw(i,n):iy(i,n),...t]),reverse:[]}}{-1!==r&&(0,eM._)(this,Y).splice(r,1);let{newItem:n,newIndex:i}=(0,ex._)(this,ea,rv).call(this,e,e.parentKey);return{modified:iv(this,[-1===r?iw(i,n):iy(i,n),...t]),reverse:[]}}}}function rd(e){if(void 0===e||void 0===this._pool)return null;let t=this._pool.getNode(e);if(void 0===t)return null;let n=this._detachChild(t);return!1===n.modified?null:n.modified.updates[0]}function ru(e){if(void 0===this._pool)throw Error("Can't attach child if managed pool is not present");let t=ia(e.parentKey),n=this._indexOfPosition(t);-1!==n&&(0,ex._)(this,el,ry).call(this,n,t);let{newItem:i,newIndex:r}=(0,ex._)(this,ea,rv).call(this,e,t);return{modified:iv(this,[iw(r,i)]),reverse:[]}}function rh(e){let t=(0,eM._)(this,Y).find(t=>t._id===e.id),n=ia(e.parentKey),i=this._indexOfPosition(n);if(t)if(t._parentKey===n)return{modified:!1};else{let e=(0,eM._)(this,Y).indexOf(t);-1!==i&&(0,ex._)(this,el,ry).call(this,i,n),t._setParentLink(this,n),this._sortItems();let r=this._indexOfPosition(n);return r===e?{modified:!1}:{modified:iv(this,[iS(e,r,t)]),reverse:[]}}{let t=nM(this._pool).getNode(e.id);if(t&&(0,eM._)(this,X).has(t))return t._setParentLink(this,n),(0,eM._)(this,X).delete(t),this._insertAndSort(t),{modified:iv(this,[iw(this._indexOfPosition(n),t)]),reverse:[]};{-1!==i&&(0,ex._)(this,el,ry).call(this,i,n);let{newItem:t,newIndex:r}=(0,ex._)(this,ea,rv).call(this,e,n);return{modified:iv(this,[iw(r,t)]),reverse:[]}}}}function rf(e){var t,n,i;let{id:r,parentKey:o}=e,s=iT(e);if((null==(t=this._pool)?void 0:t.getNode(r))!==void 0)return{modified:!1};s._attach(r,nM(this._pool)),s._setParentLink(this,o);let a=this._indexOfPosition(o),l=o;return -1!==a&&(l=io(null==(n=(0,eM._)(this,Y)[a])?void 0:n._parentPos,null==(i=(0,eM._)(this,Y)[a+1])?void 0:i._parentPos),s._setParentLink(this,l)),this._insertAndSort(s),{modified:iv(this,[iw(this._indexOfPosition(l),s)]),reverse:[{type:5,id:r}]}}function rp(e){var t;let{id:n,parentKey:i}=e,r=iT(e);if((null==(t=this._pool)?void 0:t.getNode(n))!==void 0)return{modified:!1};(0,eM._)(this,J).set(i,nM(e.opId));let o=this._indexOfPosition(i);if(r._attach(n,nM(this._pool)),r._setParentLink(this,i),-1===o)return this._insertAndSort(r),(0,ex._)(this,$,rd).call(this,e.deletedId),{reverse:[{type:5,id:n}],modified:iv(this,[iw(this._indexOfPosition(i),r)])};{let t=(0,eM._)(this,Y)[o];t._detach(),(0,eM._)(this,Y)[o]=r;let n=iI(t._toOps(nM(this._id),i,this._pool),e.id),s=[iy(o,r)],a=(0,ex._)(this,$,rd).call(this,e.deletedId);return a&&s.push(a),{modified:iv(this,s),reverse:n}}}function r_(e,t){if((0,eM._)(this,X).has(t))return(0,eM._)(this,X).delete(t),t._setParentLink(this,e),this._insertAndSort(t),{modified:iv(this,[iw((0,eM._)(this,Y).indexOf(t),t)]),reverse:[]};if(e===t._parentKey)return{modified:!1};let n=this._indexOfPosition(e);if(-1===n){let n=(0,eM._)(this,Y).indexOf(t);t._setParentLink(this,e),this._sortItems();let i=(0,eM._)(this,Y).indexOf(t);return i===n?{modified:!1}:{modified:iv(this,[iS(n,i,t)]),reverse:[]}}{var i;(0,eM._)(this,Y)[n]._setParentLink(this,io(e,null==(i=(0,eM._)(this,Y)[n+1])?void 0:i._parentPos));let r=(0,eM._)(this,Y).indexOf(t);t._setParentLink(this,e),this._sortItems();let o=(0,eM._)(this,Y).indexOf(t);return o===r?{modified:!1}:{modified:iv(this,[iS(r,o,t)]),reverse:[]}}}function rm(e,t){var n,i;let r=nM(t._parentKey);if((0,eM._)(this,X).has(t)){let i=this._indexOfPosition(e);return(0,eM._)(this,X).delete(t),-1!==i&&(0,eM._)(this,Y)[i]._setParentLink(this,io(e,null==(n=(0,eM._)(this,Y)[i+1])?void 0:n._parentPos)),t._setParentLink(this,e),this._insertAndSort(t),{modified:!1}}{if(e===r)return{modified:!1};let n=(0,eM._)(this,Y).indexOf(t),o=this._indexOfPosition(e);-1!==o&&(0,eM._)(this,Y)[o]._setParentLink(this,io(e,null==(i=(0,eM._)(this,Y)[o+1])?void 0:i._parentPos)),t._setParentLink(this,e),this._sortItems();let s=(0,eM._)(this,Y).indexOf(t);return n===s?{modified:!1}:{modified:iv(this,[iS(n,s,t)]),reverse:[]}}}function rg(e,t){let n=nM(t._parentKey),i=(0,eM._)(this,Y).indexOf(t),r=this._indexOfPosition(e);if(-1!==r){var o;(0,eM._)(this,Y)[r]._setParentLink(this,io(e,null==(o=(0,eM._)(this,Y)[r+1])?void 0:o._parentPos))}t._setParentLink(this,e),this._sortItems();let s=(0,eM._)(this,Y).indexOf(t);return i===s?{modified:!1}:{modified:iv(this,[iS(i,s,t)]),reverse:[{type:1,id:nM(t._id),parentKey:n}]}}function rv(e,t){let n=iT(e);return n._attach(e.id,nM(this._pool)),n._setParentLink(this,t),this._insertAndSort(n),{newItem:n,newIndex:this._indexOfPosition(t)}}function ry(e,t){var n;let i=io(t,(0,eM._)(this,Y).length>e+1?null==(n=(0,eM._)(this,Y)[e+1])?void 0:n._parentPos:void 0);(0,eM._)(this,Y)[e]._setParentLink(this,i)}function rb(e){let t=new Map,n=null;for(let[r,o]of e){var i;if(0!==o.type||void 0!==(i=o).parentId&&void 0!==i.parentKey){let e=[r,o],n=t.get(o.parentId);void 0!==n?n.push(e):t.set(o.parentId,[e])}else n=[r,o]}if(null===n)throw Error("Root can't be null");return[n,t]}function rw(e,t){let n=!1,i=nM(this._id),r=[],o={type:3,id:i,data:{}};for(let t in e.data){let e=(0,eM._)(this,eh).get(t);iR(e)?(r.push(...e._toOps(i,t)),e._detach()):void 0!==e?o.data[t]=e:void 0===e&&r.push({type:6,id:i,key:t})}let s={};for(let i in e.data){let r=e.data[i];if(void 0===r)continue;if(t)(0,eM._)(this,ef).set(i,nM(e.opId));else if(void 0===(0,eM._)(this,ef).get(i))n=!0;else{if((0,eM._)(this,ef).get(i)!==e.opId)continue;(0,eM._)(this,ef).delete(i);continue}let o=(0,eM._)(this,eh).get(i);iR(o)&&o._detach(),n=!0,s[i]={type:"update"},(0,eM._)(this,eh).set(i,r),this.invalidate()}return 0!==Object.keys(o.data).length&&r.unshift(o),n?{modified:{node:this,type:"LiveObject",updates:s},reverse:r}:{modified:!1}}function rS(e,t){let n=e.key;if(!1===(0,eM._)(this,eh).has(n)||!t&&void 0!==(0,eM._)(this,ef).get(n))return{modified:!1};let i=(0,eM._)(this,eh).get(n),r=nM(this._id),o=[];return iR(i)?(o=i._toOps(r,e.key),i._detach()):void 0!==i&&(o=[{type:3,id:r,data:{[n]:i}}]),(0,eM._)(this,eh).delete(n),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[e.key]:{type:"delete"}}},reverse:o}}function rI(e){let t=(0,eM._)(this,ew).get(),n=t.connections.get(e),i=t.presences.get(e);if(void 0!==n&&void 0!==i){let{connectionId:e,id:t,info:r}=n,o=n2(n.scopes);return tX({connectionId:e,id:t,info:r,canWrite:o,canComment:n3(n.scopes),isReadOnly:!o,presence:i})}}function rE(e){(0,eM._)(this,eS).delete(e)}tT(tS,tI,"esm")},208955:e=>{"use strict";e.s({LiveblocksProvider:()=>et,_RoomProvider:()=>ec,_useRoom:()=>ed,_useSelf:()=>eu});var t,n,i,r,o,s,a,l,c,d,u,h,f,p,_,m,g,v,y,b,w=e.i(632859),S=e.i(526050),I=e.i(607618),E=e.i(238193),A=e.i(526350),T=e.i(11968),k=e.i(373150),O=e.i(356356),C=e.i(290479),R=(0,k.createContext)(null);function M(e,t,n,i,r){let o,s=(0,k.useRef)(null);null===s.current?s.current=o={hasValue:!1,value:null}:o=s.current;let[a,l]=(0,k.useMemo)(()=>{let e,s,a=!1,l=t=>{var n;if(!a){a=!0,e=t;let n=i(t);if(void 0!==r&&o.hasValue){let e=o.value;if(r(e,n))return s=e,e}return s=n,n}let l=s;if((n=e)===t&&(0!==n||1/n==1/t)||n!=n&&t!=t)return l;let c=i(t);return void 0!==r&&r(l,c)?(e=t,l):(e=t,s=c,c)},c=void 0===n?null:n;return[()=>l(t()),null===c?void 0:()=>l(c())]},[t,n,i,r]),c=(0,k.useSyncExternalStore)(e,a,l);return(0,k.useEffect)(()=>{o.hasValue=!0,o.value=c},[c]),(0,k.useDebugValue)(c),c}var D={ROOM_THREADS_POLL_INTERVAL:3e5,ROOM_THREADS_MAX_STALE_TIME:5e3,HISTORY_VERSIONS_POLL_INTERVAL:6e4,HISTORY_VERSIONS_MAX_STALE_TIME:5e3,ROOM_SUBSCRIPTION_SETTINGS_POLL_INTERVAL:6e4,ROOM_SUBSCRIPTION_SETTINGS_MAX_STALE_TIME:5e3},N=Object.freeze({isLoading:!0}),P=e=>Object.freeze({isLoading:!1,error:e});function x(e,t){return 1==arguments.length?Object.freeze({isLoading:!1,data:e}):Object.freeze({isLoading:!1,[e]:t})}var L=e=>e;function U(e){return(0,k.useReducer)(L,e)[0]}function j(e){let t=U(e);if("function"!=typeof t)return t;{let t=function(e){let t=(0,k.useRef)(e);return(0,k.useEffect)(()=>{t.current=e},[e]),t}(e);return(0,k.useCallback)(function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.current(...n)},[t])}}function W(e){let t=new Set;t.add("constructor");let n=e.constructor.prototype;do for(let i of Reflect.ownKeys(n)){if(t.has(i))continue;let r=Reflect.getOwnPropertyDescriptor(n,i);"function"==typeof(null==r?void 0:r.value)&&(t.add(i),e[i]=e[i].bind(e))}while((n=Reflect.getPrototypeOf(n))&&n!==Object.prototype)}var V=(t=new WeakMap,n=new WeakMap,i=new WeakMap,class e{clone(){let r=new e;return(0,I._)(r,t,new Map((0,w._)(this,t))),(0,I._)(r,n,(0,w._)(this,n).clone()),(0,I._)(r,i,(0,w._)(this,i).clone()),r}get(e){let t=this.getEvenIfDeleted(e);return(null==t?void 0:t.deletedAt)?void 0:t}getEvenIfDeleted(e){return(0,w._)(this,t).get(e)}upsert(e){this.signal.mutate(()=>{var r;let o=(e=(r=e).deletedAt&&r.comments.length>0?{...r,comments:[]}:!r.comments.some(e=>!e.deletedAt)?{...r,deletedAt:new Date,comments:[]}:r).id,s=(0,w._)(this,t).get(o);if(s){if(s.deletedAt)return!1;(0,w._)(this,n).remove(s),(0,w._)(this,i).remove(s)}return e.deletedAt||((0,w._)(this,n).add(e),(0,w._)(this,i).add(e)),(0,w._)(this,t).set(o,e),!0})}upsertIfNewer(e){let t=this.get(e.id);(!t||e.updatedAt>=t.updatedAt)&&this.upsert(e)}applyDelta(e,t){(0,O.batch)(()=>{for(let t of e)this.upsertIfNewer(t);for(let{id:e,deletedAt:n}of t)this.getEvenIfDeleted(e)&&this.delete(e,n)})}delete(e,n){let i=(0,w._)(this,t).get(e);i&&!i.deletedAt&&this.upsert({...i,deletedAt:n,updatedAt:n})}findMany(e,t,r){let o="desc"===r?(0,w._)(this,i):(0,w._)(this,n),s=[];return void 0!==e&&s.push(t=>t.roomId===e),void 0!==t&&s.push(e=>{var n,i;return n=e,(void 0===(i=t).resolved||n.resolved===i.resolved)&&function(e,t){let n=e.metadata;return void 0===t.metadata||Object.entries(t.metadata).every(e=>{var t,i;let[r,o]=e;return void 0===o||(t=n[r],null===(i=o)?void 0===t:(0,O.isStartsWithOperator)(i)?"string"==typeof t&&t.startsWith(i.startsWith):t===i)})}(e,t)}),Array.from(o.filter(e=>s.every(t=>t(e))))}constructor(){(0,S._)(this,t,{writable:!0,value:void 0}),(0,S._)(this,n,{writable:!0,value:void 0}),(0,S._)(this,i,{writable:!0,value:void 0}),(0,T._)(this,"signal",void 0),(0,I._)(this,n,O.SortedList.from([],(e,t)=>{let n=e.createdAt,i=t.createdAt;return n<i||n===i&&e.id<t.id})),(0,I._)(this,i,O.SortedList.from([],(e,t)=>{let n=t.updatedAt,i=e.updatedAt;return n<i||n===i&&t.id<e.id})),(0,I._)(this,t,new Map),this.signal=new O.MutableSignal(this)}});function F(e){return"status"in e||(e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t})),e}var K=Promise.resolve(),q=(r=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakSet,l=new WeakSet,c=new WeakMap,class{get(){return(0,w._)(this,r).get()}fetchMore(){var e;return(null==(e=(0,w._)(this,r).get().data)?void 0:e.cursor)?((0,w._)(this,s)||(0,I._)(this,s,(0,E._)(this,l,ef).call(this).finally(()=>{(0,I._)(this,s,null)})),(0,w._)(this,s)):K}waitUntilLoaded(){if((0,w._)(this,c))return(0,w._)(this,c);let e=F((0,O.autoRetry)(()=>(0,w._)(this,o).call(this,void 0),5,[5e3,5e3,1e4,15e3]));return e.then(e=>{(0,w._)(this,r).set(x({cursor:e,hasFetchedAll:null===e,isFetchingMore:!1,fetchMoreError:void 0,fetchMore:this.fetchMore}))},e=>{(0,w._)(this,r).set(P(e)),setTimeout(()=>{(0,I._)(this,c,null),(0,w._)(this,r).set(N)},5e3)}),(0,I._)(this,c,e),(0,w._)(this,c)}constructor(e){(0,A._)(this,a),(0,A._)(this,l),(0,S._)(this,r,{writable:!0,value:void 0}),(0,T._)(this,"signal",void 0),(0,S._)(this,o,{writable:!0,value:void 0}),(0,S._)(this,s,{writable:!0,value:void 0}),(0,S._)(this,c,{writable:!0,value:null}),(0,I._)(this,r,new O.Signal(N)),(0,I._)(this,o,e),(0,I._)(this,s,null),this.signal=(0,w._)(this,r).asReadonly(),W(this)}}),H=(d=new WeakMap,u=new WeakMap,h=new WeakMap,class{get(){return(0,w._)(this,d).get()}waitUntilLoaded(){if((0,w._)(this,h))return(0,w._)(this,h);let e=F((0,O.autoRetry)(()=>(0,w._)(this,u).call(this),5,[5e3,5e3,1e4,15e3]));return e.then(()=>{(0,w._)(this,d).set(x(void 0))},e=>{(0,w._)(this,d).set(P(e)),setTimeout(()=>{(0,I._)(this,h,null),(0,w._)(this,d).set(N)},5e3)}),(0,I._)(this,h,e),e}constructor(e){(0,S._)(this,d,{writable:!0,value:void 0}),(0,T._)(this,"signal",void 0),(0,S._)(this,u,{writable:!0,value:void 0}),(0,S._)(this,h,{writable:!0,value:null}),(0,I._)(this,d,new O.Signal(N)),this.signal=(0,w._)(this,d).asReadonly(),(0,I._)(this,u,e),W(this)}}),z=(f=new WeakMap,p=new WeakMap,_=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,b=new WeakSet,class{markInboxNotificationRead(e,t,n){(0,O.batch)(()=>{this.optimisticUpdates.remove(n),this.notifications.markRead(e,t)})}markAllInboxNotificationsRead(e,t){(0,O.batch)(()=>{this.optimisticUpdates.remove(e),this.notifications.markAllRead(t)})}deleteInboxNotification(e,t){(0,O.batch)(()=>{this.optimisticUpdates.remove(t),this.notifications.delete(e)})}deleteAllInboxNotifications(e){(0,O.batch)(()=>{this.optimisticUpdates.remove(e),this.notifications.clear()})}createSubscription(e,t){(0,O.batch)(()=>{this.optimisticUpdates.remove(t),this.subscriptions.create(e)})}deleteSubscription(e,t){(0,O.batch)(()=>{this.optimisticUpdates.remove(t),this.subscriptions.delete(e)})}createThread(e,t){(0,O.batch)(()=>{this.optimisticUpdates.remove(e),this.threads.upsert(t)})}patchThread(e,t,n,i){return(0,E._)(this,b,ep).call(this,e,t,e=>({...e,...(0,O.compactObject)(n)}),i)}addReaction(e,t,n,i,r){(0,E._)(this,b,ep).call(this,e,t,e=>Y(e,n,i),r)}removeReaction(e,t,n,i,r,o){(0,E._)(this,b,ep).call(this,e,t,e=>X(e,n,i,r,o),o)}deleteThread(e,t){return(0,E._)(this,b,ep).call(this,e,t,e=>({...e,updatedAt:new Date,deletedAt:new Date}))}createComment(e,t){(0,O.batch)(()=>{this.optimisticUpdates.remove(t);let n=this.threads.get(e.threadId);n&&(this.threads.upsert(B(n,e)),this.notifications.updateAssociatedNotification(e))})}editComment(e,t,n){return(0,E._)(this,b,ep).call(this,e,t,e=>B(e,n))}deleteComment(e,t,n,i){return(0,E._)(this,b,ep).call(this,e,t,e=>G(e,n,i),i)}updateThreadifications(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];(0,O.batch)(()=>{this.threads.applyDelta(e,i),this.notifications.applyDelta(t,r),this.subscriptions.applyDelta(n,o)})}updateRoomSubscriptionSettings(e,t,n){(0,O.batch)(()=>{this.optimisticUpdates.remove(t),this.roomSubscriptionSettings.update(e,n)})}async fetchNotificationsDeltaUpdate(e){let t=(0,w._)(this,p);if(null===t)return;let n=await (0,w._)(this,f).getInboxNotificationsSince({since:t,signal:e});t<n.requestedAt&&(0,I._)(this,p,n.requestedAt),this.updateThreadifications(n.threads.updated,n.inboxNotifications.updated,n.subscriptions.updated,n.threads.deleted,n.inboxNotifications.deleted,n.subscriptions.deleted)}async fetchRoomThreadsDeltaUpdate(e,t){let n=(0,w._)(this,m).get(e);if(void 0===n)return;let i=await (0,w._)(this,f)[O.kInternal].httpClient.getThreadsSince({roomId:e,since:n,signal:t});this.updateThreadifications(i.threads.updated,i.inboxNotifications.updated,i.subscriptions.updated,i.threads.deleted,i.inboxNotifications.deleted,i.subscriptions.deleted),this.permissionHints.update(i.permissionHints),n<i.requestedAt&&(0,w._)(this,m).set(e,i.requestedAt)}async fetchUserThreadsDeltaUpdate(e){let t=(0,w._)(this,g);if(null===t)return;let n=await (0,w._)(this,f)[O.kInternal].httpClient.getUserThreadsSince_experimental({since:t,signal:e});t<n.requestedAt&&(0,I._)(this,p,n.requestedAt),this.updateThreadifications(n.threads.updated,n.inboxNotifications.updated,n.subscriptions.updated,n.threads.deleted,n.inboxNotifications.deleted,n.subscriptions.deleted),this.permissionHints.update(n.permissionHints)}async fetchRoomVersionsDeltaUpdate(e,t){let n=(0,w._)(this,v).get(e);if(void 0===n)return;let i=(0,O.nn)((0,w._)(this,f).getRoom(e),"Room with id ".concat(e," is not available on client")),r=await i[O.kInternal].listTextVersionsSince({since:n,signal:t});this.historyVersions.update(e,r.versions),n<r.requestedAt&&(0,w._)(this,v).set(e,r.requestedAt)}async refreshRoomSubscriptionSettings(e,t){let n=(0,O.nn)((0,w._)(this,f).getRoom(e),"Room with id ".concat(e," is not available on client")),i=await n.getSubscriptionSettings({signal:t});this.roomSubscriptionSettings.update(e,i)}async refreshNotificationSettings(e){let t=await (0,w._)(this,f).getNotificationSettings({signal:e});this.notificationSettings.update(t)}updateNotificationSettings_confirmOptimisticUpdate(e,t){(0,O.batch)(()=>{this.optimisticUpdates.remove(t),this.notificationSettings.update(e)})}constructor(e){(0,A._)(this,b),(0,S._)(this,f,{writable:!0,value:void 0}),(0,T._)(this,"threads",void 0),(0,T._)(this,"notifications",void 0),(0,T._)(this,"subscriptions",void 0),(0,T._)(this,"roomSubscriptionSettings",void 0),(0,T._)(this,"historyVersions",void 0),(0,T._)(this,"permissionHints",void 0),(0,T._)(this,"notificationSettings",void 0),(0,T._)(this,"optimisticUpdates",void 0),(0,T._)(this,"outputs",void 0),(0,S._)(this,p,{writable:!0,value:null}),(0,S._)(this,_,{writable:!0,value:void 0}),(0,S._)(this,m,{writable:!0,value:new Map}),(0,S._)(this,g,{writable:!0,value:null}),(0,S._)(this,v,{writable:!0,value:new Map}),(0,S._)(this,y,{writable:!0,value:void 0}),(0,I._)(this,f,e[O.kInternal].as()),this.optimisticUpdates=function(e){let t=new O.Signal([]),n=e[O.kInternal].createSyncSource();return t.subscribe(()=>n.setSyncStatus(t.get().length>0?"synchronizing":"synchronized")),{signal:t.asReadonly(),add:function(e){let n=(0,O.nanoid)(),i={...e,id:n};return t.set(e=>[...e,i]),n},remove:function(e){t.set(t=>t.filter(t=>t.id!==e))}}}((0,w._)(this,f)),this.permissionHints=function(){let e=new O.MutableSignal(new O.DefaultMap(()=>new Set));return{signal:e.asReadonly(),update:function(t){e.mutate(e=>{for(let[n,i]of Object.entries(t)){let t=e.getOrCreate(n);for(let e of i)t.add(e)}})}}}(),(0,I._)(this,_,new q(async e=>{let t=await (0,w._)(this,f).getInboxNotifications({cursor:e});return this.updateThreadifications(t.threads,t.inboxNotifications,t.subscriptions),null===(0,w._)(this,p)&&(0,I._)(this,p,t.requestedAt),t.nextCursor}));let t=async()=>{let e=await (0,w._)(this,f).getNotificationSettings();this.notificationSettings.update(e)};this.notificationSettings=function(e){let t=new O.Signal((0,O.createNotificationSettings)({}));return{signal:O.DerivedSignal.from(t,e,(e,t)=>(function(e,t){let n=e;for(let e of t)"update-notification-settings"===e.type&&(n=(0,O.patchNotificationSettings)(n,e.settings));return n})(e,t)),update:function(e){t.set(e)}}}(this.optimisticUpdates.signal),(0,I._)(this,y,new H(t)),this.threads=new V,this.subscriptions=function(e,t){let n=new O.MutableSignal(new Map);return{signal:O.DerivedSignal.from(n,e,(e,n)=>(function(e,t,n){let i=Object.fromEntries(e);for(let e of n)if("update-room-subscription-settings"===e.type){if(!e.settings.threads)continue;for(let n of t.findMany(e.roomId,void 0,"desc")){let t=(0,O.getSubscriptionKey)("thread",n.id);switch(e.settings.threads){case"all":i[t]={kind:"thread",subjectId:n.id,createdAt:new Date};break;case"none":delete i[t];break;case"replies_and_mentions":(function(e,t){let n=!1;for(let i of e.comments)if(!i.deletedAt&&(i.userId===t||(0,O.getMentionedIdsFromCommentBody)(i.body).includes(t))){n=!0;break}return n})(n,e.userId)&&!i[t]&&(i[t]={kind:"thread",subjectId:n.id,createdAt:new Date});break;default:(0,O.assertNever)(e.settings.threads,"Unexpected thread subscription settings.")}}}return i})(e,t,n)),applyDelta:function(e,t){n.mutate(n=>{let i=!1;for(let t of e)n.set((0,O.getSubscriptionKey)(t),t),i=!0;for(let e of t)n.delete((0,O.getSubscriptionKey)(e)),i=!0;return i})},create:function(e){n.mutate(t=>{t.set((0,O.getSubscriptionKey)(e),e)})},delete:function(e){n.mutate(t=>{t.delete(e)})}}}(this.optimisticUpdates.signal,this.threads),this.notifications=function(){let e=new O.MutableSignal(new Map);return{signal:e.asReadonly(),markAllRead:function(t){e.mutate(e=>{for(let n of e.values())n.readAt=t})},markRead:function(t,n){e.mutate(e=>{let i=e.get(t);return!!i&&(e.set(t,{...i,readAt:n}),!0)})},delete:function(t){e.mutate(e=>e.delete(t))},applyDelta:function(t,n){e.mutate(e=>{let i=!1;for(let n of t){var r,o;let t=e.get(n.id);(!t||1!==(r=t,o=n,r.notifiedAt>o.notifiedAt?1:r.notifiedAt<o.notifiedAt?-1:r.readAt&&o.readAt?r.readAt>o.readAt?1:r.readAt<o.readAt?-1:0:r.readAt||o.readAt?r.readAt?1:-1:0))&&(e.set(n.id,n),i=!0)}for(let t of n)e.delete(t.id),i=!0;return i})},clear:function(){e.mutate(e=>e.clear())},updateAssociatedNotification:function(t){e.mutate(e=>{let n=function(e,t){for(let n of e)if(t(n))return n}(e.values(),e=>"thread"===e.kind&&e.threadId===t.threadId);return!!n&&(e.set(n.id,{...n,notifiedAt:t.createdAt,readAt:t.createdAt}),!0)})},upsert:function(t){e.mutate(e=>{e.set(t.id,t)})}}}(),this.roomSubscriptionSettings=function(e){let t=new O.MutableSignal(new Map);return{signal:O.DerivedSignal.from(t,e,(e,t)=>(function(e,t){let n=Object.fromEntries(e);for(let e of t)switch(e.type){case"update-room-subscription-settings":{let t=n[e.roomId];if(void 0===t)break;n[e.roomId]={...t,...e.settings}}}return n})(e,t)),update:function(e,n){t.mutate(t=>{t.set(e,n)})}}}(this.optimisticUpdates.signal),this.historyVersions=function(){let e=new O.MutableSignal(new O.DefaultMap(()=>new Map));return{signal:O.DerivedSignal.from(e,e=>Object.fromEntries([...e].map(e=>{let[t,n]=e;return[t,Object.fromEntries(n)]}))),update:function(t,n){e.mutate(e=>{let i=e.getOrCreate(t);for(let e of n)i.set(e.id,e)})}}}();let n=O.DerivedSignal.from(this.threads.signal,this.notifications.signal,this.optimisticUpdates.signal,(e,t,n)=>(function(e,t,n){let i=e.clone(),r=Object.fromEntries(t);for(let e of n)switch(e.type){case"create-thread":i.upsert(e.thread);break;case"edit-thread-metadata":{let t=i.get(e.threadId);if(void 0===t||t.updatedAt>e.updatedAt)break;i.upsert({...t,updatedAt:e.updatedAt,metadata:{...t.metadata,...e.metadata}});break}case"mark-thread-as-resolved":{let t=i.get(e.threadId);if(void 0===t)break;i.upsert({...t,resolved:!0});break}case"mark-thread-as-unresolved":{let t=i.get(e.threadId);if(void 0===t)break;i.upsert({...t,resolved:!1});break}case"create-comment":{let t=i.get(e.comment.threadId);if(void 0===t)break;i.upsert(B(t,e.comment));let n=Object.values(r).find(e=>"thread"===e.kind&&e.threadId===t.id);if(void 0===n)break;r[n.id]={...n,notifiedAt:e.comment.createdAt,readAt:e.comment.createdAt};break}case"edit-comment":{let t=i.get(e.comment.threadId);if(void 0===t)break;i.upsert(B(t,e.comment));break}case"delete-comment":{let t=i.get(e.threadId);if(void 0===t)break;i.upsert(G(t,e.commentId,e.deletedAt));break}case"delete-thread":{let t=i.get(e.threadId);if(void 0===t)break;i.upsert({...t,deletedAt:e.deletedAt,updatedAt:e.deletedAt,comments:[]});break}case"add-reaction":{let t=i.get(e.threadId);if(void 0===t)break;i.upsert(Y(t,e.commentId,e.reaction));break}case"remove-reaction":{let t=i.get(e.threadId);if(void 0===t)break;i.upsert(X(t,e.commentId,e.emoji,e.userId,e.removedAt));break}case"mark-inbox-notification-as-read":{let t=r[e.inboxNotificationId];if(void 0===t)break;r[e.inboxNotificationId]={...t,readAt:e.readAt};break}case"mark-all-inbox-notifications-as-read":for(let t in r){let n=r[t];if(void 0===n)break;r[t]={...n,readAt:e.readAt}}break;case"delete-inbox-notification":delete r[e.inboxNotificationId];break;case"delete-all-inbox-notifications":r={}}return{sortedNotifications:Object.values(r).filter(e=>"thread"!==e.kind||void 0!==i.get(e.threadId)).sort((e,t)=>t.notifiedAt.getTime()-e.notifiedAt.getTime()),notificationsById:r,threadsDB:i}})(e,t,n)),i=O.DerivedSignal.from(n,e=>e.threadsDB),r=O.DerivedSignal.from(n,e=>({sortedNotifications:e.sortedNotifications,notificationsById:e.notificationsById}),O.shallow),o=O.DerivedSignal.from(r,this.subscriptions.signal,(e,t)=>({subscriptions:t,notifications:e.sortedNotifications})),s=new O.DefaultMap(e=>{let t=JSON.parse(e),n=new q(async e=>{let n=await (0,w._)(this,f)[O.kInternal].httpClient.getUserThreads_experimental({cursor:e,query:t});return this.updateThreadifications(n.threads,n.inboxNotifications,n.subscriptions),this.permissionHints.update(n.permissionHints),null===(0,w._)(this,g)&&(0,I._)(this,g,n.requestedAt),n.nextCursor});return{signal:O.DerivedSignal.from(()=>{let e=n.get();if(e.isLoading||e.error)return e;let i=this.outputs.threads.get().findMany(void 0,null!=t?t:{},"desc"),r=e.data;return{isLoading:!1,threads:i,hasFetchedAll:r.hasFetchedAll,isFetchingMore:r.isFetchingMore,fetchMoreError:r.fetchMoreError,fetchMore:r.fetchMore}},O.shallow2),waitUntilLoaded:n.waitUntilLoaded}}),a=new O.DefaultMap(e=>{let[t,n]=JSON.parse(e),i=new q(async e=>{let i=await (0,w._)(this,f)[O.kInternal].httpClient.getThreads({roomId:t,cursor:e,query:n});this.updateThreadifications(i.threads,i.inboxNotifications,i.subscriptions),this.permissionHints.update(i.permissionHints);let r=(0,w._)(this,m).get(t);return(void 0===r||r>i.requestedAt)&&(0,w._)(this,m).set(t,i.requestedAt),i.nextCursor});return{signal:O.DerivedSignal.from(()=>{let e=i.get();if(e.isLoading||e.error)return e;let r=this.outputs.threads.get().findMany(t,null!=n?n:{},"asc"),o=e.data;return{isLoading:!1,threads:r,hasFetchedAll:o.hasFetchedAll,isFetchingMore:o.isFetchingMore,fetchMoreError:o.fetchMoreError,fetchMore:o.fetchMore}},O.shallow2),waitUntilLoaded:i.waitUntilLoaded}}),l={signal:O.DerivedSignal.from(()=>{let e=(0,w._)(this,_).get();if(e.isLoading||e.error)return e;let t=e.data;return{isLoading:!1,inboxNotifications:this.outputs.notifications.get().sortedNotifications,hasFetchedAll:t.hasFetchedAll,isFetchingMore:t.isFetchingMore,fetchMoreError:t.fetchMoreError,fetchMore:t.fetchMore}}),waitUntilLoaded:(0,w._)(this,_).waitUntilLoaded},c=new O.DefaultMap(e=>{let t=new H(async()=>{let t=(0,w._)(this,f).getRoom(e);if(null===t)throw Error("Room '".concat(e,"' is not available on client"));let n=await t.getSubscriptionSettings();this.roomSubscriptionSettings.update(e,n)});return{signal:O.DerivedSignal.from(()=>{let n=t.get();return n.isLoading||n.error?n:x("settings",(0,O.nn)(this.roomSubscriptionSettings.signal.get()[e]))},O.shallow),waitUntilLoaded:t.waitUntilLoaded}}),d=new O.DefaultMap(e=>{let t=new H(async()=>{let t=(0,w._)(this,f).getRoom(e);if(null===t)throw Error("Room '".concat(e,"' is not available on client"));let n=await t[O.kInternal].listTextVersions();this.historyVersions.update(e,n.versions);let i=(0,w._)(this,v).get(e);(void 0===i||i>n.requestedAt)&&(0,w._)(this,v).set(e,n.requestedAt)});return{signal:O.DerivedSignal.from(()=>{var n;let i=t.get();return i.isLoading||i.error?i:x("versions",Object.values(null!=(n=this.historyVersions.signal.get()[e])?n:{}))},O.shallow),waitUntilLoaded:t.waitUntilLoaded}}),u={signal:O.DerivedSignal.from(()=>{let e=(0,w._)(this,y).get();return e.isLoading||e.error?e:x("settings",(0,O.nn)(this.notificationSettings.signal.get()))},O.shallow),waitUntilLoaded:(0,w._)(this,y).waitUntilLoaded};this.outputs={threadifications:n,threads:i,loadingRoomThreads:a,loadingUserThreads:s,notifications:r,loadingNotifications:l,roomSubscriptionSettingsByRoomId:c,versionsByRoomId:d,notificationSettings:u,threadSubscriptions:o},W(this)}});function B(e,t){if(void 0!==e.deletedAt)return e;if(t.threadId!==e.id)return O.console.warn("Comment ".concat(t.id," does not belong to thread ").concat(e.id)),e;let n=e.comments.find(e=>e.id===t.id);if(void 0===n){let n=new Date(Math.max(e.updatedAt.getTime(),t.createdAt.getTime()));return{...e,updatedAt:n,comments:[...e.comments,t]}}if(void 0!==n.deletedAt)return e;if(void 0===n.editedAt||void 0===t.editedAt||n.editedAt<=t.editedAt){var i;let n=e.comments.map(e=>e.id===t.id?t:e);return{...e,updatedAt:new Date(Math.max(e.updatedAt.getTime(),(null==(i=t.editedAt)?void 0:i.getTime())||t.createdAt.getTime())),comments:n}}return e}function G(e,t,n){if(void 0!==e.deletedAt)return e;let i=e.comments.find(e=>e.id===t);if(void 0===i||void 0!==i.deletedAt)return e;let r=e.comments.map(e=>e.id===t?{...e,deletedAt:n,body:void 0,attachments:[]}:e);return r.every(e=>void 0!==e.deletedAt)?{...e,deletedAt:n,updatedAt:n}:{...e,updatedAt:n,comments:r}}function Y(e,t,n){if(void 0!==e.deletedAt)return e;let i=e.comments.find(e=>e.id===t);if(void 0===i||void 0!==i.deletedAt)return e;let r=e.comments.map(e=>e.id===t?{...e,reactions:function(e,t){let n=e.find(e=>e.emoji===t.emoji);return void 0===n?[...e,{emoji:t.emoji,createdAt:t.createdAt,users:[{id:t.userId}]}]:!1===n.users.some(e=>e.id===t.userId)?e.map(e=>e.emoji===t.emoji?{...e,users:[...e.users,{id:t.userId}]}:e):e}(e.reactions,n)}:e);return{...e,updatedAt:new Date(Math.max(n.createdAt.getTime(),e.updatedAt.getTime())),comments:r}}function X(e,t,n,i,r){if(void 0!==e.deletedAt)return e;let o=e.comments.find(e=>e.id===t);if(void 0===o||void 0!==o.deletedAt)return e;let s=e.comments.map(e=>e.id===t?{...e,reactions:e.reactions.map(e=>e.emoji===n?{...e,users:e.users.filter(e=>e.id!==i)}:e).filter(e=>e.users.length>0)}:e);return{...e,updatedAt:new Date(Math.max(r.getTime(),e.updatedAt.getTime())),comments:s}}var J=(0,k.createContext)(null),Z=new WeakMap;function Q(){return(0,k.useContext)(J)}function $(){var e;return null!=(e=Q())?e:(0,O.raise)("LiveblocksProvider is missing from the React tree.")}function ee(e){let t=Q();if(!(null==e?void 0:e.allowNesting)&&null!==t)throw Error("You cannot nest multiple LiveblocksProvider instances in the same React tree.");return(0,C.jsx)(J.Provider,{value:e.client,children:e.children})}function et(e){let{children:t,...n}=e,i={publicApiKey:U(n.publicApiKey),throttle:U(n.throttle),lostConnectionTimeout:U(n.lostConnectionTimeout),backgroundKeepAliveTimeout:U(n.backgroundKeepAliveTimeout),polyfills:U(n.polyfills),largeMessageStrategy:U(n.largeMessageStrategy),unstable_fallbackToHTTP:U(n.unstable_fallbackToHTTP),unstable_streamData:U(n.unstable_streamData),preventUnsavedChanges:U(n.preventUnsavedChanges),authEndpoint:j(n.authEndpoint),resolveMentionSuggestions:j(n.resolveMentionSuggestions),resolveUsers:j(n.resolveUsers),resolveRoomsInfo:j(n.resolveRoomsInfo),baseUrl:U(n.baseUrl),enableDebugLogging:U(n.enableDebugLogging)},r=(0,k.useMemo)(()=>(0,O.createClient)(i),[]);return(0,C.jsx)(ee,{client:r,children:t})}var en=e=>e,ei=Object.freeze([]);function er(){return null}var eo=new WeakMap;function es(e){let t=eo.get(e);return t||(t=function(e){var t;let n,i=(t=e,(n=Z.get(t))||(n=new z(t),Z.set(t,n)),n),r=new O.DefaultMap(e=>(0,O.makePoller)(async t=>{try{return await i.fetchRoomThreadsDeltaUpdate(e,t)}catch(t){throw O.console.warn("Polling new threads for '".concat(e,"' failed: ").concat(String(t))),t}},D.ROOM_THREADS_POLL_INTERVAL,{maxStaleTimeMs:D.ROOM_THREADS_MAX_STALE_TIME})),o=new O.DefaultMap(e=>(0,O.makePoller)(async t=>{try{return await i.fetchRoomVersionsDeltaUpdate(e,t)}catch(t){throw O.console.warn("Polling new history versions for '".concat(e,"' failed: ").concat(String(t))),t}},D.HISTORY_VERSIONS_POLL_INTERVAL,{maxStaleTimeMs:D.HISTORY_VERSIONS_MAX_STALE_TIME})),s=new O.DefaultMap(e=>(0,O.makePoller)(async t=>{try{return await i.refreshRoomSubscriptionSettings(e,t)}catch(t){throw O.console.warn("Polling subscription settings for '".concat(e,"' failed: ").concat(String(t))),t}},D.ROOM_SUBSCRIPTION_SETTINGS_POLL_INTERVAL,{maxStaleTimeMs:D.ROOM_SUBSCRIPTION_SETTINGS_MAX_STALE_TIME}));return{store:i,onMutationFailure:function(t,n,r){if(i.optimisticUpdates.remove(t),r instanceof O.HttpError){if(403===r.status){var o,s;let e=[r.message,null==(o=r.details)?void 0:o.suggestion,null==(s=r.details)?void 0:s.docs].filter(Boolean).join("\n");O.console.error(e)}e[O.kInternal].emitError(n,r)}else throw r},pollThreadsForRoomId:e=>{let t=r.getOrCreate(e);t&&(t.markAsStale(),t.pollNowIfStale())},getOrCreateThreadsPollerForRoomId:r.getOrCreate.bind(r),getOrCreateVersionsPollerForRoomId:o.getOrCreate.bind(o),getOrCreateSubscriptionSettingsPollerForRoomId:s.getOrCreate.bind(s)}}(e),eo.set(e,t)),t}function ea(e){var t;let n=$(),{id:i,stableEnterRoom:r}=e,o=U({initialPresence:e.initialPresence,initialStorage:e.initialStorage,autoConnect:null!=(t=e.autoConnect)?t:"undefined"!=typeof window}),[{room:s},a]=(0,k.useState)(()=>r(i,{...o,autoConnect:!1}));return(0,k.useEffect)(()=>{let{store:e}=es(n);async function t(t){if(t.type===O.ServerMsgCode.THREAD_DELETED)return void e.deleteThread(t.threadId,null);let n=await s.getThread(t.threadId);if(!n.thread)return void e.deleteThread(t.threadId,null);let{thread:i,inboxNotification:r,subscription:o}=n,a=e.outputs.threads.get().getEvenIfDeleted(t.threadId);switch(t.type){case O.ServerMsgCode.COMMENT_EDITED:case O.ServerMsgCode.THREAD_METADATA_UPDATED:case O.ServerMsgCode.THREAD_UPDATED:case O.ServerMsgCode.COMMENT_REACTION_ADDED:case O.ServerMsgCode.COMMENT_REACTION_REMOVED:case O.ServerMsgCode.COMMENT_DELETED:if(!a)break;e.updateThreadifications([i],r?[r]:[],o?[o]:[]);break;case O.ServerMsgCode.COMMENT_CREATED:e.updateThreadifications([i],r?[r]:[],o?[o]:[])}}return s.events.comments.subscribe(e=>void t(e))},[n,s]),(0,k.useEffect)(()=>{let e=r(i,o);a(e);let{room:t,leave:n}=e;return o.autoConnect&&t.connect(),()=>{n()}},[i,o,r]),(0,C.jsx)(R.Provider,{value:s,children:e.children})}function el(e){let t=(0,k.useContext)(R);if(null===t&&!(null==e?void 0:e.allowOutsideRoom))throw Error("RoomProvider is missing from the React tree.");return t}Symbol();var ec=function(e){let t=$(),[n]=(0,k.useState)(()=>new Map),i=(0,k.useCallback)((e,i)=>{let r=n.get(e);if(r)return r;let o=t.enterRoom(e,i),s=o.leave;return o.leave=()=>{s(),n.delete(e)},n.set(e,o),o},[t,n]);return(0,C.jsx)(ea,{...e,stableEnterRoom:i})},ed=el;function eu(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,t){let n=el(),i=n.events.self.subscribe,r=n.getSelf,o=null!=e?e:en;return M(i,r,er,(0,k.useCallback)(e=>null!==e?o(e):null,[o]),t)}(...t)}function eh(e){let t=(0,w._)(this,r).get();void 0!==t.data&&(0,w._)(this,r).set(x({...t.data,...e}))}async function ef(){var e;let t=(0,w._)(this,r).get();if((null==(e=t.data)?void 0:e.cursor)&&!t.data.isFetchingMore){(0,E._)(this,a,eh).call(this,{isFetchingMore:!0});try{let e=await (0,w._)(this,o).call(this,t.data.cursor);(0,E._)(this,a,eh).call(this,{cursor:e,hasFetchedAll:null===e,fetchMoreError:void 0,isFetchingMore:!1})}catch(e){(0,E._)(this,a,eh).call(this,{isFetchingMore:!1,fetchMoreError:e})}}}function ep(e,t,n,i){(0,O.batch)(()=>{null!==t&&this.optimisticUpdates.remove(t);let r=this.threads,o=r.get(e);o&&(i&&o.updatedAt>i||r.upsert(n(o)))})}},144992:e=>{"use strict";e.s({createZustandContext:()=>i});var t=e.i(290479),n=e.i(373150);let i=e=>{let i=n.default.createContext(null);return{useContext:()=>n.default.useContext(i),Context:i,Provider:r=>{let[o]=n.default.useState(()=>e(r.initialValue));return(0,t.jsx)(i.Provider,{value:o,children:r.children})}}}},138626:e=>{"use strict";e.s({createStore:()=>n});let t=e=>{let t,n=new Set,i=(e,i)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=i?i:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,o={setState:i,getState:r,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e))},s=t=e(i,r,o);return o},n=e=>e?t(e):t},496438:e=>{"use strict";e.s({create:()=>s,useStore:()=>r});var t=e.i(373150),n=e.i(138626);let i=e=>e;function r(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,r=t.default.useSyncExternalStore(e.subscribe,()=>n(e.getState()),()=>n(e.getInitialState()));return t.default.useDebugValue(r),r}let o=e=>{let t=(0,n.createStore)(e),i=e=>r(t,e);return Object.assign(i,t),i},s=e=>e?o(e):o},52333:e=>{"use strict";e.s({default:()=>s,useConfirmationStore:()=>o});var t=e.i(144992),n=e.i(138626),i=e.i(496438);let r=(0,t.createZustandContext)(()=>(0,n.createStore)(e=>({open:!1,title:null,description:null,cancelLabel:null,actionLabel:null,actionButtonVariant:null,onAction:()=>{},onCancel:()=>{},openConfirmation:t=>e(()=>({open:!0,title:t.title,description:t.description,cancelLabel:t.cancelLabel,actionLabel:t.actionLabel,onAction:t.onAction,onCancel:t.onCancel,actionButtonVariant:t.actionButtonVariant})),closeConfirmation:()=>{e(()=>({open:!1})),setTimeout(()=>{e(()=>({title:null,description:null,cancelLabel:null,actionLabel:null,onAction:()=>{},onCancel:()=>{},actionButtonVariant:null}))},300)}}))),o=e=>(0,i.useStore)(r.useContext(),e),s=r},353178:e=>{"use strict";e.s({default:()=>t});let t=(0,e.i(238959).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},870007:e=>{"use strict";e.s({AlertCircle:()=>t.default});var t=e.i(353178)},340582:e=>{"use strict";e.s({useTrackIntegrationEvents:()=>n});var t=e.i(252390);let n=()=>{let{track:e}=(0,t.default)(),n=t=>{let n={connect_started:"integration_connect_started",connect_completed:"integration_connect_completed",connect_failed:"integration_connect_failed",disconnect_started:"integration_disconnect",disconnect_completed:"integration_disconnect_completed",reconnect_started:"integration_reconnect_started",modal_opened:"integration_file_selection_opened",file_selection_opened:"integration_file_selection_opened",files_imported:"integration_files_imported",import_failed:"integration_import_failed",dialog_opened:"integration_dialog_opened",dialog_closed:"integration_dialog_closed",settings_navigation:"integration_settings_navigation"}[t.action];n&&e(n,t)};return{trackIntegrationEvent:n,trackConnectStartedEvent:(e,t)=>{n({integration:e,source:t||"settings",action:"connect_started"})},trackDisconnectEvent:e=>{n({integration:e,source:"settings",action:"disconnect_started"})},trackConnectDialog:(e,t,i)=>{n({integration:e,source:t,action:i?"dialog_opened":"dialog_closed",modal_type:"connect_dialog"})},trackFileSelectionModal:(e,t)=>{n({integration:e,source:t,action:"file_selection_opened",modal_type:"file_selection"})},trackFileImport:(e,t,i,r,o)=>{n({integration:e,source:t,action:i?"files_imported":"import_failed",file_count:r,...o&&{error_message:o}})},trackConnectSuccess:(e,t)=>{n({integration:e,source:t,action:"connect_completed"})},trackConnectError:(e,t,i)=>{n({integration:e,source:t,action:"connect_failed",error_message:i})},trackReconnectAttempt:(e,t)=>{n({integration:e,source:t,action:"reconnect_started",reconnect:!0})},trackSettingsNavigation:e=>{n({integration:"navigation",source:e,action:"settings_navigation"})}}}},147740:e=>{"use strict";e.s({useIntegrationDialogStore:()=>t});let t=(0,e.i(496438).create)(e=>({isOpen:!1,integrationId:null,openIntegrationDialog:t=>e({isOpen:!0,integrationId:t}),closeIntegrationDialog:()=>e({isOpen:!1,integrationId:null})}))},368436:e=>{"use strict";e.s({useIntegrations:()=>r}),e.i(396133);var t=e.i(547946),n=e.i(814733),i=e.i(147740);let r=()=>{var e,r,o,s,a,l,c;let d=n.api.useUtils(),u=(0,t.useSession)(),{closeIntegrationDialog:h}=(0,i.useIntegrationDialogStore)(),{data:f,isPending:p}=n.api.integrations.all.useQuery(void 0,{enabled:!!(null==(e=u.data)?void 0:e.user)}),_=n.api.integrations.disconnect.useMutation({onSuccess:(e,t)=>{d.integrations.all.setData(void 0,e=>e?e.filter(e=>e.provider!==t.provider):e),h()}}),m=e=>null==f?void 0:f.find(t=>t.provider===e),g=null==(r=m("zotero"))?void 0:r.status,v=null==(o=m("google-drive"))?void 0:o.status,y=null==(s=m("onedrive"))?void 0:s.status,b=null==(a=m("sharepoint"))?void 0:a.status,w=null==(l=m("mendeley"))?void 0:l.status;return{zoteroStatus:g,googleDriveStatus:v,oneDriveStatus:y,sharePointStatus:b,mendeleyStatus:w,notionStatus:null==(c=m("notion"))?void 0:c.status,isPendingIntegrations:p,disconnectIntegration:e=>{_.mutate({provider:e})},isDisconnecting:_.isPending,getIntegrationUpdatedAt:e=>{var t;return null==f||null==(t=f.find(t=>t.provider===e))?void 0:t.updatedAt},getIntegrationError:e=>{var t;let n=m(e),i=null==n?void 0:n.metadata;return(null==i||null==(t=i.error)?void 0:t.message)||null}}}},861689:e=>{"use strict";e.s({default:()=>n});var t=e.i(290479);let n=e=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 87.3 78",width:"1em",height:"1em",...e,children:[(0,t.jsx)("path",{fill:"#0066da",d:"m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3L27.5 53H0c0 1.55.4 3.1 1.2 4.5z"}),(0,t.jsx)("path",{fill:"#00ac47",d:"M43.65 25 29.9 1.2c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44A9.06 9.06 0 0 0 0 53h27.5z"}),(0,t.jsx)("path",{fill:"#ea4335",d:"M73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75L86.1 57.5c.8-1.4 1.2-2.95 1.2-4.5H59.798l5.852 11.5z"}),(0,t.jsx)("path",{fill:"#00832d",d:"M43.65 25 57.4 1.2C56.05.4 54.5 0 52.9 0H34.4c-1.6 0-3.15.45-4.5 1.2z"}),(0,t.jsx)("path",{fill:"#2684fc",d:"M59.8 53H27.5L13.75 76.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z"}),(0,t.jsx)("path",{fill:"#ffba00",d:"m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3L43.65 25 59.8 53h27.45c0-1.55-.4-3.1-1.2-4.5z"})]})},542285:e=>{"use strict";e.s({MendeleyIcon:()=>n});var t=e.i(290479);let n=e=>(0,t.jsx)("svg",{viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,t.jsx)("path",{d:"M7.98178 3.1275H7.99428C9.45828 3.1275 10.1198 4.961 8.99428 5.899C8.83578 6.047 8.63778 6.1515 8.42428 6.1985C8.28378 6.24 8.14028 6.261 7.99428 6.261H7.98178C7.83028 6.261 7.68728 6.237 7.54928 6.1985C7.33578 6.152 7.14078 6.047 6.98178 5.899C6.62228 5.6015 6.41378 5.159 6.41378 4.693C6.41628 3.8285 7.11728 3.1275 7.98178 3.1275ZM1.34828 9.4275C2.18978 9.534 2.93678 8.922 3.01778 8.06C3.04128 7.7785 2.99178 7.4945 2.87428 7.2365C1.69778 4.651 7.51278 4.591 6.52828 7.034L6.52278 7.044C6.05678 7.7865 6.30928 8.7525 7.08028 9.198C7.36678 9.3645 7.67978 9.432 7.98628 9.4195C8.29378 9.432 8.60878 9.365 8.89278 9.198C9.66628 8.7525 9.91878 7.7865 9.45278 7.044L9.44728 7.034C8.46278 4.5915 14.2808 4.6515 13.0978 7.2365C12.9813 7.4945 12.9313 7.7785 12.9578 8.06C13.0383 8.922 13.7833 9.534 14.6263 9.4275C14.9883 9.38 15.3243 9.206 15.5718 8.9375C15.5718 8.9375 15.9653 8.612 15.9578 7.784C15.9523 7.1095 15.5718 6.7345 15.5718 6.7345C15.2573 6.4165 14.8143 6.258 14.3663 6.307C13.2883 6.281 13.1263 5.437 13.4308 3.8435C13.5428 3.5595 13.5928 3.2575 13.5823 2.9555C13.6188 1.9995 13.0508 1.122 12.1658 0.763C12.1398 0.7525 12.1138 0.7445 12.0878 0.7345C12.0593 0.721 12.0278 0.7105 11.9963 0.703C10.9938 0.3645 9.88978 0.765 9.33478 1.669C8.79078 2.265 8.54528 2.627 7.98528 2.627C7.45478 2.627 7.18078 2.265 6.63928 1.669C6.06878 0.7345 4.90978 0.3385 3.88678 0.7315C3.86078 0.7415 3.83478 0.752 3.80878 0.763C2.92078 1.1225 2.35528 1.9995 2.39228 2.9555C2.38178 3.2575 2.43078 3.5595 2.54278 3.8435C2.84728 5.437 2.68628 6.281 1.60828 6.304C1.07978 6.2465 0.683779 6.4655 0.285779 6.8665C-0.112721 7.2645 -0.0787214 8.3325 0.285779 8.7985C0.551279 9.137 0.913279 9.372 1.34778 9.4265L1.34828 9.4275Z",fill:"#FF0100"})})},495001:e=>{"use strict";e.s({default:()=>n});var t=e.i(290479);let n=e=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 268",preserveAspectRatio:"xMidYMid",width:"1em",height:"1em",...e,children:[(0,t.jsx)("path",{fill:"#FFF",d:"M16.092 11.538 164.09.608c18.179-1.56 22.85-.508 34.28 7.801l47.243 33.282C253.406 47.414 256 48.975 256 55.207v182.527c0 11.439-4.155 18.205-18.696 19.24L65.44 267.378c-10.913.517-16.11-1.043-21.825-8.327L8.826 213.814C2.586 205.487 0 199.254 0 191.97V29.726c0-9.352 4.155-17.153 16.092-18.188Z"}),(0,t.jsx)("path",{d:"M164.09.608 16.092 11.538C4.155 12.573 0 20.374 0 29.726v162.245c0 7.284 2.585 13.516 8.826 21.843l34.789 45.237c5.715 7.284 10.912 8.844 21.825 8.327l171.864-10.404c14.532-1.035 18.696-7.801 18.696-19.24V55.207c0-5.911-2.336-7.614-9.21-12.66l-1.185-.856L198.37 8.409C186.94.1 182.27-.952 164.09.608ZM69.327 52.22c-14.033.945-17.216 1.159-25.186-5.323L23.876 30.778c-2.06-2.086-1.026-4.69 4.163-5.207l142.274-10.395c11.947-1.043 18.17 3.12 22.842 6.758l24.401 17.68c1.043.525 3.638 3.637.517 3.637L71.146 52.095l-1.819.125Zm-16.36 183.954V81.222c0-6.767 2.077-9.887 8.3-10.413L230.02 60.93c5.724-.517 8.31 3.12 8.31 9.879v153.917c0 6.767-1.044 12.49-10.387 13.008l-161.487 9.361c-9.343.517-13.489-2.594-13.489-10.921ZM212.377 89.53c1.034 4.681 0 9.362-4.681 9.897l-7.783 1.542v114.404c-6.758 3.637-12.981 5.715-18.18 5.715-8.308 0-10.386-2.604-16.609-10.396l-50.898-80.079v77.476l16.1 3.646s0 9.362-12.989 9.362l-35.814 2.077c-1.043-2.086 0-7.284 3.63-8.318l9.351-2.595V109.823l-12.98-1.052c-1.044-4.68 1.55-11.439 8.826-11.965l38.426-2.585 52.958 81.113v-71.76l-13.498-1.552c-1.043-5.733 3.111-9.896 8.3-10.404l35.84-2.087Z"})]})},720238:e=>{"use strict";e.s({default:()=>n});var t=e.i(290479);let n=e=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 5.5 32 20.5",...e,children:[(0,t.jsx)("title",{children:"OfficeCore10_32x_24x_20x_16x_01-22-2019"}),(0,t.jsx)("path",{fill:"#0364b8",d:"M12.202 11.193v-.001l6.718 4.024 4.003-1.685A6.477 6.477 0 0 1 25.5 13c.148 0 .294.007.439.016a10 10 0 0 0-18.041-3.013L8 10a7.96 7.96 0 0 1 4.202 1.193Z"}),(0,t.jsx)("path",{fill:"#0078d4",d:"M12.203 11.192A7.96 7.96 0 0 0 8 10l-.102.003a7.997 7.997 0 0 0-6.46 12.57L7.36 20.08l2.634-1.108 5.863-2.468 3.062-1.288Z"}),(0,t.jsx)("path",{fill:"#1490df",d:"M25.939 13.016A6.577 6.577 0 0 0 25.5 13a6.477 6.477 0 0 0-2.576.532l-4.004 1.684 1.161.695 3.805 2.279 1.66.994 5.677 3.4a6.5 6.5 0 0 0-5.284-9.568Z"}),(0,t.jsx)("path",{fill:"#28a8ea",d:"m25.546 19.184-1.66-.994-3.805-2.28-1.16-.694-3.063 1.288-5.863 2.468L7.36 20.08l-5.924 2.493A7.989 7.989 0 0 0 8 26h17.5a6.498 6.498 0 0 0 5.723-3.416Z"})]})},833856:e=>{"use strict";e.s({default:()=>n});var t=e.i(290479);let n=e=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"0 0 1992.333 1946",...e,children:[(0,t.jsx)("circle",{cx:1019.333,cy:556,r:556,fill:"#036C70"}),(0,t.jsx)("circle",{cx:1482.667,cy:1065.667,r:509.667,fill:"#1A9BA1"}),(0,t.jsx)("circle",{cx:1088.833,cy:1552.167,r:393.833,fill:"#37C6D0"}),(0,t.jsx)("path",{d:"M1112 501.79v988.753c-.23 34.357-21.05 65.222-52.82 78.303a82.12 82.12 0 0 1-31.97 6.487H695.463c-.463-7.877-.463-15.29-.463-23.167-.154-7.734.155-15.47.927-23.167 8.48-148.106 99.721-278.782 235.837-337.77v-86.18c-302.932-48.005-509.592-332.495-461.587-635.427.333-2.098.677-4.195 1.034-6.289a391.8 391.8 0 0 1 9.73-46.333h546.27c46.753.178 84.611 38.036 84.789 84.79z",opacity:.1}),(0,t.jsx)("path",{d:"M980.877 463.333H471.21c-51.486 302.386 151.908 589.256 454.293 640.742a555.466 555.466 0 0 0 27.573 3.986c-143.633 68.11-248.3 261.552-257.196 420.938a193.737 193.737 0 0 0-.927 23.167c0 7.877 0 15.29.463 23.167a309.212 309.212 0 0 0 6.023 46.333h279.39c34.357-.23 65.222-21.05 78.303-52.82a82.098 82.098 0 0 0 6.487-31.97V548.123c-.176-46.736-38.006-84.586-84.742-84.79z",opacity:.2}),(0,t.jsx)("path",{d:"M980.877 463.333H471.21c-51.475 302.414 151.95 589.297 454.364 640.773a556.017 556.017 0 0 0 18.607 2.844c-139 73.021-239.543 266-248.254 422.05h284.95c46.681-.353 84.437-38.109 84.79-84.79V548.123c-.178-46.754-38.036-84.612-84.79-84.79z",opacity:.2}),(0,t.jsx)("path",{d:"M934.543 463.333H471.21c-48.606 285.482 130.279 560.404 410.977 631.616A765.521 765.521 0 0 0 695.927 1529h238.617c46.754-.178 84.612-38.036 84.79-84.79V548.123c-.026-46.817-37.973-84.764-84.791-84.79z",opacity:.2}),(0,t.jsxs)("linearGradient",{id:"a",x1:177.079,x2:842.255,y1:1551.028,y2:398.972,gradientTransform:"matrix(1 0 0 -1 0 1948)",gradientUnits:"userSpaceOnUse",children:[(0,t.jsx)("stop",{offset:0,style:{stopColor:"#058f92"}}),(0,t.jsx)("stop",{offset:.5,style:{stopColor:"#038489"}}),(0,t.jsx)("stop",{offset:1,style:{stopColor:"#026d71"}})]}),(0,t.jsx)("path",{fill:"url(#a)",d:"M84.929 463.333h849.475c46.905 0 84.929 38.024 84.929 84.929v849.475c0 46.905-38.024 84.929-84.929 84.929H84.929c-46.905 0-84.929-38.024-84.929-84.929V548.262c0-46.905 38.024-84.929 84.929-84.929z"}),(0,t.jsx)("path",{fill:"#FFF",d:"M379.331 962.621a156.785 156.785 0 0 1-48.604-51.384 139.837 139.837 0 0 1-16.912-70.288 135.25 135.25 0 0 1 31.46-91.045 185.847 185.847 0 0 1 83.678-54.581 353.459 353.459 0 0 1 114.304-17.699 435.148 435.148 0 0 1 150.583 21.082v106.567a235.031 235.031 0 0 0-68.11-27.8 331.709 331.709 0 0 0-79.647-9.545 172.314 172.314 0 0 0-81.871 17.329 53.7 53.7 0 0 0-32.433 49.206 49.853 49.853 0 0 0 13.9 34.843 124.638 124.638 0 0 0 37.067 26.503c15.444 7.691 38.611 17.916 69.5 30.673a70.322 70.322 0 0 1 9.915 3.985 571.842 571.842 0 0 1 87.663 43.229 156.935 156.935 0 0 1 51.801 52.171 151.223 151.223 0 0 1 18.533 78.767 146.506 146.506 0 0 1-29.468 94.798 164.803 164.803 0 0 1-78.767 53.005 357.22 357.22 0 0 1-112.312 16.309 594.113 594.113 0 0 1-101.933-8.34 349.057 349.057 0 0 1-82.612-24.279v-112.358a266.237 266.237 0 0 0 83.4 39.847 326.268 326.268 0 0 0 92.018 14.734 158.463 158.463 0 0 0 83.4-17.699 55.971 55.971 0 0 0 28.449-49.994 53.284 53.284 0 0 0-15.753-38.271 158.715 158.715 0 0 0-43.414-30.256c-18.533-9.267-45.824-21.483-81.871-36.65a465.328 465.328 0 0 1-81.964-42.859z"})]})},7799:e=>{"use strict";e.s({default:()=>n});var t=e.i(290479);let n=e=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 22",fill:"none",width:"1em",height:"1em",...e,children:(0,t.jsx)("path",{fill:"#F15055",d:"M19.43 3.095 18.178.5H1.842v4.381h10.027L.57 18.85 1.843 21.5H19.43v-4.468H8.308L19.431 3.095Z"})})},888305:e=>{"use strict";e.s({INTEGRATION_CONFIG:()=>l,INTEGRATION_ORDER:()=>d,getIntegrationConfig:()=>c,getIntegrationModalIcon:()=>h,getIntegrationModalTitle:()=>u});var t=e.i(373150),n=e.i(861689),i=e.i(542285),r=e.i(495001),o=e.i(720238),s=e.i(833856),a=e.i(7799);let l={"google-drive":{id:"google-drive",name:"Google Drive",icon:n.default,description:"Sync your files from your Google Drive folders.",detailedDescription:"Connect your Google Drive to access your files inside Anara."},mendeley:{id:"mendeley",name:"Mendeley",icon:i.MendeleyIcon,description:"Easily transfer PDFs from Mendeley.",detailedDescription:"Connect your Mendeley to access your PDFs inside Anara."},notion:{id:"notion",name:"Notion",icon:r.default,description:"Sync your Notion pages and databases.",detailedDescription:"Connect your Notion to access your pages inside Anara."},onedrive:{id:"onedrive",name:"OneDrive",icon:o.default,description:"Import files from your OneDrive account.",detailedDescription:"Connect your OneDrive to access your files inside Anara."},sharepoint:{id:"sharepoint",name:"SharePoint",icon:s.default,description:"Import your SharePoint files.",detailedDescription:"Connect your SharePoint to access your documents inside Anara."},zotero:{id:"zotero",name:"Zotero",icon:a.default,description:"Import PDFs from your Zotero collections",detailedDescription:"Connect your Zotero to access your research papers inside Anara."}},c=e=>l[e],d=["google-drive","mendeley","notion","onedrive","sharepoint","zotero"],u=e=>{let t=l[e];return"Import from ".concat(t.name)},h=(e,n)=>{let i=l[e].icon;return t.default.createElement(i,n)}},739087:e=>{"use strict";e.s({TourType:()=>t});var t=function(e){return e.APP_LANDING_FIRST_VISIT="APP_LANDING_FIRST_VISIT",e.AGENT_LANDING_FIRST_VISIT="AGENT_LANDING_FIRST_VISIT",e.AGENT_FIRST_VISIT="AGENT_FIRST_VISIT",e.LIBRARY_FIRST_VISIT="LIBRARY_FIRST_VISIT",e.CHAT_FIRST_VISIT="CHAT_FIRST_VISIT",e.TOOLBAR_MENU_MOVED="TOOLBAR_MENU_MOVED",e}({})},955288:e=>{"use strict";e.s({tourConfig:()=>n});var t=e.i(739087);let n={[t.TourType.AGENT_FIRST_VISIT]:{id:t.TourType.AGENT_FIRST_VISIT,name:"Agent First Visit",required:!1,autoStart:!0,steps:[{id:"library",target:"#library-button",title:"Files have a new home",content:"See, sort, filter, and manage all your files on the Library page",placement:"right",targetAnchorPosition:.5,tooltipAnchorPosition:.13,tooltipOffset:{x:6,y:0}}]},[t.TourType.AGENT_LANDING_FIRST_VISIT]:{id:t.TourType.AGENT_LANDING_FIRST_VISIT,name:"Agent Landing First Visit",required:!1,autoStart:!0,steps:[{id:"agent-mention-button",target:"#agent-mention-button",title:"Introducing agents",content:"Type â€˜@â€™ to bring in AI agents that find answers, explain concepts, and research topics for you.",placement:"top",targetAnchorPosition:.21,tooltipAnchorPosition:.9,tooltipOffset:{y:60}}]},[t.TourType.APP_LANDING_FIRST_VISIT]:{id:t.TourType.APP_LANDING_FIRST_VISIT,name:"App Landing First Visit",required:!0,autoStart:!0,steps:[{id:"answer-questions",target:"#answer-questions",title:"Answer any question",content:"Type '@' to bring in AI agents that find answers, explain concepts, and research topics for you.",placement:"top",targetAnchorPosition:.21,tooltipAnchorPosition:.9,tooltipOffset:{y:16}},{id:"upload-files",target:"#upload-button",title:"Add files or folders",content:"Upload files or folders here. We support all popular document, audio and video filetypes.",placement:"bottom",targetAnchorPosition:1.65,tooltipAnchorPosition:.1,tooltipOffset:{y:6}},{id:"library",target:"#library-button",title:"All your files",content:"See, sort, filter, and manage all your files on the Library page",placement:"right",targetAnchorPosition:.5,tooltipAnchorPosition:.13,tooltipOffset:{x:6,y:0}},{id:"create-folders",target:"#create-button",title:"Create folders",content:'Click the "+" icon to create a folder. Drag and drop folders to nest them as subfolders.',placement:"right",targetAnchorPosition:.5,tooltipAnchorPosition:.13,tooltipOffset:{x:6,y:0}},{id:"open-folder",target:"#open-folder",title:"Open folder",content:"Select a folder to explore and chat with its contents - including files in nested subfolders.",placement:"right",targetAnchorPosition:0,tooltipAnchorPosition:.14,tooltipOffset:{x:6}}]},[t.TourType.CHAT_FIRST_VISIT]:{id:t.TourType.CHAT_FIRST_VISIT,name:"Chatbot Features",required:!1,autoStart:!1,steps:[{id:"previous-chats",target:"#previous-chats",title:"Previous chats",content:"View previous conversations with this file or folder. Click to reopen any chat and pick up where you left off.",placement:"bottom",targetAnchorPosition:.1,tooltipAnchorPosition:.1,tooltipOffset:{y:6,x:0}},{id:"right-sidebar",target:"#right-sidebar",title:"Right sidebar",content:"Access citation details, find related papers and review annotations here.",placement:"bottom",targetAnchorPosition:.4,tooltipAnchorPosition:.7,tooltipOffset:{y:1,x:-30}}]},[t.TourType.LIBRARY_FIRST_VISIT]:{id:t.TourType.LIBRARY_FIRST_VISIT,name:"Library First Visit",required:!0,autoStart:!0,steps:[{id:"chatbot-settings",target:"#chatbot-button",title:"Chat",content:"Chat with the folder or file in view to quickly find and simplify information.",placement:"bottom",targetAnchorPosition:.2,tooltipAnchorPosition:.8,tooltipOffset:{y:3,x:-30}}]},[t.TourType.TOOLBAR_MENU_MOVED]:{id:t.TourType.TOOLBAR_MENU_MOVED,name:"Format Toolbar Update",required:!1,autoStart:!0,steps:[{id:"format-toolbar-container",target:"#format-toolbar-container",title:"Toolbar has moved",content:"It now adapts to your screen size with improved organization.",placement:"top",targetAnchorPosition:.5,tooltipAnchorPosition:.5,tooltipOffset:{y:20,x:0}}]}}},185296:e=>{"use strict";e.s({TourProvider:()=>c,useTour:()=>d});var t=e.i(290479),n=e.i(885905),i=e.i(440840),r=e.i(814733),o=e.i(257140),s=e.i(373150),a=e.i(955288);let l=(0,s.createContext)(void 0),c=e=>{let{children:c}=e,[d,u]=(0,s.useState)(null),[h,f]=(0,s.useState)(0),[p,_]=(0,s.useState)([]),{isAdmin:m}=(0,i.useImpersonation)(),g=r.api.useUtils(),{isLoggedIn:v,user:y}=(0,n.useAuth)(),{data:b}=r.api.tours.byUser.useQuery(void 0,{enabled:v}),{mutate:w}=r.api.tours.completeTour.useMutation({onMutate:e=>{g.tours.byUser.setData(void 0,t=>{var n;let i={id:(0,o.nanoid)(),userId:null!=(n=null==y?void 0:y.id)?n:"",createdAt:new Date().toISOString(),type:e.type,completed:!0};return t?[...t,i]:[i]})}}),{mutate:S}=r.api.tours.resetTours.useMutation({onSuccess:()=>{g.tours.byUser.invalidate()}}),I=(0,s.useCallback)((e,t)=>{let n=a.tourConfig[e];if(!n||!n.steps[t])return!1;let i=n.steps[t];return!!document.querySelector(i.target)},[]),E=(0,s.useCallback)(()=>{if(0===p.length||d)return;let e=p.filter(e=>null==b||!b.some(t=>t.type===e&&t.completed));e.length!==p.length&&_(e);let t=e.find(e=>I(e,0));t&&(u(t),f(0),_(e=>e.filter(e=>e!==t)))},[p,d,b,I]),A=(0,s.useCallback)(e=>{if(!m&&!((null==b?void 0:b.some(t=>t.type===e&&t.completed))||d===e||p.includes(e))){if(!d&&I(e,0)){u(e),f(0);return}_(t=>t.includes(e)?t:[...t,e])}},[m,b,d,p,I]),T=(0,s.useCallback)(()=>{f(e=>e+1)},[]),k=(0,s.useCallback)(()=>{f(e=>e>0?e-1:e)},[]),O=(0,s.useCallback)(()=>{d&&!m&&w({type:d}),u(null),f(0),setTimeout(E,100)},[d,m,w,E]),C=(0,s.useCallback)(()=>{d&&!m&&(w({type:d}),u(null),f(0),setTimeout(E,100))},[d,m,w,E]),R=(0,s.useCallback)(()=>{S(),u(null),f(0),_([])},[S]),M=(0,s.useCallback)(e=>{var t;return null!=(t=null==b?void 0:b.some(t=>t.type===e&&t.completed))&&t},[b]),D=(0,s.useCallback)(()=>{d&&(I(d,h)||(u(null),f(0),setTimeout(E,100)))},[d,h,I,E]);(0,s.useEffect)(()=>{let e=setInterval(()=>{if(d&&!I(d,h)){u(null),f(0);return}!d&&p.length>0&&E()},2e3);return()=>clearInterval(e)},[d,h,p.length,E,I]);let N=(0,s.useMemo)(()=>({activeTour:d,tourQueue:p,currentStep:h,startTour:A,nextStep:T,prevStep:k,skipTour:O,completeTour:C,isTourCompleted:M,resetTours:R,checkTourVisibility:D}),[d,p,h,A,T,k,O,C,M,R,D]);return(0,t.jsx)(l.Provider,{value:N,children:c})},d=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useTour must be used within a TourProvider");return e}}}]);

//# sourceMappingURL=316b7660f755c6f2.js.map