<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DuNorth – Install Extension</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/lovable.css" />
    <style>
      .wrap2 { max-width: 760px; margin: 60px auto; background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 28px; box-shadow: 0 10px 24px rgba(2,6,23,.06); }
      .muted { color: var(--muted); }
      .row { display:flex; gap:12px; justify-content:center; }
      .center { text-align:center; }
      .hint { margin-top:8px; font-size:14px; }
      .link-blue { color: var(--primary-700); text-decoration: underline; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header class="brand">DuNorth</header>
      <main class="wrap2">
        <h1 class="center">Add the DuNorth Chrome Extension</h1>
        <p class="muted center">This connects your Canvas login to DuNorth. You can remove it anytime.</p>
        <div class="row" style="margin: 20px 0 10px;">
          <a id="goInstall" class="btn primary" href="https://chromewebstore.google.com/detail/lectureping/lhfclolcgndpomhfdijbocgcbjhfjkah" target="_blank" rel="noopener">Go install extension</a>
          <button id="installed" class="btn">I installed it</button>
        </div>
        <p class="muted center hint">It opens the Chrome Web Store in a new tab. After installing, return here and click “I installed it”.<br/>Having trouble? <a class="link-blue" href="/privacypolicy" target="_blank" rel="noopener">See privacy</a>.</p>
      </main>
    </div>
    <script>
      function detectExtension(timeout = 600){
        return new Promise((resolve) => {
          let done = false;
          function onMsg(ev){ if (ev?.data?.dunorth_ext === 'pong'){ done = true; cleanup(); resolve(true); } }
          function cleanup(){ window.removeEventListener('message', onMsg); }
          window.addEventListener('message', onMsg);
          window.postMessage({ dunorth_page: 'ping' }, '*');
          setTimeout(() => { if (!done){ cleanup(); resolve(false); } }, timeout);
        });
      }
      document.getElementById('installed').addEventListener('click', () => {
        window.location.href = '../chat/chat.html?connected=1';
      });
      (async () => { const ok = await detectExtension(900); if (ok) window.location.href = '../chat/chat.html?connected=1'; })();
    </script>
  </body>
  </html>


